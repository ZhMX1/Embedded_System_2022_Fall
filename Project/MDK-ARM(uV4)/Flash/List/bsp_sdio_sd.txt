; generated by Component: ARM Compiler 5.06 update 4 (build 422) Tool: ArmCC [4d3604]
; commandline ArmCC [--c99 --list --split_sections --debug -c --asm --interleave -o.\flash\obj\bsp_sdio_sd.o --asm_dir=.\Flash\List\ --list_dir=.\Flash\List\ --depend=.\flash\obj\bsp_sdio_sd.d --cpu=Cortex-M3 --apcs=interwork -O3 --diag_suppress=9931,870 -I..\..\Libraries\CMSIS\Device\ST\STM32F10x\Include -I..\..\Libraries\STM32F10x_StdPeriph_Driver\inc -I..\..\Libraries\STM32_USB-FS-Device_Driver\inc -I..\..\Libraries\CMSIS\Include -I..\..\User\bsp -I..\..\User\bsp\inc -I..\..\User\app\inc -I..\..\User\fonts -I..\..\User\images -I..\..\User\uIP\uip -I..\..\User\uIP\http -I..\..\User\uIP\dm9000 -I..\..\User\FatFS\src -I..\..\User\usb_mass -I..\..\User\CH376\inc -I.\RTE\_Flash -ID:\Keil\ARM\PACK\ARM\CMSIS\5.0.1\CMSIS\Include -ID:\Keil\ARM\PACK\Keil\STM32F1xx_DFP\2.1.0\Device\Include -D__MICROLIB -D__UVISION_VERSION=523 -D_RTE_ -DSTM32F10X_HD -DUSE_STDPERIPH_DRIVER -DSTM32F10X_HD --omf_browse=.\flash\obj\bsp_sdio_sd.crf ..\..\User\bsp\src\bsp_sdio_sd.c]
                          THUMB

                          AREA ||i.CmdResp1Error||, CODE, READONLY, ALIGN=2

                  CmdResp1Error PROC
;;;2147     */
;;;2148   static SD_Error CmdResp1Error(uint8_t cmd)
000000  b570              PUSH     {r4-r6,lr}
;;;2149   {
;;;2150     SD_Error errorstatus = SD_OK;
;;;2151     uint32_t status;
;;;2152     uint32_t response_r1;
;;;2153   
;;;2154     status = SDIO->STA;
000002  4937              LDR      r1,|L1.224|
000004  4605              MOV      r5,r0                 ;2149
000006  2400              MOVS     r4,#0                 ;2150
                  |L1.8|
;;;2155   
;;;2156     while (!(status & (SDIO_FLAG_CCRCFAIL | SDIO_FLAG_CMDREND | SDIO_FLAG_CTIMEOUT)))
;;;2157     {
;;;2158       status = SDIO->STA;
000008  6b48              LDR      r0,[r1,#0x34]
00000a  f0100f45          TST      r0,#0x45              ;2156
00000e  d0fb              BEQ      |L1.8|
;;;2159     }
;;;2160   
;;;2161     if (status & SDIO_FLAG_CTIMEOUT)
000010  0741              LSLS     r1,r0,#29
000012  d502              BPL      |L1.26|
;;;2162     {
;;;2163       errorstatus = SD_CMD_RSP_TIMEOUT;
000014  2403              MOVS     r4,#3
;;;2164       SDIO_ClearFlag(SDIO_FLAG_CTIMEOUT);
000016  2004              MOVS     r0,#4
;;;2165       return(errorstatus);
000018  e003              B        |L1.34|
                  |L1.26|
;;;2166     }
;;;2167     else if (status & SDIO_FLAG_CCRCFAIL)
00001a  07c0              LSLS     r0,r0,#31
00001c  d004              BEQ      |L1.40|
;;;2168     {
;;;2169       errorstatus = SD_CMD_CRC_FAIL;
00001e  2401              MOVS     r4,#1
;;;2170       SDIO_ClearFlag(SDIO_FLAG_CCRCFAIL);
000020  4620              MOV      r0,r4
                  |L1.34|
000022  f7fffffe          BL       SDIO_ClearFlag
000026  e059              B        |L1.220|
                  |L1.40|
;;;2171       return(errorstatus);
;;;2172     }
;;;2173   
;;;2174     /*!< Check response received is of desired command */
;;;2175     if (SDIO_GetCommandResponse() != cmd)
000028  f7fffffe          BL       SDIO_GetCommandResponse
00002c  42a8              CMP      r0,r5
00002e  d12b              BNE      |L1.136|
;;;2176     {
;;;2177       errorstatus = SD_ILLEGAL_CMD;
;;;2178       return(errorstatus);
;;;2179     }
;;;2180   
;;;2181     /*!< Clear all the static flags */
;;;2182     SDIO_ClearFlag(SDIO_STATIC_FLAGS);
000030  f24050ff          MOV      r0,#0x5ff
000034  f7fffffe          BL       SDIO_ClearFlag
;;;2183   
;;;2184     /*!< We have received response, retrieve it for analysis  */
;;;2185     response_r1 = SDIO_GetResponse(SDIO_RESP1);
000038  2000              MOVS     r0,#0
00003a  f7fffffe          BL       SDIO_GetResponse
;;;2186   
;;;2187     if ((response_r1 & SD_OCR_ERRORBITS) == SD_ALLZERO)
00003e  4929              LDR      r1,|L1.228|
000040  4208              TST      r0,r1
000042  d04b              BEQ      |L1.220|
;;;2188     {
;;;2189       return(errorstatus);
;;;2190     }
;;;2191   
;;;2192     if (response_r1 & SD_OCR_ADDR_OUT_OF_RANGE)
000044  2800              CMP      r0,#0
000046  da01              BGE      |L1.76|
;;;2193     {
;;;2194       return(SD_ADDR_OUT_OF_RANGE);
000048  201c              MOVS     r0,#0x1c
;;;2195     }
;;;2196   
;;;2197     if (response_r1 & SD_OCR_ADDR_MISALIGNED)
;;;2198     {
;;;2199       return(SD_ADDR_MISALIGNED);
;;;2200     }
;;;2201   
;;;2202     if (response_r1 & SD_OCR_BLOCK_LEN_ERR)
;;;2203     {
;;;2204       return(SD_BLOCK_LEN_ERR);
;;;2205     }
;;;2206   
;;;2207     if (response_r1 & SD_OCR_ERASE_SEQ_ERR)
;;;2208     {
;;;2209       return(SD_ERASE_SEQ_ERR);
;;;2210     }
;;;2211   
;;;2212     if (response_r1 & SD_OCR_BAD_ERASE_PARAM)
;;;2213     {
;;;2214       return(SD_BAD_ERASE_PARAM);
;;;2215     }
;;;2216   
;;;2217     if (response_r1 & SD_OCR_WRITE_PROT_VIOLATION)
;;;2218     {
;;;2219       return(SD_WRITE_PROT_VIOLATION);
;;;2220     }
;;;2221   
;;;2222     if (response_r1 & SD_OCR_LOCK_UNLOCK_FAILED)
;;;2223     {
;;;2224       return(SD_LOCK_UNLOCK_FAILED);
;;;2225     }
;;;2226   
;;;2227     if (response_r1 & SD_OCR_COM_CRC_FAILED)
;;;2228     {
;;;2229       return(SD_COM_CRC_FAILED);
;;;2230     }
;;;2231   
;;;2232     if (response_r1 & SD_OCR_ILLEGAL_CMD)
;;;2233     {
;;;2234       return(SD_ILLEGAL_CMD);
;;;2235     }
;;;2236   
;;;2237     if (response_r1 & SD_OCR_CARD_ECC_FAILED)
;;;2238     {
;;;2239       return(SD_CARD_ECC_FAILED);
;;;2240     }
;;;2241   
;;;2242     if (response_r1 & SD_OCR_CC_ERROR)
;;;2243     {
;;;2244       return(SD_CC_ERROR);
;;;2245     }
;;;2246   
;;;2247     if (response_r1 & SD_OCR_GENERAL_UNKNOWN_ERROR)
;;;2248     {
;;;2249       return(SD_GENERAL_UNKNOWN_ERROR);
;;;2250     }
;;;2251   
;;;2252     if (response_r1 & SD_OCR_STREAM_READ_UNDERRUN)
;;;2253     {
;;;2254       return(SD_STREAM_READ_UNDERRUN);
;;;2255     }
;;;2256   
;;;2257     if (response_r1 & SD_OCR_STREAM_WRITE_OVERRUN)
;;;2258     {
;;;2259       return(SD_STREAM_WRITE_OVERRUN);
;;;2260     }
;;;2261   
;;;2262     if (response_r1 & SD_OCR_CID_CSD_OVERWRIETE)
;;;2263     {
;;;2264       return(SD_CID_CSD_OVERWRITE);
;;;2265     }
;;;2266   
;;;2267     if (response_r1 & SD_OCR_WP_ERASE_SKIP)
;;;2268     {
;;;2269       return(SD_WP_ERASE_SKIP);
;;;2270     }
;;;2271   
;;;2272     if (response_r1 & SD_OCR_CARD_ECC_DISABLED)
;;;2273     {
;;;2274       return(SD_CARD_ECC_DISABLED);
;;;2275     }
;;;2276   
;;;2277     if (response_r1 & SD_OCR_ERASE_RESET)
;;;2278     {
;;;2279       return(SD_ERASE_RESET);
;;;2280     }
;;;2281   
;;;2282     if (response_r1 & SD_OCR_AKE_SEQ_ERROR)
;;;2283     {
;;;2284       return(SD_AKE_SEQ_ERROR);
;;;2285     }
;;;2286     return(errorstatus);
;;;2287   }
00004a  bd70              POP      {r4-r6,pc}
                  |L1.76|
00004c  0041              LSLS     r1,r0,#1              ;2197
00004e  d501              BPL      |L1.84|
000050  2009              MOVS     r0,#9                 ;2199
000052  bd70              POP      {r4-r6,pc}
                  |L1.84|
000054  0081              LSLS     r1,r0,#2
000056  d501              BPL      |L1.92|
000058  200a              MOVS     r0,#0xa               ;2204
00005a  bd70              POP      {r4-r6,pc}
                  |L1.92|
00005c  00c1              LSLS     r1,r0,#3
00005e  d501              BPL      |L1.100|
000060  200b              MOVS     r0,#0xb               ;2209
000062  bd70              POP      {r4-r6,pc}
                  |L1.100|
000064  0101              LSLS     r1,r0,#4
000066  d501              BPL      |L1.108|
000068  200c              MOVS     r0,#0xc               ;2214
00006a  bd70              POP      {r4-r6,pc}
                  |L1.108|
00006c  0141              LSLS     r1,r0,#5              ;2217
00006e  d501              BPL      |L1.116|
000070  200d              MOVS     r0,#0xd               ;2219
000072  bd70              POP      {r4-r6,pc}
                  |L1.116|
000074  01c1              LSLS     r1,r0,#7              ;2222
000076  d501              BPL      |L1.124|
000078  200e              MOVS     r0,#0xe               ;2224
00007a  bd70              POP      {r4-r6,pc}
                  |L1.124|
00007c  0201              LSLS     r1,r0,#8              ;2227
00007e  d501              BPL      |L1.132|
000080  200f              MOVS     r0,#0xf               ;2229
000082  bd70              POP      {r4-r6,pc}
                  |L1.132|
000084  0241              LSLS     r1,r0,#9              ;2232
000086  d501              BPL      |L1.140|
                  |L1.136|
000088  2010              MOVS     r0,#0x10              ;2234
00008a  bd70              POP      {r4-r6,pc}
                  |L1.140|
00008c  0281              LSLS     r1,r0,#10             ;2237
00008e  d501              BPL      |L1.148|
000090  2011              MOVS     r0,#0x11              ;2239
000092  bd70              POP      {r4-r6,pc}
                  |L1.148|
000094  02c1              LSLS     r1,r0,#11             ;2242
000096  d501              BPL      |L1.156|
000098  2012              MOVS     r0,#0x12              ;2244
00009a  bd70              POP      {r4-r6,pc}
                  |L1.156|
00009c  0301              LSLS     r1,r0,#12             ;2247
00009e  d501              BPL      |L1.164|
0000a0  2013              MOVS     r0,#0x13              ;2249
0000a2  bd70              POP      {r4-r6,pc}
                  |L1.164|
0000a4  0341              LSLS     r1,r0,#13             ;2252
0000a6  d501              BPL      |L1.172|
0000a8  2014              MOVS     r0,#0x14              ;2254
0000aa  bd70              POP      {r4-r6,pc}
                  |L1.172|
0000ac  0381              LSLS     r1,r0,#14             ;2257
0000ae  d501              BPL      |L1.180|
0000b0  2015              MOVS     r0,#0x15              ;2259
0000b2  bd70              POP      {r4-r6,pc}
                  |L1.180|
0000b4  03c1              LSLS     r1,r0,#15             ;2262
0000b6  d501              BPL      |L1.188|
0000b8  2016              MOVS     r0,#0x16              ;2264
0000ba  bd70              POP      {r4-r6,pc}
                  |L1.188|
0000bc  0401              LSLS     r1,r0,#16             ;2267
0000be  d501              BPL      |L1.196|
0000c0  2017              MOVS     r0,#0x17              ;2269
0000c2  bd70              POP      {r4-r6,pc}
                  |L1.196|
0000c4  0441              LSLS     r1,r0,#17             ;2272
0000c6  d501              BPL      |L1.204|
0000c8  2018              MOVS     r0,#0x18              ;2274
0000ca  bd70              POP      {r4-r6,pc}
                  |L1.204|
0000cc  0481              LSLS     r1,r0,#18             ;2277
0000ce  d501              BPL      |L1.212|
0000d0  2019              MOVS     r0,#0x19              ;2279
0000d2  bd70              POP      {r4-r6,pc}
                  |L1.212|
0000d4  0700              LSLS     r0,r0,#28             ;2282
0000d6  d501              BPL      |L1.220|
0000d8  201a              MOVS     r0,#0x1a              ;2284
0000da  bd70              POP      {r4-r6,pc}
                  |L1.220|
0000dc  4620              MOV      r0,r4                 ;2286
0000de  bd70              POP      {r4-r6,pc}
;;;2288   
                          ENDP

                  |L1.224|
                          DCD      0x40018000
                  |L1.228|
                          DCD      0xfdffe008

                          AREA ||i.CmdResp2Error||, CODE, READONLY, ALIGN=2

                  CmdResp2Error PROC
;;;2321     */
;;;2322   static SD_Error CmdResp2Error(void)
000000  b510              PUSH     {r4,lr}
;;;2323   {
;;;2324     SD_Error errorstatus = SD_OK;
;;;2325     uint32_t status;
;;;2326   
;;;2327     status = SDIO->STA;
000002  480b              LDR      r0,|L2.48|
000004  2400              MOVS     r4,#0                 ;2324
                  |L2.6|
;;;2328   
;;;2329     while (!(status & (SDIO_FLAG_CCRCFAIL | SDIO_FLAG_CTIMEOUT | SDIO_FLAG_CMDREND)))
;;;2330     {
;;;2331       status = SDIO->STA;
000006  6b41              LDR      r1,[r0,#0x34]
000008  f0110f45          TST      r1,#0x45              ;2329
00000c  d0fb              BEQ      |L2.6|
;;;2332     }
;;;2333   
;;;2334     if (status & SDIO_FLAG_CTIMEOUT)
00000e  0748              LSLS     r0,r1,#29
000010  d502              BPL      |L2.24|
;;;2335     {
;;;2336       errorstatus = SD_CMD_RSP_TIMEOUT;
000012  2403              MOVS     r4,#3
;;;2337       SDIO_ClearFlag(SDIO_FLAG_CTIMEOUT);
000014  2004              MOVS     r0,#4
;;;2338       return(errorstatus);
000016  e003              B        |L2.32|
                  |L2.24|
;;;2339     }
;;;2340     else if (status & SDIO_FLAG_CCRCFAIL)
000018  07c8              LSLS     r0,r1,#31
00001a  d005              BEQ      |L2.40|
;;;2341     {
;;;2342       errorstatus = SD_CMD_CRC_FAIL;
00001c  2401              MOVS     r4,#1
;;;2343       SDIO_ClearFlag(SDIO_FLAG_CCRCFAIL);
00001e  4620              MOV      r0,r4
                  |L2.32|
;;;2344       return(errorstatus);
;;;2345     }
;;;2346   
;;;2347     /*!< Clear all the static flags */
;;;2348     SDIO_ClearFlag(SDIO_STATIC_FLAGS);
000020  f7fffffe          BL       SDIO_ClearFlag
;;;2349   
;;;2350     return(errorstatus);
000024  4620              MOV      r0,r4
;;;2351   }
000026  bd10              POP      {r4,pc}
                  |L2.40|
000028  f24050ff          MOV      r0,#0x5ff             ;2348
00002c  e7f8              B        |L2.32|
;;;2352   
                          ENDP

00002e  0000              DCW      0x0000
                  |L2.48|
                          DCD      0x40018000

                          AREA ||i.CmdResp6Error||, CODE, READONLY, ALIGN=2

                  CmdResp6Error PROC
;;;2359     */
;;;2360   static SD_Error CmdResp6Error(uint8_t cmd, uint16_t *prca)
000000  b570              PUSH     {r4-r6,lr}
;;;2361   {
000002  460c              MOV      r4,r1
;;;2362     SD_Error errorstatus = SD_OK;
;;;2363     uint32_t status;
;;;2364     uint32_t response_r1;
;;;2365   
;;;2366     status = SDIO->STA;
000004  4919              LDR      r1,|L3.108|
000006  4606              MOV      r6,r0                 ;2361
000008  2500              MOVS     r5,#0                 ;2362
                  |L3.10|
;;;2367   
;;;2368     while (!(status & (SDIO_FLAG_CCRCFAIL | SDIO_FLAG_CTIMEOUT | SDIO_FLAG_CMDREND)))
;;;2369     {
;;;2370       status = SDIO->STA;
00000a  6b48              LDR      r0,[r1,#0x34]
00000c  f0100f45          TST      r0,#0x45              ;2368
000010  d0fb              BEQ      |L3.10|
;;;2371     }
;;;2372   
;;;2373     if (status & SDIO_FLAG_CTIMEOUT)
000012  0741              LSLS     r1,r0,#29
000014  d502              BPL      |L3.28|
;;;2374     {
;;;2375       errorstatus = SD_CMD_RSP_TIMEOUT;
000016  2403              MOVS     r4,#3
;;;2376       SDIO_ClearFlag(SDIO_FLAG_CTIMEOUT);
000018  2004              MOVS     r0,#4
;;;2377       return(errorstatus);
00001a  e003              B        |L3.36|
                  |L3.28|
;;;2378     }
;;;2379     else if (status & SDIO_FLAG_CCRCFAIL)
00001c  07c0              LSLS     r0,r0,#31
00001e  d005              BEQ      |L3.44|
;;;2380     {
;;;2381       errorstatus = SD_CMD_CRC_FAIL;
000020  2401              MOVS     r4,#1
;;;2382       SDIO_ClearFlag(SDIO_FLAG_CCRCFAIL);
000022  4620              MOV      r0,r4
                  |L3.36|
000024  f7fffffe          BL       SDIO_ClearFlag
;;;2383       return(errorstatus);
000028  4620              MOV      r0,r4
;;;2384     }
;;;2385   
;;;2386     /*!< Check response received is of desired command */
;;;2387     if (SDIO_GetCommandResponse() != cmd)
;;;2388     {
;;;2389       errorstatus = SD_ILLEGAL_CMD;
;;;2390       return(errorstatus);
;;;2391     }
;;;2392   
;;;2393     /*!< Clear all the static flags */
;;;2394     SDIO_ClearFlag(SDIO_STATIC_FLAGS);
;;;2395   
;;;2396     /*!< We have received response, retrieve it.  */
;;;2397     response_r1 = SDIO_GetResponse(SDIO_RESP1);
;;;2398   
;;;2399     if (SD_ALLZERO == (response_r1 & (SD_R6_GENERAL_UNKNOWN_ERROR | SD_R6_ILLEGAL_CMD | SD_R6_COM_CRC_FAILED)))
;;;2400     {
;;;2401       *prca = (uint16_t) (response_r1 >> 16);
;;;2402       return(errorstatus);
;;;2403     }
;;;2404   
;;;2405     if (response_r1 & SD_R6_GENERAL_UNKNOWN_ERROR)
;;;2406     {
;;;2407       return(SD_GENERAL_UNKNOWN_ERROR);
;;;2408     }
;;;2409   
;;;2410     if (response_r1 & SD_R6_ILLEGAL_CMD)
;;;2411     {
;;;2412       return(SD_ILLEGAL_CMD);
;;;2413     }
;;;2414   
;;;2415     if (response_r1 & SD_R6_COM_CRC_FAILED)
;;;2416     {
;;;2417       return(SD_COM_CRC_FAILED);
;;;2418     }
;;;2419   
;;;2420     return(errorstatus);
;;;2421   }
00002a  bd70              POP      {r4-r6,pc}
                  |L3.44|
00002c  f7fffffe          BL       SDIO_GetCommandResponse
000030  42b0              CMP      r0,r6                 ;2387
000032  d112              BNE      |L3.90|
000034  f24050ff          MOV      r0,#0x5ff             ;2394
000038  f7fffffe          BL       SDIO_ClearFlag
00003c  2000              MOVS     r0,#0                 ;2397
00003e  f7fffffe          BL       SDIO_GetResponse
000042  f4104f60          TST      r0,#0xe000            ;2399
000046  d003              BEQ      |L3.80|
000048  0481              LSLS     r1,r0,#18             ;2405
00004a  d504              BPL      |L3.86|
00004c  2013              MOVS     r0,#0x13              ;2407
00004e  bd70              POP      {r4-r6,pc}
                  |L3.80|
000050  0c00              LSRS     r0,r0,#16             ;2401
000052  8020              STRH     r0,[r4,#0]            ;2401
000054  e007              B        |L3.102|
                  |L3.86|
000056  0441              LSLS     r1,r0,#17             ;2410
000058  d501              BPL      |L3.94|
                  |L3.90|
00005a  2010              MOVS     r0,#0x10              ;2412
00005c  bd70              POP      {r4-r6,pc}
                  |L3.94|
00005e  0400              LSLS     r0,r0,#16             ;2415
000060  d501              BPL      |L3.102|
000062  200f              MOVS     r0,#0xf               ;2417
000064  bd70              POP      {r4-r6,pc}
                  |L3.102|
000066  4628              MOV      r0,r5                 ;2420
000068  bd70              POP      {r4-r6,pc}
;;;2422   
                          ENDP

00006a  0000              DCW      0x0000
                  |L3.108|
                          DCD      0x40018000

                          AREA ||i.DMA2_Channel4_5_IRQHandler||, CODE, READONLY, ALIGN=1

                  DMA2_Channel4_5_IRQHandler PROC
;;;3054   */
;;;3055   void SD_SDIO_DMA_IRQHANDLER(void)
000000  f7ffbffe          B.W      SD_ProcessDMAIRQ
;;;3056   {	
;;;3057   	/* ¥¶¿ÌDMA÷–∂œ */
;;;3058   	SD_ProcessDMAIRQ();	
;;;3059   }
;;;3060   
                          ENDP


                          AREA ||i.FindSCR||, CODE, READONLY, ALIGN=2

                  FindSCR PROC
;;;2701     */
;;;2702   static SD_Error FindSCR(uint16_t rca, uint32_t *pscr)
000000  e92d5ffc          PUSH     {r2-r12,lr}
;;;2703   {
;;;2704     uint32_t index = 0;
000004  2500              MOVS     r5,#0
;;;2705     SD_Error errorstatus = SD_OK;
;;;2706     uint32_t tempscr[2] = {0, 0};
;;;2707   
;;;2708     /*!< Set Block Size To 8 Bytes */
;;;2709     /*!< Send CMD55 APP_CMD with argument as card's RCA */
;;;2710     SDIO_CmdInitStructure.SDIO_Argument = (uint32_t)8;
000006  4c48              LDR      r4,|L5.296|
000008  9500              STR      r5,[sp,#0]            ;2706
;;;2711     SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_SET_BLOCKLEN;
;;;2712     SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
;;;2713     SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;2714     SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
00000a  f44f6880          MOV      r8,#0x400
00000e  9501              STR      r5,[sp,#4]
000010  2740              MOVS     r7,#0x40              ;2712
000012  f8c48010          STR      r8,[r4,#0x10]  ; SDIO_CmdInitStructure
000016  e9c47502          STRD     r7,r5,[r4,#8]
00001a  460e              MOV      r6,r1                 ;2703
00001c  f04f0b08          MOV      r11,#8                ;2710
000020  2110              MOVS     r1,#0x10              ;2711
;;;2715     SDIO_SendCommand(&SDIO_CmdInitStructure);
000022  e9c4b100          STRD     r11,r1,[r4,#0]
000026  46a9              MOV      r9,r5                 ;2706
000028  4620              MOV      r0,r4
00002a  f7fffffe          BL       SDIO_SendCommand
;;;2716   
;;;2717     errorstatus = CmdResp1Error(SD_CMD_SET_BLOCKLEN);
00002e  2010              MOVS     r0,#0x10
000030  f7fffffe          BL       CmdResp1Error
;;;2718   
;;;2719     if (errorstatus != SD_OK)
000034  2800              CMP      r0,#0
000036  d14c              BNE      |L5.210|
;;;2720     {
;;;2721       return(errorstatus);
;;;2722     }
;;;2723   
;;;2724     /*!< Send CMD55 APP_CMD with argument as card's RCA */
;;;2725     SDIO_CmdInitStructure.SDIO_Argument = (uint32_t) RCA << 16;
000038  483c              LDR      r0,|L5.300|
;;;2726     SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_APP_CMD;
;;;2727     SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
00003a  46ba              MOV      r10,r7
;;;2728     SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
00003c  464f              MOV      r7,r9
00003e  8900              LDRH     r0,[r0,#8]            ;2725  ; RCA
000040  0400              LSLS     r0,r0,#16             ;2725
000042  6020              STR      r0,[r4,#0]            ;2726  ; SDIO_CmdInitStructure
000044  2037              MOVS     r0,#0x37              ;2726
000046  e9c40a01          STRD     r0,r10,[r4,#4]
;;;2729     SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
;;;2730     SDIO_SendCommand(&SDIO_CmdInitStructure);
00004a  e9c49803          STRD     r9,r8,[r4,#0xc]
00004e  4620              MOV      r0,r4
000050  f7fffffe          BL       SDIO_SendCommand
;;;2731   
;;;2732     errorstatus = CmdResp1Error(SD_CMD_APP_CMD);
000054  2037              MOVS     r0,#0x37
000056  f7fffffe          BL       CmdResp1Error
;;;2733   
;;;2734     if (errorstatus != SD_OK)
00005a  2800              CMP      r0,#0
00005c  d139              BNE      |L5.210|
;;;2735     {
;;;2736       return(errorstatus);
;;;2737     }
;;;2738     SDIO_DataInitStructure.SDIO_DataTimeOut = SD_DATATIMEOUT;
00005e  f1040014          ADD      r0,r4,#0x14
000062  4933              LDR      r1,|L5.304|
000064  e9c01b00          STRD     r1,r11,[r0,#0]
;;;2739     SDIO_DataInitStructure.SDIO_DataLength = 8;
;;;2740     SDIO_DataInitStructure.SDIO_DataBlockSize = SDIO_DataBlockSize_8b;
000068  2130              MOVS     r1,#0x30
;;;2741     SDIO_DataInitStructure.SDIO_TransferDir = SDIO_TransferDir_ToSDIO;
00006a  6081              STR      r1,[r0,#8]  ; SDIO_DataInitStructure
00006c  2102              MOVS     r1,#2
00006e  e9c01703          STRD     r1,r7,[r0,#0xc]
;;;2742     SDIO_DataInitStructure.SDIO_TransferMode = SDIO_TransferMode_Block;
;;;2743     SDIO_DataInitStructure.SDIO_DPSM = SDIO_DPSM_Enable;
000072  2101              MOVS     r1,#1
;;;2744     SDIO_DataConfig(&SDIO_DataInitStructure);
000074  6141              STR      r1,[r0,#0x14]  ; SDIO_DataInitStructure
000076  f7fffffe          BL       SDIO_DataConfig
;;;2745   
;;;2746   
;;;2747     /*!< Send ACMD51 SD_APP_SEND_SCR with argument as 0 */
;;;2748     SDIO_CmdInitStructure.SDIO_Argument = 0x0;
;;;2749     SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_SD_APP_SEND_SCR;
00007a  2033              MOVS     r0,#0x33
;;;2750     SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
00007c  f8c4a008          STR      r10,[r4,#8]  ; SDIO_CmdInitStructure
000080  e9c47000          STRD     r7,r0,[r4,#0]
000084  e9c47803          STRD     r7,r8,[r4,#0xc]
;;;2751     SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;2752     SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
;;;2753     SDIO_SendCommand(&SDIO_CmdInitStructure);
000088  4620              MOV      r0,r4
00008a  f7fffffe          BL       SDIO_SendCommand
;;;2754   
;;;2755     errorstatus = CmdResp1Error(SD_CMD_SD_APP_SEND_SCR);
00008e  2033              MOVS     r0,#0x33
000090  f7fffffe          BL       CmdResp1Error
000094  0004              MOVS     r4,r0
;;;2756   
;;;2757     if (errorstatus != SD_OK)
000096  d11c              BNE      |L5.210|
;;;2758     {
;;;2759       return(errorstatus);
;;;2760     }
;;;2761   
;;;2762     while (!(SDIO->STA & (SDIO_FLAG_RXOVERR | SDIO_FLAG_DCRCFAIL | SDIO_FLAG_DTIMEOUT | SDIO_FLAG_DBCKEND | SDIO_FLAG_STBITERR)))
000098  4f26              LDR      r7,|L5.308|
;;;2763     {
;;;2764       if (SDIO_GetFlagStatus(SDIO_FLAG_RXDAVL) != RESET)
00009a  f44f1a00          MOV      r10,#0x200000
00009e  46e9              MOV      r9,sp                 ;2706
0000a0  f240682a          MOV      r8,#0x62a             ;2762
                  |L5.164|
0000a4  6b78              LDR      r0,[r7,#0x34]         ;2762
0000a6  ea100f08          TST      r0,r8                 ;2762
0000aa  d10a              BNE      |L5.194|
0000ac  4650              MOV      r0,r10
0000ae  f7fffffe          BL       SDIO_GetFlagStatus
0000b2  2800              CMP      r0,#0
0000b4  d0f6              BEQ      |L5.164|
;;;2765       {
;;;2766         *(tempscr + index) = SDIO_ReadData();
0000b6  f7fffffe          BL       SDIO_ReadData
0000ba  f8490025          STR      r0,[r9,r5,LSL #2]
0000be  1c6d              ADDS     r5,r5,#1
;;;2767         index++;
0000c0  e7f0              B        |L5.164|
                  |L5.194|
;;;2768       }
;;;2769     }
;;;2770   
;;;2771     if (SDIO_GetFlagStatus(SDIO_FLAG_DTIMEOUT) != RESET)
0000c2  2008              MOVS     r0,#8
0000c4  f7fffffe          BL       SDIO_GetFlagStatus
0000c8  b128              CBZ      r0,|L5.214|
;;;2772     {
;;;2773       SDIO_ClearFlag(SDIO_FLAG_DTIMEOUT);
0000ca  2008              MOVS     r0,#8
0000cc  f7fffffe          BL       SDIO_ClearFlag
;;;2774       errorstatus = SD_DATA_TIMEOUT;
0000d0  2004              MOVS     r0,#4
                  |L5.210|
;;;2775       return(errorstatus);
;;;2776     }
;;;2777     else if (SDIO_GetFlagStatus(SDIO_FLAG_DCRCFAIL) != RESET)
;;;2778     {
;;;2779       SDIO_ClearFlag(SDIO_FLAG_DCRCFAIL);
;;;2780       errorstatus = SD_DATA_CRC_FAIL;
;;;2781       return(errorstatus);
;;;2782     }
;;;2783     else if (SDIO_GetFlagStatus(SDIO_FLAG_RXOVERR) != RESET)
;;;2784     {
;;;2785       SDIO_ClearFlag(SDIO_FLAG_RXOVERR);
;;;2786       errorstatus = SD_RX_OVERRUN;
;;;2787       return(errorstatus);
;;;2788     }
;;;2789     else if (SDIO_GetFlagStatus(SDIO_FLAG_STBITERR) != RESET)
;;;2790     {
;;;2791       SDIO_ClearFlag(SDIO_FLAG_STBITERR);
;;;2792       errorstatus = SD_START_BIT_ERR;
;;;2793       return(errorstatus);
;;;2794     }
;;;2795   
;;;2796     /*!< Clear all the static flags */
;;;2797     SDIO_ClearFlag(SDIO_STATIC_FLAGS);
;;;2798   
;;;2799     *(pscr + 1) = ((tempscr[0] & SD_0TO7BITS) << 24) | ((tempscr[0] & SD_8TO15BITS) << 8) | ((tempscr[0] & SD_16TO23BITS) >> 8) | ((tempscr[0] & SD_24TO31BITS) >> 24);
;;;2800   
;;;2801     *(pscr) = ((tempscr[1] & SD_0TO7BITS) << 24) | ((tempscr[1] & SD_8TO15BITS) << 8) | ((tempscr[1] & SD_16TO23BITS) >> 8) | ((tempscr[1] & SD_24TO31BITS) >> 24);
;;;2802   
;;;2803     return(errorstatus);
;;;2804   }
0000d2  e8bd9ffc          POP      {r2-r12,pc}
                  |L5.214|
0000d6  2002              MOVS     r0,#2                 ;2777
0000d8  f7fffffe          BL       SDIO_GetFlagStatus
0000dc  b120              CBZ      r0,|L5.232|
0000de  2002              MOVS     r0,#2                 ;2779
0000e0  f7fffffe          BL       SDIO_ClearFlag
0000e4  2002              MOVS     r0,#2                 ;2780
0000e6  e7f4              B        |L5.210|
                  |L5.232|
0000e8  2020              MOVS     r0,#0x20              ;2783
0000ea  f7fffffe          BL       SDIO_GetFlagStatus
0000ee  b120              CBZ      r0,|L5.250|
0000f0  2020              MOVS     r0,#0x20              ;2785
0000f2  f7fffffe          BL       SDIO_ClearFlag
0000f6  2006              MOVS     r0,#6                 ;2786
0000f8  e7eb              B        |L5.210|
                  |L5.250|
0000fa  f44f7500          MOV      r5,#0x200             ;2789
0000fe  4628              MOV      r0,r5                 ;2789
000100  f7fffffe          BL       SDIO_GetFlagStatus
000104  b120              CBZ      r0,|L5.272|
000106  4628              MOV      r0,r5                 ;2791
000108  f7fffffe          BL       SDIO_ClearFlag
00010c  2007              MOVS     r0,#7                 ;2792
00010e  e7e0              B        |L5.210|
                  |L5.272|
000110  f24050ff          MOV      r0,#0x5ff             ;2797
000114  f7fffffe          BL       SDIO_ClearFlag
000118  9800              LDR      r0,[sp,#0]            ;2799
00011a  ba00              REV      r0,r0                 ;2799
00011c  6070              STR      r0,[r6,#4]            ;2801
00011e  9801              LDR      r0,[sp,#4]            ;2801
000120  ba00              REV      r0,r0                 ;2801
000122  6030              STR      r0,[r6,#0]            ;2803
000124  4620              MOV      r0,r4                 ;2803
000126  e7d4              B        |L5.210|
;;;2805   
                          ENDP

                  |L5.296|
                          DCD      ||.bss||+0xa0
                  |L5.300|
                          DCD      ||.data||
                  |L5.304|
                          DCD      0x000fffff
                  |L5.308|
                          DCD      0x40018000

                          AREA ||i.IsCardProgramming||, CODE, READONLY, ALIGN=2

                  IsCardProgramming PROC
;;;2542     */
;;;2543   static SD_Error IsCardProgramming(uint8_t *pstatus)
000000  b57c              PUSH     {r2-r6,lr}
;;;2544   {
000002  4604              MOV      r4,r0
;;;2545     SD_Error errorstatus = SD_OK;
000004  2500              MOVS     r5,#0
;;;2546     __IO uint32_t respR1 = 0, status = 0;
;;;2547   
;;;2548     SDIO_CmdInitStructure.SDIO_Argument = (uint32_t) RCA << 16;
000006  484d              LDR      r0,|L6.316|
000008  9500              STR      r5,[sp,#0]            ;2546
00000a  9501              STR      r5,[sp,#4]
00000c  8900              LDRH     r0,[r0,#8]  ; RCA
00000e  494c              LDR      r1,|L6.320|
000010  0400              LSLS     r0,r0,#16
;;;2549     SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_SEND_STATUS;
000012  6008              STR      r0,[r1,#0]  ; SDIO_CmdInitStructure
000014  200d              MOVS     r0,#0xd
;;;2550     SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
000016  6048              STR      r0,[r1,#4]  ; SDIO_CmdInitStructure
000018  2040              MOVS     r0,#0x40
00001a  e9c10502          STRD     r0,r5,[r1,#8]
;;;2551     SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;2552     SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
00001e  0100              LSLS     r0,r0,#4
;;;2553     SDIO_SendCommand(&SDIO_CmdInitStructure);
000020  6108              STR      r0,[r1,#0x10]  ; SDIO_CmdInitStructure
000022  4608              MOV      r0,r1
000024  f7fffffe          BL       SDIO_SendCommand
;;;2554   
;;;2555     status = SDIO->STA;
000028  4846              LDR      r0,|L6.324|
                  |L6.42|
;;;2556     while (!(status & (SDIO_FLAG_CCRCFAIL | SDIO_FLAG_CMDREND | SDIO_FLAG_CTIMEOUT)))
;;;2557     {
;;;2558       status = SDIO->STA;
00002a  6b41              LDR      r1,[r0,#0x34]
00002c  9101              STR      r1,[sp,#4]
00002e  f0110f45          TST      r1,#0x45              ;2556
000032  d0fa              BEQ      |L6.42|
;;;2559     }
;;;2560   
;;;2561     if (status & SDIO_FLAG_CTIMEOUT)
000034  9801              LDR      r0,[sp,#4]
000036  0740              LSLS     r0,r0,#29
000038  d502              BPL      |L6.64|
;;;2562     {
;;;2563       errorstatus = SD_CMD_RSP_TIMEOUT;
00003a  2403              MOVS     r4,#3
;;;2564       SDIO_ClearFlag(SDIO_FLAG_CTIMEOUT);
00003c  2004              MOVS     r0,#4
;;;2565       return(errorstatus);
00003e  e004              B        |L6.74|
                  |L6.64|
;;;2566     }
;;;2567     else if (status & SDIO_FLAG_CCRCFAIL)
000040  9801              LDR      r0,[sp,#4]
000042  07c0              LSLS     r0,r0,#31
000044  d005              BEQ      |L6.82|
;;;2568     {
;;;2569       errorstatus = SD_CMD_CRC_FAIL;
000046  2401              MOVS     r4,#1
;;;2570       SDIO_ClearFlag(SDIO_FLAG_CCRCFAIL);
000048  4620              MOV      r0,r4
                  |L6.74|
00004a  f7fffffe          BL       SDIO_ClearFlag
;;;2571       return(errorstatus);
00004e  4620              MOV      r0,r4
;;;2572     }
;;;2573   
;;;2574     status = (uint32_t)SDIO_GetCommandResponse();
;;;2575   
;;;2576     /*!< Check response received is of desired command */
;;;2577     if (status != SD_CMD_SEND_STATUS)
;;;2578     {
;;;2579       errorstatus = SD_ILLEGAL_CMD;
;;;2580       return(errorstatus);
;;;2581     }
;;;2582   
;;;2583     /*!< Clear all the static flags */
;;;2584     SDIO_ClearFlag(SDIO_STATIC_FLAGS);
;;;2585   
;;;2586   
;;;2587     /*!< We have received response, retrieve it for analysis  */
;;;2588     respR1 = SDIO_GetResponse(SDIO_RESP1);
;;;2589   
;;;2590     /*!< Find out card status */
;;;2591     *pstatus = (uint8_t) ((respR1 >> 9) & 0x0000000F);
;;;2592   
;;;2593     if ((respR1 & SD_OCR_ERRORBITS) == SD_ALLZERO)
;;;2594     {
;;;2595       return(errorstatus);
;;;2596     }
;;;2597   
;;;2598     if (respR1 & SD_OCR_ADDR_OUT_OF_RANGE)
;;;2599     {
;;;2600       return(SD_ADDR_OUT_OF_RANGE);
;;;2601     }
;;;2602   
;;;2603     if (respR1 & SD_OCR_ADDR_MISALIGNED)
;;;2604     {
;;;2605       return(SD_ADDR_MISALIGNED);
;;;2606     }
;;;2607   
;;;2608     if (respR1 & SD_OCR_BLOCK_LEN_ERR)
;;;2609     {
;;;2610       return(SD_BLOCK_LEN_ERR);
;;;2611     }
;;;2612   
;;;2613     if (respR1 & SD_OCR_ERASE_SEQ_ERR)
;;;2614     {
;;;2615       return(SD_ERASE_SEQ_ERR);
;;;2616     }
;;;2617   
;;;2618     if (respR1 & SD_OCR_BAD_ERASE_PARAM)
;;;2619     {
;;;2620       return(SD_BAD_ERASE_PARAM);
;;;2621     }
;;;2622   
;;;2623     if (respR1 & SD_OCR_WRITE_PROT_VIOLATION)
;;;2624     {
;;;2625       return(SD_WRITE_PROT_VIOLATION);
;;;2626     }
;;;2627   
;;;2628     if (respR1 & SD_OCR_LOCK_UNLOCK_FAILED)
;;;2629     {
;;;2630       return(SD_LOCK_UNLOCK_FAILED);
;;;2631     }
;;;2632   
;;;2633     if (respR1 & SD_OCR_COM_CRC_FAILED)
;;;2634     {
;;;2635       return(SD_COM_CRC_FAILED);
;;;2636     }
;;;2637   
;;;2638     if (respR1 & SD_OCR_ILLEGAL_CMD)
;;;2639     {
;;;2640       return(SD_ILLEGAL_CMD);
;;;2641     }
;;;2642   
;;;2643     if (respR1 & SD_OCR_CARD_ECC_FAILED)
;;;2644     {
;;;2645       return(SD_CARD_ECC_FAILED);
;;;2646     }
;;;2647   
;;;2648     if (respR1 & SD_OCR_CC_ERROR)
;;;2649     {
;;;2650       return(SD_CC_ERROR);
;;;2651     }
;;;2652   
;;;2653     if (respR1 & SD_OCR_GENERAL_UNKNOWN_ERROR)
;;;2654     {
;;;2655       return(SD_GENERAL_UNKNOWN_ERROR);
;;;2656     }
;;;2657   
;;;2658     if (respR1 & SD_OCR_STREAM_READ_UNDERRUN)
;;;2659     {
;;;2660       return(SD_STREAM_READ_UNDERRUN);
;;;2661     }
;;;2662   
;;;2663     if (respR1 & SD_OCR_STREAM_WRITE_OVERRUN)
;;;2664     {
;;;2665       return(SD_STREAM_WRITE_OVERRUN);
;;;2666     }
;;;2667   
;;;2668     if (respR1 & SD_OCR_CID_CSD_OVERWRIETE)
;;;2669     {
;;;2670       return(SD_CID_CSD_OVERWRITE);
;;;2671     }
;;;2672   
;;;2673     if (respR1 & SD_OCR_WP_ERASE_SKIP)
;;;2674     {
;;;2675       return(SD_WP_ERASE_SKIP);
;;;2676     }
;;;2677   
;;;2678     if (respR1 & SD_OCR_CARD_ECC_DISABLED)
;;;2679     {
;;;2680       return(SD_CARD_ECC_DISABLED);
;;;2681     }
;;;2682   
;;;2683     if (respR1 & SD_OCR_ERASE_RESET)
;;;2684     {
;;;2685       return(SD_ERASE_RESET);
;;;2686     }
;;;2687   
;;;2688     if (respR1 & SD_OCR_AKE_SEQ_ERROR)
;;;2689     {
;;;2690       return(SD_AKE_SEQ_ERROR);
;;;2691     }
;;;2692   
;;;2693     return(errorstatus);
;;;2694   }
000050  bd7c              POP      {r2-r6,pc}
                  |L6.82|
000052  f7fffffe          BL       SDIO_GetCommandResponse
000056  9001              STR      r0,[sp,#4]            ;2577
000058  280d              CMP      r0,#0xd               ;2577
00005a  d138              BNE      |L6.206|
00005c  f24050ff          MOV      r0,#0x5ff             ;2584
000060  f7fffffe          BL       SDIO_ClearFlag
000064  2000              MOVS     r0,#0                 ;2588
000066  f7fffffe          BL       SDIO_GetResponse
00006a  9000              STR      r0,[sp,#0]            ;2591
00006c  f3c02043          UBFX     r0,r0,#9,#4           ;2591
000070  7020              STRB     r0,[r4,#0]            ;2591
000072  4935              LDR      r1,|L6.328|
000074  9800              LDR      r0,[sp,#0]            ;2593
000076  4208              TST      r0,r1                 ;2593
000078  d05d              BEQ      |L6.310|
00007a  9800              LDR      r0,[sp,#0]            ;2598
00007c  2800              CMP      r0,#0                 ;2598
00007e  da01              BGE      |L6.132|
000080  201c              MOVS     r0,#0x1c              ;2600
000082  bd7c              POP      {r2-r6,pc}
                  |L6.132|
000084  0040              LSLS     r0,r0,#1              ;2603
000086  d501              BPL      |L6.140|
000088  2009              MOVS     r0,#9                 ;2605
00008a  bd7c              POP      {r2-r6,pc}
                  |L6.140|
00008c  9800              LDR      r0,[sp,#0]            ;2608
00008e  0080              LSLS     r0,r0,#2              ;2608
000090  d501              BPL      |L6.150|
000092  200a              MOVS     r0,#0xa               ;2610
000094  bd7c              POP      {r2-r6,pc}
                  |L6.150|
000096  9800              LDR      r0,[sp,#0]            ;2613
000098  00c0              LSLS     r0,r0,#3              ;2613
00009a  d501              BPL      |L6.160|
00009c  200b              MOVS     r0,#0xb               ;2615
00009e  bd7c              POP      {r2-r6,pc}
                  |L6.160|
0000a0  9800              LDR      r0,[sp,#0]            ;2618
0000a2  0100              LSLS     r0,r0,#4              ;2618
0000a4  d501              BPL      |L6.170|
0000a6  200c              MOVS     r0,#0xc               ;2620
0000a8  bd7c              POP      {r2-r6,pc}
                  |L6.170|
0000aa  9800              LDR      r0,[sp,#0]            ;2623
0000ac  0140              LSLS     r0,r0,#5              ;2623
0000ae  d501              BPL      |L6.180|
0000b0  200d              MOVS     r0,#0xd               ;2625
0000b2  bd7c              POP      {r2-r6,pc}
                  |L6.180|
0000b4  9800              LDR      r0,[sp,#0]            ;2628
0000b6  01c0              LSLS     r0,r0,#7              ;2628
0000b8  d501              BPL      |L6.190|
0000ba  200e              MOVS     r0,#0xe               ;2630
0000bc  bd7c              POP      {r2-r6,pc}
                  |L6.190|
0000be  9800              LDR      r0,[sp,#0]            ;2633
0000c0  0200              LSLS     r0,r0,#8              ;2633
0000c2  d501              BPL      |L6.200|
0000c4  200f              MOVS     r0,#0xf               ;2635
0000c6  bd7c              POP      {r2-r6,pc}
                  |L6.200|
0000c8  9800              LDR      r0,[sp,#0]            ;2638
0000ca  0240              LSLS     r0,r0,#9              ;2638
0000cc  d501              BPL      |L6.210|
                  |L6.206|
0000ce  2010              MOVS     r0,#0x10              ;2640
0000d0  bd7c              POP      {r2-r6,pc}
                  |L6.210|
0000d2  9800              LDR      r0,[sp,#0]            ;2643
0000d4  0280              LSLS     r0,r0,#10             ;2643
0000d6  d501              BPL      |L6.220|
0000d8  2011              MOVS     r0,#0x11              ;2645
0000da  bd7c              POP      {r2-r6,pc}
                  |L6.220|
0000dc  9800              LDR      r0,[sp,#0]            ;2648
0000de  02c0              LSLS     r0,r0,#11             ;2648
0000e0  d501              BPL      |L6.230|
0000e2  2012              MOVS     r0,#0x12              ;2650
0000e4  bd7c              POP      {r2-r6,pc}
                  |L6.230|
0000e6  9800              LDR      r0,[sp,#0]            ;2653
0000e8  0300              LSLS     r0,r0,#12             ;2653
0000ea  d501              BPL      |L6.240|
0000ec  2013              MOVS     r0,#0x13              ;2655
0000ee  bd7c              POP      {r2-r6,pc}
                  |L6.240|
0000f0  9800              LDR      r0,[sp,#0]            ;2658
0000f2  0340              LSLS     r0,r0,#13             ;2658
0000f4  d501              BPL      |L6.250|
0000f6  2014              MOVS     r0,#0x14              ;2660
0000f8  bd7c              POP      {r2-r6,pc}
                  |L6.250|
0000fa  9800              LDR      r0,[sp,#0]            ;2663
0000fc  0380              LSLS     r0,r0,#14             ;2663
0000fe  d501              BPL      |L6.260|
000100  2015              MOVS     r0,#0x15              ;2665
000102  bd7c              POP      {r2-r6,pc}
                  |L6.260|
000104  9800              LDR      r0,[sp,#0]            ;2668
000106  03c0              LSLS     r0,r0,#15             ;2668
000108  d501              BPL      |L6.270|
00010a  2016              MOVS     r0,#0x16              ;2670
00010c  bd7c              POP      {r2-r6,pc}
                  |L6.270|
00010e  9800              LDR      r0,[sp,#0]            ;2673
000110  0400              LSLS     r0,r0,#16             ;2673
000112  d501              BPL      |L6.280|
000114  2017              MOVS     r0,#0x17              ;2675
000116  bd7c              POP      {r2-r6,pc}
                  |L6.280|
000118  9800              LDR      r0,[sp,#0]            ;2678
00011a  0440              LSLS     r0,r0,#17             ;2678
00011c  d501              BPL      |L6.290|
00011e  2018              MOVS     r0,#0x18              ;2680
000120  bd7c              POP      {r2-r6,pc}
                  |L6.290|
000122  9800              LDR      r0,[sp,#0]            ;2683
000124  0480              LSLS     r0,r0,#18             ;2683
000126  d501              BPL      |L6.300|
000128  2019              MOVS     r0,#0x19              ;2685
00012a  bd7c              POP      {r2-r6,pc}
                  |L6.300|
00012c  9800              LDR      r0,[sp,#0]            ;2688
00012e  0700              LSLS     r0,r0,#28             ;2688
000130  d501              BPL      |L6.310|
000132  201a              MOVS     r0,#0x1a              ;2690
000134  bd7c              POP      {r2-r6,pc}
                  |L6.310|
000136  4628              MOV      r0,r5                 ;2693
000138  bd7c              POP      {r2-r6,pc}
;;;2695   
                          ENDP

00013a  0000              DCW      0x0000
                  |L6.316|
                          DCD      ||.data||
                  |L6.320|
                          DCD      ||.bss||+0xa0
                  |L6.324|
                          DCD      0x40018000
                  |L6.328|
                          DCD      0xfdffe008

                          AREA ||i.SDEnWideBus||, CODE, READONLY, ALIGN=2

                  SDEnWideBus PROC
;;;2428     */
;;;2429   static SD_Error SDEnWideBus(FunctionalState NewState)
000000  e92d47fc          PUSH     {r2-r10,lr}
;;;2430   {
;;;2431     SD_Error errorstatus = SD_OK;
;;;2432   
;;;2433     uint32_t scr[2] = {0, 0};
000004  2500              MOVS     r5,#0
000006  4680              MOV      r8,r0                 ;2430
000008  9500              STR      r5,[sp,#0]
;;;2434   
;;;2435     if (SDIO_GetResponse(SDIO_RESP1) & SD_CARD_LOCKED)
00000a  4628              MOV      r0,r5
00000c  9501              STR      r5,[sp,#4]
00000e  f7fffffe          BL       SDIO_GetResponse
000012  0180              LSLS     r0,r0,#6
000014  d502              BPL      |L7.28|
;;;2436     {
;;;2437       errorstatus = SD_LOCK_UNLOCK_FAILED;
000016  200e              MOVS     r0,#0xe
                  |L7.24|
;;;2438       return(errorstatus);
;;;2439     }
;;;2440   
;;;2441     /*!< Get SCR Register */
;;;2442     errorstatus = FindSCR((uint16_t)RCA, scr);
;;;2443   
;;;2444     if (errorstatus != SD_OK)
;;;2445     {
;;;2446       return(errorstatus);
;;;2447     }
;;;2448   
;;;2449     /*!< If wide bus operation to be enabled */
;;;2450     if (NewState == ENABLE)
;;;2451     {
;;;2452       /*!< If requested card supports wide bus operation */
;;;2453       if ((scr[1] & SD_WIDE_BUS_SUPPORT) != SD_ALLZERO)
;;;2454       {
;;;2455         /*!< Send CMD55 APP_CMD with argument as card's RCA.*/
;;;2456         SDIO_CmdInitStructure.SDIO_Argument = (uint32_t) RCA << 16;
;;;2457         SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_APP_CMD;
;;;2458         SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
;;;2459         SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;2460         SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
;;;2461         SDIO_SendCommand(&SDIO_CmdInitStructure);
;;;2462   
;;;2463         errorstatus = CmdResp1Error(SD_CMD_APP_CMD);
;;;2464   
;;;2465         if (errorstatus != SD_OK)
;;;2466         {
;;;2467           return(errorstatus);
;;;2468         }
;;;2469   
;;;2470         /*!< Send ACMD6 APP_CMD with argument as 2 for wide bus mode */
;;;2471         SDIO_CmdInitStructure.SDIO_Argument = 0x2;
;;;2472         SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_APP_SD_SET_BUSWIDTH;
;;;2473         SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
;;;2474         SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;2475         SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
;;;2476         SDIO_SendCommand(&SDIO_CmdInitStructure);
;;;2477   
;;;2478         errorstatus = CmdResp1Error(SD_CMD_APP_SD_SET_BUSWIDTH);
;;;2479   
;;;2480         if (errorstatus != SD_OK)
;;;2481         {
;;;2482           return(errorstatus);
;;;2483         }
;;;2484         return(errorstatus);
;;;2485       }
;;;2486       else
;;;2487       {
;;;2488         errorstatus = SD_REQUEST_NOT_APPLICABLE;
;;;2489         return(errorstatus);
;;;2490       }
;;;2491     }   /*!< If wide bus operation to be disabled */
;;;2492     else
;;;2493     {
;;;2494       /*!< If requested card supports 1 bit mode operation */
;;;2495       if ((scr[1] & SD_SINGLE_BUS_SUPPORT) != SD_ALLZERO)
;;;2496       {
;;;2497         /*!< Send CMD55 APP_CMD with argument as card's RCA.*/
;;;2498         SDIO_CmdInitStructure.SDIO_Argument = (uint32_t) RCA << 16;
;;;2499         SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_APP_CMD;
;;;2500         SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
;;;2501         SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;2502         SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
;;;2503         SDIO_SendCommand(&SDIO_CmdInitStructure);
;;;2504   
;;;2505   
;;;2506         errorstatus = CmdResp1Error(SD_CMD_APP_CMD);
;;;2507   
;;;2508         if (errorstatus != SD_OK)
;;;2509         {
;;;2510           return(errorstatus);
;;;2511         }
;;;2512   
;;;2513         /*!< Send ACMD6 APP_CMD with argument as 2 for wide bus mode */
;;;2514         SDIO_CmdInitStructure.SDIO_Argument = 0x00;
;;;2515         SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_APP_SD_SET_BUSWIDTH;
;;;2516         SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
;;;2517         SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;2518         SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
;;;2519         SDIO_SendCommand(&SDIO_CmdInitStructure);
;;;2520   
;;;2521         errorstatus = CmdResp1Error(SD_CMD_APP_SD_SET_BUSWIDTH);
;;;2522   
;;;2523         if (errorstatus != SD_OK)
;;;2524         {
;;;2525           return(errorstatus);
;;;2526         }
;;;2527   
;;;2528         return(errorstatus);
;;;2529       }
;;;2530       else
;;;2531       {
;;;2532         errorstatus = SD_REQUEST_NOT_APPLICABLE;
;;;2533         return(errorstatus);
;;;2534       }
;;;2535     }
;;;2536   }
000018  e8bd87fc          POP      {r2-r10,pc}
                  |L7.28|
00001c  4f26              LDR      r7,|L7.184|
00001e  4669              MOV      r1,sp                 ;2442
000020  8938              LDRH     r0,[r7,#8]            ;2442  ; RCA
000022  b280              UXTH     r0,r0                 ;2442
000024  f7fffffe          BL       FindSCR
000028  2800              CMP      r0,#0                 ;2444
00002a  d1f5              BNE      |L7.24|
00002c  2037              MOVS     r0,#0x37              ;2457
00002e  4c23              LDR      r4,|L7.188|
000030  2640              MOVS     r6,#0x40              ;2458
000032  9901              LDR      r1,[sp,#4]            ;2450
000034  f04f0a06          MOV      r10,#6                ;2472
000038  f44f6980          MOV      r9,#0x400             ;2460
00003c  f1b80f01          CMP      r8,#1                 ;2450
000040  d01f              BEQ      |L7.130|
000042  03c9              LSLS     r1,r1,#15             ;2495
000044  d535              BPL      |L7.178|
000046  8939              LDRH     r1,[r7,#8]            ;2498  ; RCA
000048  f8c49010          STR      r9,[r4,#0x10]         ;2502  ; SDIO_CmdInitStructure
00004c  0409              LSLS     r1,r1,#16             ;2498
00004e  e9c41000          STRD     r1,r0,[r4,#0]         ;2502
000052  e9c46502          STRD     r6,r5,[r4,#8]         ;2503
000056  4620              MOV      r0,r4                 ;2503
000058  f7fffffe          BL       SDIO_SendCommand
00005c  2037              MOVS     r0,#0x37              ;2506
00005e  f7fffffe          BL       CmdResp1Error
000062  2800              CMP      r0,#0                 ;2508
000064  d1d8              BNE      |L7.24|
000066  e9c45a00          STRD     r5,r10,[r4,#0]        ;2508
00006a  f8c49010          STR      r9,[r4,#0x10]         ;2518  ; SDIO_CmdInitStructure
00006e  bf00              NOP                            ;2518
                  |L7.112|
000070  e9c46502          STRD     r6,r5,[r4,#8]         ;2518
000074  4811              LDR      r0,|L7.188|
000076  f7fffffe          BL       SDIO_SendCommand
00007a  2006              MOVS     r0,#6                 ;2521
00007c  f7fffffe          BL       CmdResp1Error
000080  e7ca              B        |L7.24|
                  |L7.130|
000082  0349              LSLS     r1,r1,#13             ;2453
000084  d515              BPL      |L7.178|
000086  8939              LDRH     r1,[r7,#8]            ;2456  ; RCA
000088  f8c49010          STR      r9,[r4,#0x10]         ;2460  ; SDIO_CmdInitStructure
00008c  0409              LSLS     r1,r1,#16             ;2456
00008e  e9c41000          STRD     r1,r0,[r4,#0]         ;2460
000092  e9c46502          STRD     r6,r5,[r4,#8]         ;2461
000096  4809              LDR      r0,|L7.188|
000098  f7fffffe          BL       SDIO_SendCommand
00009c  2037              MOVS     r0,#0x37              ;2463
00009e  f7fffffe          BL       CmdResp1Error
0000a2  2800              CMP      r0,#0                 ;2465
0000a4  d1b8              BNE      |L7.24|
0000a6  2002              MOVS     r0,#2                 ;2471
0000a8  f8c49010          STR      r9,[r4,#0x10]         ;2475  ; SDIO_CmdInitStructure
0000ac  e9c40a00          STRD     r0,r10,[r4,#0]        ;2475
0000b0  e7de              B        |L7.112|
                  |L7.178|
0000b2  2025              MOVS     r0,#0x25              ;2532
0000b4  e7b0              B        |L7.24|
;;;2537   
                          ENDP

0000b6  0000              DCW      0x0000
                  |L7.184|
                          DCD      ||.data||
                  |L7.188|
                          DCD      ||.bss||+0xa0

                          AREA ||i.SDIO_IRQHandler||, CODE, READONLY, ALIGN=1

                  SDIO_IRQHandler PROC
;;;3040   */
;;;3041   void SDIO_IRQHandler(void)
000000  f7ffbffe          B.W      SD_ProcessIRQSrc
;;;3042   { 	
;;;3043   	/* ¥¶¿ÌÀ˘”–µƒSDIO÷–∂œ‘¥ */
;;;3044   	SD_ProcessIRQSrc();
;;;3045   }
;;;3046   
                          ENDP


                          AREA ||i.SD_DMAEndOfTransferStatus||, CODE, READONLY, ALIGN=2

                  SD_DMAEndOfTransferStatus PROC
;;;2995     */
;;;2996   uint32_t SD_DMAEndOfTransferStatus(void)
000000  4801              LDR      r0,|L9.8|
;;;2997   {
;;;2998   	return (uint32_t)DMA_GetFlagStatus(DMA2_FLAG_TC4);
000002  f7ffbffe          B.W      DMA_GetFlagStatus
;;;2999   }
;;;3000   
                          ENDP

000006  0000              DCW      0x0000
                  |L9.8|
                          DCD      0x10002000

                          AREA ||i.SD_DeInit||, CODE, READONLY, ALIGN=1

                  SD_DeInit PROC
;;;413      */
;;;414    void SD_DeInit(void)
000000  f7ffbffe          B.W      SD_LowLevel_DeInit
;;;415    { 
;;;416    	SD_LowLevel_DeInit();
;;;417    }
;;;418    
                          ENDP


                          AREA ||i.SD_Detect||, CODE, READONLY, ALIGN=2

                  SD_Detect PROC
;;;538     */
;;;539    uint8_t SD_Detect(void)
000000  b508              PUSH     {r3,lr}
;;;540    {
;;;541      __IO uint8_t status = SD_PRESENT;
000002  2001              MOVS     r0,#1
000004  f88d0000          STRB     r0,[sp,#0]
;;;542    
;;;543      /*!< Check GPIO to detect SD */
;;;544      if (GPIO_ReadInputDataBit(SD_DETECT_GPIO_PORT, SD_DETECT_PIN) != Bit_RESET)
000008  2180              MOVS     r1,#0x80
00000a  4805              LDR      r0,|L11.32|
00000c  f7fffffe          BL       GPIO_ReadInputDataBit
000010  b110              CBZ      r0,|L11.24|
;;;545      {
;;;546        status = SD_NOT_PRESENT;
000012  2000              MOVS     r0,#0
000014  f88d0000          STRB     r0,[sp,#0]
                  |L11.24|
;;;547      }
;;;548      return status;
000018  f89d0000          LDRB     r0,[sp,#0]
;;;549    }
00001c  bd08              POP      {r3,pc}
;;;550    
                          ENDP

00001e  0000              DCW      0x0000
                  |L11.32|
                          DCD      0x40011000

                          AREA ||i.SD_EnableWideBusOperation||, CODE, READONLY, ALIGN=2

                  SD_EnableWideBusOperation PROC
;;;1101     */
;;;1102   SD_Error SD_EnableWideBusOperation(uint32_t WideMode)
000000  e92d41f0          PUSH     {r4-r8,lr}
;;;1103   {
000004  4601              MOV      r1,r0
;;;1104     SD_Error errorstatus = SD_OK;
;;;1105   
;;;1106     /*!< MMC Card doesn't support this feature */
;;;1107     if (SDIO_MULTIMEDIA_CARD == CardType)
000006  4819              LDR      r0,|L12.108|
000008  2600              MOVS     r6,#0                 ;1104
00000a  6840              LDR      r0,[r0,#4]  ; CardType
00000c  2803              CMP      r0,#3
00000e  d014              BEQ      |L12.58|
;;;1108     {
;;;1109       errorstatus = SD_UNSUPPORTED_FEATURE;
;;;1110       return(errorstatus);
;;;1111     }
;;;1112     else if ((SDIO_STD_CAPACITY_SD_CARD_V1_1 == CardType) || (SDIO_STD_CAPACITY_SD_CARD_V2_0 == CardType) || (SDIO_HIGH_CAPACITY_SD_CARD == CardType))
000010  b118              CBZ      r0,|L12.26|
000012  2801              CMP      r0,#1
000014  d001              BEQ      |L12.26|
000016  2802              CMP      r0,#2
000018  d126              BNE      |L12.104|
                  |L12.26|
;;;1113     {
;;;1114       if (SDIO_BusWide_8b == WideMode)
00001a  f5b15f80          CMP      r1,#0x1000
00001e  d00c              BEQ      |L12.58|
;;;1115       {
;;;1116         errorstatus = SD_UNSUPPORTED_FEATURE;
;;;1117         return(errorstatus);
;;;1118       }
;;;1119       else if (SDIO_BusWide_4b == WideMode)
000020  f44f6800          MOV      r8,#0x800
000024  2500              MOVS     r5,#0
000026  2701              MOVS     r7,#1                 ;1107
;;;1120       {
;;;1121         errorstatus = SDEnWideBus(ENABLE);
;;;1122   
;;;1123         if (SD_OK == errorstatus)
;;;1124         {
;;;1125           /*!< Configure the SDIO peripheral */
;;;1126           SDIO_InitStructure.SDIO_ClockDiv = SDIO_TRANSFER_CLK_DIV; 
000028  4c11              LDR      r4,|L12.112|
00002a  4541              CMP      r1,r8                 ;1119
00002c  d10e              BNE      |L12.76|
00002e  2001              MOVS     r0,#1                 ;1121
000030  f7fffffe          BL       SDEnWideBus
000034  0006              MOVS     r6,r0                 ;1121
000036  d003              BEQ      |L12.64|
000038  e016              B        |L12.104|
                  |L12.58|
00003a  2027              MOVS     r0,#0x27              ;1116
                  |L12.60|
;;;1127           SDIO_InitStructure.SDIO_ClockEdge = SDIO_ClockEdge_Rising;
;;;1128           SDIO_InitStructure.SDIO_ClockBypass = SDIO_ClockBypass_Disable;
;;;1129           SDIO_InitStructure.SDIO_ClockPowerSave = SDIO_ClockPowerSave_Disable;
;;;1130           SDIO_InitStructure.SDIO_BusWide = SDIO_BusWide_4b;
;;;1131           SDIO_InitStructure.SDIO_HardwareFlowControl = SDIO_HardwareFlowControl_Disable;
;;;1132           SDIO_Init(&SDIO_InitStructure);
;;;1133         }
;;;1134       }
;;;1135       else
;;;1136       {
;;;1137         errorstatus = SDEnWideBus(DISABLE);
;;;1138   
;;;1139         if (SD_OK == errorstatus)
;;;1140         {
;;;1141           /*!< Configure the SDIO peripheral */
;;;1142           SDIO_InitStructure.SDIO_ClockDiv = SDIO_TRANSFER_CLK_DIV; 
;;;1143           SDIO_InitStructure.SDIO_ClockEdge = SDIO_ClockEdge_Rising;
;;;1144           SDIO_InitStructure.SDIO_ClockBypass = SDIO_ClockBypass_Disable;
;;;1145           SDIO_InitStructure.SDIO_ClockPowerSave = SDIO_ClockPowerSave_Disable;
;;;1146           SDIO_InitStructure.SDIO_BusWide = SDIO_BusWide_1b;
;;;1147           SDIO_InitStructure.SDIO_HardwareFlowControl = SDIO_HardwareFlowControl_Disable;
;;;1148           SDIO_Init(&SDIO_InitStructure);
;;;1149         }
;;;1150       }
;;;1151     }
;;;1152   
;;;1153     return(errorstatus);
;;;1154   }
00003c  e8bd81f0          POP      {r4-r8,pc}
                  |L12.64|
000040  7527              STRB     r7,[r4,#0x14]         ;1126
000042  6025              STR      r5,[r4,#0]            ;1128  ; SDIO_InitStructure
000044  6065              STR      r5,[r4,#4]            ;1128  ; SDIO_InitStructure
000046  e9c45802          STRD     r5,r8,[r4,#8]         ;1128
00004a  e009              B        |L12.96|
                  |L12.76|
00004c  2000              MOVS     r0,#0                 ;1137
00004e  f7fffffe          BL       SDEnWideBus
000052  0006              MOVS     r6,r0                 ;1137
000054  d108              BNE      |L12.104|
000056  7527              STRB     r7,[r4,#0x14]         ;1142
000058  6025              STR      r5,[r4,#0]            ;1144  ; SDIO_InitStructure
00005a  6065              STR      r5,[r4,#4]            ;1145  ; SDIO_InitStructure
00005c  60a5              STR      r5,[r4,#8]            ;1146  ; SDIO_InitStructure
00005e  60e5              STR      r5,[r4,#0xc]          ;1146  ; SDIO_InitStructure
                  |L12.96|
000060  4803              LDR      r0,|L12.112|
000062  6125              STR      r5,[r4,#0x10]         ;1148  ; SDIO_InitStructure
000064  f7fffffe          BL       SDIO_Init
                  |L12.104|
000068  4630              MOV      r0,r6                 ;1153
00006a  e7e7              B        |L12.60|
;;;1155   
                          ENDP

                  |L12.108|
                          DCD      ||.data||
                  |L12.112|
                          DCD      ||.bss||+0x88

                          AREA ||i.SD_Erase||, CODE, READONLY, ALIGN=2

                  SD_Erase PROC
;;;1774     */
;;;1775   SD_Error SD_Erase(uint32_t startaddr, uint32_t endaddr)
000000  e92d47fc          PUSH     {r2-r10,lr}
;;;1776   {
000004  4680              MOV      r8,r0
;;;1777     SD_Error errorstatus = SD_OK;
;;;1778     uint32_t delay = 0;
000006  2600              MOVS     r6,#0
;;;1779     __IO uint32_t maxdelay = 0;
;;;1780     uint8_t cardstate = 0;
;;;1781   
;;;1782     /*!< Check if the card coomnd class supports erase command */
;;;1783     if (((CSD_Tab[1] >> 20) & SD_CCCC_ERASE) == 0)
000008  483c              LDR      r0,|L13.252|
00000a  9601              STR      r6,[sp,#4]            ;1780
00000c  f88d6000          STRB     r6,[sp,#0]            ;1780
000010  6840              LDR      r0,[r0,#4]  ; CSD_Tab
000012  460f              MOV      r7,r1                 ;1776
000014  0d00              LSRS     r0,r0,#20
000016  4635              MOV      r5,r6                 ;1779
000018  0680              LSLS     r0,r0,#26
00001a  d402              BMI      |L13.34|
;;;1784     {
;;;1785       errorstatus = SD_REQUEST_NOT_APPLICABLE;
00001c  2025              MOVS     r0,#0x25
                  |L13.30|
;;;1786       return(errorstatus);
;;;1787     }
;;;1788   
;;;1789     maxdelay = 120000 / ((SDIO->CLKCR & 0xFF) + 2);
;;;1790   
;;;1791     if (SDIO_GetResponse(SDIO_RESP1) & SD_CARD_LOCKED)
;;;1792     {
;;;1793       errorstatus = SD_LOCK_UNLOCK_FAILED;
;;;1794       return(errorstatus);
;;;1795     }
;;;1796   
;;;1797     if (CardType == SDIO_HIGH_CAPACITY_SD_CARD)
;;;1798     {
;;;1799       startaddr /= 512;
;;;1800       endaddr /= 512;
;;;1801     }
;;;1802     
;;;1803     /*!< According to sd-card spec 1.0 ERASE_GROUP_START (CMD32) and erase_group_end(CMD33) */
;;;1804     if ((SDIO_STD_CAPACITY_SD_CARD_V1_1 == CardType) || (SDIO_STD_CAPACITY_SD_CARD_V2_0 == CardType) || (SDIO_HIGH_CAPACITY_SD_CARD == CardType))
;;;1805     {
;;;1806       /*!< Send CMD32 SD_ERASE_GRP_START with argument as addr  */
;;;1807       SDIO_CmdInitStructure.SDIO_Argument = startaddr;
;;;1808       SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_SD_ERASE_GRP_START;
;;;1809       SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
;;;1810       SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;1811       SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
;;;1812       SDIO_SendCommand(&SDIO_CmdInitStructure);
;;;1813   
;;;1814       errorstatus = CmdResp1Error(SD_CMD_SD_ERASE_GRP_START);
;;;1815       if (errorstatus != SD_OK)
;;;1816       {
;;;1817         return(errorstatus);
;;;1818       }
;;;1819   
;;;1820       /*!< Send CMD33 SD_ERASE_GRP_END with argument as addr  */
;;;1821       SDIO_CmdInitStructure.SDIO_Argument = endaddr;
;;;1822       SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_SD_ERASE_GRP_END;
;;;1823       SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
;;;1824       SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;1825       SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
;;;1826       SDIO_SendCommand(&SDIO_CmdInitStructure);
;;;1827   
;;;1828       errorstatus = CmdResp1Error(SD_CMD_SD_ERASE_GRP_END);
;;;1829       if (errorstatus != SD_OK)
;;;1830       {
;;;1831         return(errorstatus);
;;;1832       }
;;;1833     }
;;;1834   
;;;1835     /*!< Send CMD38 ERASE */
;;;1836     SDIO_CmdInitStructure.SDIO_Argument = 0;
;;;1837     SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_ERASE;
;;;1838     SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
;;;1839     SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;1840     SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
;;;1841     SDIO_SendCommand(&SDIO_CmdInitStructure);
;;;1842   
;;;1843     errorstatus = CmdResp1Error(SD_CMD_ERASE);
;;;1844   
;;;1845     if (errorstatus != SD_OK)
;;;1846     {
;;;1847       return(errorstatus);
;;;1848     }
;;;1849   
;;;1850     for (delay = 0; delay < maxdelay; delay++)
;;;1851     {}
;;;1852   
;;;1853     /*!< Wait till the card is in programming state */
;;;1854     errorstatus = IsCardProgramming(&cardstate);
;;;1855     delay = SD_DATATIMEOUT;
;;;1856     while ((delay > 0) && (errorstatus == SD_OK) && ((SD_CARD_PROGRAMMING == cardstate) || (SD_CARD_RECEIVING == cardstate)))
;;;1857     {
;;;1858       errorstatus = IsCardProgramming(&cardstate);
;;;1859       delay--;
;;;1860     }
;;;1861   
;;;1862     return(errorstatus);
;;;1863   }
00001e  e8bd87fc          POP      {r2-r10,pc}
                  |L13.34|
000022  4837              LDR      r0,|L13.256|
000024  6840              LDR      r0,[r0,#4]            ;1789
000026  4937              LDR      r1,|L13.260|
000028  b2c0              UXTB     r0,r0                 ;1789
00002a  1c80              ADDS     r0,r0,#2              ;1789
00002c  fbb1f0f0          UDIV     r0,r1,r0              ;1789
000030  9001              STR      r0,[sp,#4]            ;1791
000032  2000              MOVS     r0,#0                 ;1791
000034  f7fffffe          BL       SDIO_GetResponse
000038  0180              LSLS     r0,r0,#6              ;1791
00003a  d501              BPL      |L13.64|
00003c  200e              MOVS     r0,#0xe               ;1793
00003e  e7ee              B        |L13.30|
                  |L13.64|
000040  4831              LDR      r0,|L13.264|
000042  4c2e              LDR      r4,|L13.252|
000044  f04f0a40          MOV      r10,#0x40             ;1809
000048  6840              LDR      r0,[r0,#4]            ;1797  ; CardType
00004a  34a0              ADDS     r4,r4,#0xa0           ;1807
00004c  f44f6980          MOV      r9,#0x400             ;1811
000050  2802              CMP      r0,#2                 ;1797
000052  d005              BEQ      |L13.96|
000054  b138              CBZ      r0,|L13.102|
000056  2801              CMP      r0,#1                 ;1804
000058  d005              BEQ      |L13.102|
00005a  2802              CMP      r0,#2                 ;1804
00005c  d003              BEQ      |L13.102|
00005e  e023              B        |L13.168|
                  |L13.96|
000060  ea4f2858          LSR      r8,r8,#9              ;1799
000064  0a7f              LSRS     r7,r7,#9              ;1800
                  |L13.102|
000066  2020              MOVS     r0,#0x20              ;1808
000068  e9c48000          STRD     r8,r0,[r4,#0]         ;1808
00006c  f8c49010          STR      r9,[r4,#0x10]         ;1812  ; SDIO_CmdInitStructure
000070  4822              LDR      r0,|L13.252|
000072  e9c4a502          STRD     r10,r5,[r4,#8]        ;1812
000076  46d0              MOV      r8,r10                ;1809
000078  30a0              ADDS     r0,r0,#0xa0           ;1812
00007a  f7fffffe          BL       SDIO_SendCommand
00007e  2020              MOVS     r0,#0x20              ;1814
000080  f7fffffe          BL       CmdResp1Error
000084  2800              CMP      r0,#0                 ;1815
000086  d1ca              BNE      |L13.30|
000088  2021              MOVS     r0,#0x21              ;1822
00008a  f8c49010          STR      r9,[r4,#0x10]         ;1825  ; SDIO_CmdInitStructure
00008e  e9c47000          STRD     r7,r0,[r4,#0]         ;1825
000092  481a              LDR      r0,|L13.252|
000094  e9c48502          STRD     r8,r5,[r4,#8]         ;1826
000098  30a0              ADDS     r0,r0,#0xa0           ;1826
00009a  f7fffffe          BL       SDIO_SendCommand
00009e  2021              MOVS     r0,#0x21              ;1828
0000a0  f7fffffe          BL       CmdResp1Error
0000a4  2800              CMP      r0,#0                 ;1829
0000a6  d1ba              BNE      |L13.30|
                  |L13.168|
0000a8  4620              MOV      r0,r4                 ;1836
0000aa  2126              MOVS     r1,#0x26              ;1837
0000ac  e9c05100          STRD     r5,r1,[r0,#0]         ;1837
0000b0  e9c4a502          STRD     r10,r5,[r4,#8]        ;1837
0000b4  4811              LDR      r0,|L13.252|
0000b6  f8c49010          STR      r9,[r4,#0x10]         ;1841  ; SDIO_CmdInitStructure
0000ba  30a0              ADDS     r0,r0,#0xa0           ;1841
0000bc  f7fffffe          BL       SDIO_SendCommand
0000c0  2026              MOVS     r0,#0x26              ;1843
0000c2  f7fffffe          BL       CmdResp1Error
0000c6  2800              CMP      r0,#0                 ;1845
0000c8  d1a9              BNE      |L13.30|
0000ca  e000              B        |L13.206|
                  |L13.204|
0000cc  1c76              ADDS     r6,r6,#1              ;1845
                  |L13.206|
0000ce  9801              LDR      r0,[sp,#4]            ;1850
0000d0  4286              CMP      r6,r0                 ;1850
0000d2  d3fb              BCC      |L13.204|
0000d4  4668              MOV      r0,sp                 ;1854
0000d6  f7fffffe          BL       IsCardProgramming
0000da  4c0c              LDR      r4,|L13.268|
0000dc  e004              B        |L13.232|
                  |L13.222|
0000de  4668              MOV      r0,sp                 ;1858
0000e0  f7fffffe          BL       IsCardProgramming
0000e4  1e64              SUBS     r4,r4,#1              ;1858
0000e6  d09a              BEQ      |L13.30|
                  |L13.232|
0000e8  2800              CMP      r0,#0                 ;1856
0000ea  d198              BNE      |L13.30|
0000ec  f89d1000          LDRB     r1,[sp,#0]            ;1856
0000f0  2907              CMP      r1,#7                 ;1856
0000f2  d0f4              BEQ      |L13.222|
0000f4  2906              CMP      r1,#6                 ;1856
0000f6  d0f2              BEQ      |L13.222|
0000f8  e791              B        |L13.30|
;;;1864   
                          ENDP

0000fa  0000              DCW      0x0000
                  |L13.252|
                          DCD      ||.bss||
                  |L13.256|
                          DCD      0x40018000
                  |L13.260|
                          DCD      0x0001d4c0
                  |L13.264|
                          DCD      ||.data||
                  |L13.268|
                          DCD      0x000fffff

                          AREA ||i.SD_GetCardInfo||, CODE, READONLY, ALIGN=2

                  SD_GetCardInfo PROC
;;;804      */
;;;805    SD_Error SD_GetCardInfo(SD_CardInfo *cardinfo)
000000  e92d43f0          PUSH     {r4-r9,lr}
;;;806    {
;;;807      SD_Error errorstatus = SD_OK;
;;;808      uint8_t tmp = 0;
;;;809    
;;;810      cardinfo->CardType = (uint8_t)CardType;
000004  4995              LDR      r1,|L14.604|
;;;811      cardinfo->RCA = (uint16_t)RCA;
;;;812    
;;;813      /*!< Byte 0 */
;;;814      tmp = (uint8_t)((CSD_Tab[0] & 0xFF000000) >> 24);
000006  f8df9258          LDR      r9,|L14.608|
00000a  f8d1c004          LDR      r12,[r1,#4]           ;810  ; CardType
00000e  f880c056          STRB     r12,[r0,#0x56]        ;810
000012  8909              LDRH     r1,[r1,#8]            ;811  ; RCA
000014  f8a01054          STRH     r1,[r0,#0x54]         ;811
000018  f8d91000          LDR      r1,[r9,#0]  ; CSD_Tab
00001c  0e0a              LSRS     r2,r1,#24
;;;815      cardinfo->SD_csd.CSDStruct = (tmp & 0xC0) >> 6;
00001e  0994              LSRS     r4,r2,#6
000020  7004              STRB     r4,[r0,#0]
;;;816      cardinfo->SD_csd.SysSpecVersion = (tmp & 0x3C) >> 2;
000022  f3c20483          UBFX     r4,r2,#2,#4
000026  7044              STRB     r4,[r0,#1]
;;;817      cardinfo->SD_csd.Reserved1 = tmp & 0x03;
000028  f0020203          AND      r2,r2,#3
00002c  7082              STRB     r2,[r0,#2]
;;;818    
;;;819      /*!< Byte 1 */
;;;820      tmp = (uint8_t)((CSD_Tab[0] & 0x00FF0000) >> 16);
00002e  0c0a              LSRS     r2,r1,#16
;;;821      cardinfo->SD_csd.TAAC = tmp;
000030  70c2              STRB     r2,[r0,#3]
;;;822    
;;;823      /*!< Byte 2 */
;;;824      tmp = (uint8_t)((CSD_Tab[0] & 0x0000FF00) >> 8);
000032  0a0a              LSRS     r2,r1,#8
;;;825      cardinfo->SD_csd.NSAC = tmp;
000034  7102              STRB     r2,[r0,#4]
;;;826    
;;;827      /*!< Byte 3 */
;;;828      tmp = (uint8_t)(CSD_Tab[0] & 0x000000FF);
;;;829      cardinfo->SD_csd.MaxBusClkFrec = tmp;
000036  7141              STRB     r1,[r0,#5]
;;;830    
;;;831      /*!< Byte 4 */
;;;832      tmp = (uint8_t)((CSD_Tab[1] & 0xFF000000) >> 24);
000038  f8d97004          LDR      r7,[r9,#4]  ; CSD_Tab
00003c  0e39              LSRS     r1,r7,#24
;;;833      cardinfo->SD_csd.CardComdClasses = tmp << 4;
00003e  0109              LSLS     r1,r1,#4
000040  80c1              STRH     r1,[r0,#6]
;;;834    
;;;835      /*!< Byte 5 */
;;;836      tmp = (uint8_t)((CSD_Tab[1] & 0x00FF0000) >> 16);
;;;837      cardinfo->SD_csd.CardComdClasses |= (tmp & 0xF0) >> 4;
000042  88c2              LDRH     r2,[r0,#6]
000044  f3c74107          UBFX     r1,r7,#16,#8          ;836
000048  ea421211          ORR      r2,r2,r1,LSR #4
00004c  80c2              STRH     r2,[r0,#6]
;;;838      cardinfo->SD_csd.RdBlockLen = tmp & 0x0F;
00004e  f001010f          AND      r1,r1,#0xf
000052  7201              STRB     r1,[r0,#8]
;;;839    
;;;840      /*!< Byte 6 */
;;;841      tmp = (uint8_t)((CSD_Tab[1] & 0x0000FF00) >> 8);
000054  f3c72207          UBFX     r2,r7,#8,#8
;;;842      cardinfo->SD_csd.PartBlockRead = (tmp & 0x80) >> 7;
000058  09d1              LSRS     r1,r2,#7
00005a  7241              STRB     r1,[r0,#9]
;;;843      cardinfo->SD_csd.WrBlockMisalign = (tmp & 0x40) >> 6;
00005c  f3c21180          UBFX     r1,r2,#6,#1
000060  7281              STRB     r1,[r0,#0xa]
;;;844      cardinfo->SD_csd.RdBlockMisalign = (tmp & 0x20) >> 5;
000062  f3c21140          UBFX     r1,r2,#5,#1
000066  72c1              STRB     r1,[r0,#0xb]
;;;845      cardinfo->SD_csd.DSRImpl = (tmp & 0x10) >> 4;
000068  f3c21100          UBFX     r1,r2,#4,#1
00006c  7301              STRB     r1,[r0,#0xc]
;;;846      cardinfo->SD_csd.Reserved2 = 0; /*!< Reserved */
00006e  2100              MOVS     r1,#0
000070  7341              STRB     r1,[r0,#0xd]
000072  464b              MOV      r3,r9                 ;814
;;;847    
;;;848      if ((CardType == SDIO_STD_CAPACITY_SD_CARD_V1_1) || (CardType == SDIO_STD_CAPACITY_SD_CARD_V2_0))
;;;849      {
;;;850        cardinfo->SD_csd.DeviceSize = (tmp & 0x03) << 10;
;;;851    
;;;852        /*!< Byte 7 */
;;;853        tmp = (uint8_t)(CSD_Tab[1] & 0x000000FF);
;;;854        cardinfo->SD_csd.DeviceSize |= (tmp) << 2;
;;;855    
;;;856        /*!< Byte 8 */
;;;857        tmp = (uint8_t)((CSD_Tab[2] & 0xFF000000) >> 24);
000074  689d              LDR      r5,[r3,#8]
000076  2301              MOVS     r3,#1                 ;810
000078  0e2e              LSRS     r6,r5,#24
;;;858        cardinfo->SD_csd.DeviceSize |= (tmp & 0xC0) >> 6;
;;;859    
;;;860        cardinfo->SD_csd.MaxRdCurrentVDDMin = (tmp & 0x38) >> 3;
;;;861        cardinfo->SD_csd.MaxRdCurrentVDDMax = (tmp & 0x07);
;;;862    
;;;863        /*!< Byte 9 */
;;;864        tmp = (uint8_t)((CSD_Tab[2] & 0x00FF0000) >> 16);
00007a  f3c54407          UBFX     r4,r5,#16,#8
;;;865        cardinfo->SD_csd.MaxWrCurrentVDDMin = (tmp & 0xE0) >> 5;
;;;866        cardinfo->SD_csd.MaxWrCurrentVDDMax = (tmp & 0x1C) >> 2;
;;;867        cardinfo->SD_csd.DeviceSizeMul = (tmp & 0x03) << 1;
;;;868        /*!< Byte 10 */
;;;869        tmp = (uint8_t)((CSD_Tab[2] & 0x0000FF00) >> 8);
00007e  f3c52807          UBFX     r8,r5,#8,#8
000082  f1bc0f00          CMP      r12,#0                ;848
000086  d006              BEQ      |L14.150|
000088  f1bc0f01          CMP      r12,#1                ;848
00008c  d003              BEQ      |L14.150|
;;;870        cardinfo->SD_csd.DeviceSizeMul |= (tmp & 0x80) >> 7;
;;;871        
;;;872        cardinfo->CardCapacity = (cardinfo->SD_csd.DeviceSize + 1) ;
;;;873        cardinfo->CardCapacity *= (1 << (cardinfo->SD_csd.DeviceSizeMul + 2));
;;;874        cardinfo->CardBlockSize = 1 << (cardinfo->SD_csd.RdBlockLen);
;;;875        cardinfo->CardCapacity *= cardinfo->CardBlockSize;
;;;876      }
;;;877      else if (CardType == SDIO_HIGH_CAPACITY_SD_CARD)
00008e  f1bc0f02          CMP      r12,#2
000092  d03b              BEQ      |L14.268|
000094  e04d              B        |L14.306|
                  |L14.150|
000096  0792              LSLS     r2,r2,#30             ;850
000098  0d12              LSRS     r2,r2,#20             ;850
00009a  6102              STR      r2,[r0,#0x10]         ;850
00009c  b2fa              UXTB     r2,r7                 ;853
00009e  6907              LDR      r7,[r0,#0x10]         ;854
0000a0  ea470282          ORR      r2,r7,r2,LSL #2       ;854
0000a4  6102              STR      r2,[r0,#0x10]         ;854
0000a6  6902              LDR      r2,[r0,#0x10]         ;858
0000a8  ea421296          ORR      r2,r2,r6,LSR #6       ;858
0000ac  6102              STR      r2,[r0,#0x10]         ;858
0000ae  f3c602c2          UBFX     r2,r6,#3,#3           ;860
0000b2  7502              STRB     r2,[r0,#0x14]         ;860
0000b4  f0060207          AND      r2,r6,#7              ;861
0000b8  7542              STRB     r2,[r0,#0x15]         ;861
0000ba  0962              LSRS     r2,r4,#5              ;865
0000bc  7582              STRB     r2,[r0,#0x16]         ;865
0000be  f3c40282          UBFX     r2,r4,#2,#3           ;866
0000c2  75c2              STRB     r2,[r0,#0x17]         ;866
0000c4  07a2              LSLS     r2,r4,#30             ;867
0000c6  0f52              LSRS     r2,r2,#29             ;867
0000c8  7602              STRB     r2,[r0,#0x18]         ;867
0000ca  7e04              LDRB     r4,[r0,#0x18]         ;870
0000cc  4642              MOV      r2,r8                 ;867
0000ce  ea4414d2          ORR      r4,r4,r2,LSR #7       ;870
0000d2  7604              STRB     r4,[r0,#0x18]         ;870
0000d4  6904              LDR      r4,[r0,#0x10]         ;872
0000d6  7e07              LDRB     r7,[r0,#0x18]         ;873
0000d8  1cbf              ADDS     r7,r7,#2              ;873
0000da  fa03f607          LSL      r6,r3,r7              ;873
0000de  1c64              ADDS     r4,r4,#1              ;873
0000e0  fba47806          UMULL    r7,r8,r4,r6           ;873
0000e4  ea4f7ce6          ASR      r12,r6,#31            ;873
0000e8  fb018606          MLA      r6,r1,r6,r8           ;873
0000ec  fb04660c          MLA      r6,r4,r12,r6          ;873
0000f0  f890c008          LDRB     r12,[r0,#8]           ;874
0000f4  fa03f40c          LSL      r4,r3,r12             ;874
0000f8  fba7c804          UMULL    r12,r8,r7,r4          ;874
0000fc  6504              STR      r4,[r0,#0x50]         ;874
0000fe  fb068404          MLA      r4,r6,r4,r8           ;874
000102  fb074401          MLA      r4,r7,r1,r4           ;874
000106  e9c0c412          STRD     r12,r4,[r0,#0x48]     ;874
00010a  e012              B        |L14.306|
                  |L14.268|
;;;878      {
;;;879        /*!< Byte 7 */
;;;880        tmp = (uint8_t)(CSD_Tab[1] & 0x000000FF);
;;;881        cardinfo->SD_csd.DeviceSize = (tmp & 0x3F) << 16;
00010c  06ba              LSLS     r2,r7,#26
00010e  0a92              LSRS     r2,r2,#10
000110  6102              STR      r2,[r0,#0x10]
;;;882    
;;;883        /*!< Byte 8 */
;;;884        tmp = (uint8_t)((CSD_Tab[2] & 0xFF000000) >> 24);
;;;885    
;;;886        cardinfo->SD_csd.DeviceSize |= (tmp << 8);
000112  6902              LDR      r2,[r0,#0x10]
000114  ea422206          ORR      r2,r2,r6,LSL #8
000118  6102              STR      r2,[r0,#0x10]
;;;887    
;;;888        /*!< Byte 9 */
;;;889        tmp = (uint8_t)((CSD_Tab[2] & 0x00FF0000) >> 16);
;;;890    
;;;891        cardinfo->SD_csd.DeviceSize |= (tmp);
00011a  6902              LDR      r2,[r0,#0x10]
00011c  4322              ORRS     r2,r2,r4
00011e  6102              STR      r2,[r0,#0x10]
;;;892    
;;;893        /*!< Byte 10 */
;;;894        tmp = (uint8_t)((CSD_Tab[2] & 0x0000FF00) >> 8);
;;;895        
;;;896        cardinfo->CardCapacity = (cardinfo->SD_csd.DeviceSize + 1) * 512 * 1024;
000120  6904              LDR      r4,[r0,#0x10]
000122  4642              MOV      r2,r8                 ;891
000124  1c64              ADDS     r4,r4,#1
000126  04e4              LSLS     r4,r4,#19
000128  e9c04112          STRD     r4,r1,[r0,#0x48]
;;;897        cardinfo->CardBlockSize = 512;    
00012c  f44f7400          MOV      r4,#0x200
000130  6504              STR      r4,[r0,#0x50]
                  |L14.306|
;;;898      }
;;;899    
;;;900    
;;;901      cardinfo->SD_csd.EraseGrSize = (tmp & 0x40) >> 6;
000132  f3c21480          UBFX     r4,r2,#6,#1
000136  7644              STRB     r4,[r0,#0x19]
;;;902      cardinfo->SD_csd.EraseGrMul = (tmp & 0x3F) << 1;
000138  0692              LSLS     r2,r2,#26
00013a  0e52              LSRS     r2,r2,#25
00013c  f8002f1a          STRB     r2,[r0,#0x1a]!
;;;903    
;;;904      /*!< Byte 11 */
;;;905      tmp = (uint8_t)(CSD_Tab[2] & 0x000000FF);
000140  b2ea              UXTB     r2,r5
;;;906      cardinfo->SD_csd.EraseGrMul |= (tmp & 0x80) >> 7;
000142  7805              LDRB     r5,[r0,#0]
000144  ea4515d2          ORR      r5,r5,r2,LSR #7
000148  f8005b01          STRB     r5,[r0],#1
;;;907      cardinfo->SD_csd.WrProtectGrSize = (tmp & 0x7F);
00014c  f002027f          AND      r2,r2,#0x7f
000150  f8002b01          STRB     r2,[r0],#1
;;;908    
;;;909      /*!< Byte 12 */
;;;910      tmp = (uint8_t)((CSD_Tab[3] & 0xFF000000) >> 24);
000154  f8d9400c          LDR      r4,[r9,#0xc]  ; CSD_Tab
000158  0e22              LSRS     r2,r4,#24
;;;911      cardinfo->SD_csd.WrProtectGrEnable = (tmp & 0x80) >> 7;
00015a  09d5              LSRS     r5,r2,#7
00015c  f8005b01          STRB     r5,[r0],#1
;;;912      cardinfo->SD_csd.ManDeflECC = (tmp & 0x60) >> 5;
000160  f3c21541          UBFX     r5,r2,#5,#2
000164  f8005b01          STRB     r5,[r0],#1
;;;913      cardinfo->SD_csd.WrSpeedFact = (tmp & 0x1C) >> 2;
000168  f3c20582          UBFX     r5,r2,#2,#3
00016c  f8005b01          STRB     r5,[r0],#1
;;;914      cardinfo->SD_csd.MaxWrBlockLen = (tmp & 0x03) << 2;
000170  0792              LSLS     r2,r2,#30
000172  0f12              LSRS     r2,r2,#28
000174  7002              STRB     r2,[r0,#0]
;;;915    
;;;916      /*!< Byte 13 */
;;;917      tmp = (uint8_t)((CSD_Tab[3] & 0x00FF0000) >> 16);
;;;918      cardinfo->SD_csd.MaxWrBlockLen |= (tmp & 0xC0) >> 6;
000176  7805              LDRB     r5,[r0,#0]
000178  f3c44207          UBFX     r2,r4,#16,#8          ;917
00017c  ea451592          ORR      r5,r5,r2,LSR #6
000180  f8005b01          STRB     r5,[r0],#1
;;;919      cardinfo->SD_csd.WriteBlockPaPartial = (tmp & 0x20) >> 5;
000184  f3c21540          UBFX     r5,r2,#5,#1
000188  7005              STRB     r5,[r0,#0]
;;;920      cardinfo->SD_csd.Reserved3 = 0;
00018a  7041              STRB     r1,[r0,#1]
;;;921      cardinfo->SD_csd.ContentProtectAppli = (tmp & 0x01);
00018c  f0020201          AND      r2,r2,#1
000190  7082              STRB     r2,[r0,#2]
;;;922    
;;;923      /*!< Byte 14 */
;;;924      tmp = (uint8_t)((CSD_Tab[3] & 0x0000FF00) >> 8);
000192  f3c42207          UBFX     r2,r4,#8,#8
;;;925      cardinfo->SD_csd.FileFormatGrouop = (tmp & 0x80) >> 7;
000196  09d5              LSRS     r5,r2,#7
000198  70c5              STRB     r5,[r0,#3]
;;;926      cardinfo->SD_csd.CopyFlag = (tmp & 0x40) >> 6;
00019a  f3c21580          UBFX     r5,r2,#6,#1
00019e  7105              STRB     r5,[r0,#4]
;;;927      cardinfo->SD_csd.PermWrProtect = (tmp & 0x20) >> 5;
0001a0  f3c21540          UBFX     r5,r2,#5,#1
0001a4  7145              STRB     r5,[r0,#5]
;;;928      cardinfo->SD_csd.TempWrProtect = (tmp & 0x10) >> 4;
0001a6  f3c21500          UBFX     r5,r2,#4,#1
0001aa  7185              STRB     r5,[r0,#6]
;;;929      cardinfo->SD_csd.FileFormat = (tmp & 0x0C) >> 2;
0001ac  f3c20581          UBFX     r5,r2,#2,#2
0001b0  71c5              STRB     r5,[r0,#7]
;;;930      cardinfo->SD_csd.ECC = (tmp & 0x03);
0001b2  f0020203          AND      r2,r2,#3
0001b6  7202              STRB     r2,[r0,#8]
;;;931    
;;;932      /*!< Byte 15 */
;;;933      tmp = (uint8_t)(CSD_Tab[3] & 0x000000FF);
;;;934      cardinfo->SD_csd.CSD_CRC = (tmp & 0xFE) >> 1;
0001b8  f3c40246          UBFX     r2,r4,#1,#7
0001bc  7242              STRB     r2,[r0,#9]
;;;935      cardinfo->SD_csd.Reserved4 = 1;
0001be  7283              STRB     r3,[r0,#0xa]
;;;936    
;;;937    
;;;938      /*!< Byte 0 */
;;;939      tmp = (uint8_t)((CID_Tab[0] & 0xFF000000) >> 24);
0001c0  4c27              LDR      r4,|L14.608|
0001c2  3410              ADDS     r4,r4,#0x10
0001c4  6822              LDR      r2,[r4,#0]  ; CID_Tab
0001c6  0e15              LSRS     r5,r2,#24
;;;940      cardinfo->SD_cid.ManufacturerID = tmp;
0001c8  7305              STRB     r5,[r0,#0xc]
;;;941    
;;;942      /*!< Byte 1 */
;;;943      tmp = (uint8_t)((CID_Tab[0] & 0x00FF0000) >> 16);
0001ca  0c15              LSRS     r5,r2,#16
;;;944      cardinfo->SD_cid.OEM_AppliID = tmp << 8;
0001cc  022d              LSLS     r5,r5,#8
0001ce  81c5              STRH     r5,[r0,#0xe]
;;;945    
;;;946      /*!< Byte 2 */
;;;947      tmp = (uint8_t)((CID_Tab[0] & 0x000000FF00) >> 8);
;;;948      cardinfo->SD_cid.OEM_AppliID |= tmp;
0001d0  89c6              LDRH     r6,[r0,#0xe]
0001d2  f3c22507          UBFX     r5,r2,#8,#8           ;947
0001d6  432e              ORRS     r6,r6,r5
0001d8  81c6              STRH     r6,[r0,#0xe]
;;;949    
;;;950      /*!< Byte 3 */
;;;951      tmp = (uint8_t)(CID_Tab[0] & 0x000000FF);
;;;952      cardinfo->SD_cid.ProdName1 = tmp << 24;
0001da  0612              LSLS     r2,r2,#24
0001dc  6102              STR      r2,[r0,#0x10]
;;;953    
;;;954      /*!< Byte 4 */
;;;955      tmp = (uint8_t)((CID_Tab[1] & 0xFF000000) >> 24);
0001de  6862              LDR      r2,[r4,#4]  ; CID_Tab
;;;956      cardinfo->SD_cid.ProdName1 |= tmp << 16;
0001e0  6906              LDR      r6,[r0,#0x10]
0001e2  0e15              LSRS     r5,r2,#24             ;955
0001e4  ea464505          ORR      r5,r6,r5,LSL #16
0001e8  6105              STR      r5,[r0,#0x10]
;;;957    
;;;958      /*!< Byte 5 */
;;;959      tmp = (uint8_t)((CID_Tab[1] & 0x00FF0000) >> 16);
;;;960      cardinfo->SD_cid.ProdName1 |= tmp << 8;
0001ea  6906              LDR      r6,[r0,#0x10]
0001ec  f3c24507          UBFX     r5,r2,#16,#8          ;959
0001f0  ea462505          ORR      r5,r6,r5,LSL #8
0001f4  6105              STR      r5,[r0,#0x10]
;;;961    
;;;962      /*!< Byte 6 */
;;;963      tmp = (uint8_t)((CID_Tab[1] & 0x0000FF00) >> 8);
;;;964      cardinfo->SD_cid.ProdName1 |= tmp;
0001f6  6906              LDR      r6,[r0,#0x10]
0001f8  f3c22507          UBFX     r5,r2,#8,#8           ;963
0001fc  432e              ORRS     r6,r6,r5
0001fe  6106              STR      r6,[r0,#0x10]
;;;965    
;;;966      /*!< Byte 7 */
;;;967      tmp = (uint8_t)(CID_Tab[1] & 0x000000FF);
;;;968      cardinfo->SD_cid.ProdName2 = tmp;
000200  7502              STRB     r2,[r0,#0x14]
;;;969    
;;;970      /*!< Byte 8 */
;;;971      tmp = (uint8_t)((CID_Tab[2] & 0xFF000000) >> 24);
000202  68a2              LDR      r2,[r4,#8]  ; CID_Tab
000204  0e15              LSRS     r5,r2,#24
;;;972      cardinfo->SD_cid.ProdRev = tmp;
000206  7545              STRB     r5,[r0,#0x15]
;;;973    
;;;974      /*!< Byte 9 */
;;;975      tmp = (uint8_t)((CID_Tab[2] & 0x00FF0000) >> 16);
000208  0c15              LSRS     r5,r2,#16
;;;976      cardinfo->SD_cid.ProdSN = tmp << 24;
00020a  062d              LSLS     r5,r5,#24
00020c  6185              STR      r5,[r0,#0x18]
;;;977    
;;;978      /*!< Byte 10 */
;;;979      tmp = (uint8_t)((CID_Tab[2] & 0x0000FF00) >> 8);
;;;980      cardinfo->SD_cid.ProdSN |= tmp << 16;
00020e  6986              LDR      r6,[r0,#0x18]
000210  f3c22507          UBFX     r5,r2,#8,#8           ;979
000214  ea464505          ORR      r5,r6,r5,LSL #16
000218  6185              STR      r5,[r0,#0x18]
;;;981    
;;;982      /*!< Byte 11 */
;;;983      tmp = (uint8_t)(CID_Tab[2] & 0x000000FF);
;;;984      cardinfo->SD_cid.ProdSN |= tmp << 8;
00021a  6985              LDR      r5,[r0,#0x18]
00021c  b2d2              UXTB     r2,r2                 ;983
00021e  ea452202          ORR      r2,r5,r2,LSL #8
000222  6182              STR      r2,[r0,#0x18]
;;;985    
;;;986      /*!< Byte 12 */
;;;987      tmp = (uint8_t)((CID_Tab[3] & 0xFF000000) >> 24);
;;;988      cardinfo->SD_cid.ProdSN |= tmp;
000224  68e2              LDR      r2,[r4,#0xc]  ; CID_Tab
000226  6985              LDR      r5,[r0,#0x18]
000228  ea456512          ORR      r5,r5,r2,LSR #24
00022c  6185              STR      r5,[r0,#0x18]
;;;989    
;;;990      /*!< Byte 13 */
;;;991      tmp = (uint8_t)((CID_Tab[3] & 0x00FF0000) >> 16);
;;;992      cardinfo->SD_cid.Reserved1 |= (tmp & 0xF0) >> 4;
00022e  7f05              LDRB     r5,[r0,#0x1c]
000230  f3c24407          UBFX     r4,r2,#16,#8          ;991
000234  ea451514          ORR      r5,r5,r4,LSR #4
000238  7705              STRB     r5,[r0,#0x1c]
;;;993      cardinfo->SD_cid.ManufactDate = (tmp & 0x0F) << 8;
00023a  0724              LSLS     r4,r4,#28
00023c  0d24              LSRS     r4,r4,#20
00023e  83c4              STRH     r4,[r0,#0x1e]
;;;994    
;;;995      /*!< Byte 14 */
;;;996      tmp = (uint8_t)((CID_Tab[3] & 0x0000FF00) >> 8);
;;;997      cardinfo->SD_cid.ManufactDate |= tmp;
000240  8bc5              LDRH     r5,[r0,#0x1e]
000242  f3c22407          UBFX     r4,r2,#8,#8           ;996
000246  4325              ORRS     r5,r5,r4
000248  83c5              STRH     r5,[r0,#0x1e]
;;;998    
;;;999      /*!< Byte 15 */
;;;1000     tmp = (uint8_t)(CID_Tab[3] & 0x000000FF);
;;;1001     cardinfo->SD_cid.CID_CRC = (tmp & 0xFE) >> 1;
00024a  f3c20246          UBFX     r2,r2,#1,#7
00024e  f8802020          STRB     r2,[r0,#0x20]
;;;1002     cardinfo->SD_cid.Reserved2 = 1;
000252  f8803021          STRB     r3,[r0,#0x21]
;;;1003     
;;;1004     return(errorstatus);
000256  4608              MOV      r0,r1
;;;1005   }
000258  e8bd83f0          POP      {r4-r9,pc}
;;;1006   
                          ENDP

                  |L14.604|
                          DCD      ||.data||
                  |L14.608|
                          DCD      ||.bss||

                          AREA ||i.SD_GetCardStatus||, CODE, READONLY, ALIGN=2

                  SD_GetCardStatus PROC
;;;1016     */
;;;1017   SD_Error SD_GetCardStatus(SD_CardStatus *cardstatus)
000000  b510              PUSH     {r4,lr}
;;;1018   {
000002  4604              MOV      r4,r0
;;;1019     SD_Error errorstatus = SD_OK;
;;;1020     uint8_t tmp = 0;
;;;1021   
;;;1022     errorstatus = SD_SendSDStatus((uint32_t *)SDSTATUS_Tab);
000004  481d              LDR      r0,|L15.124|
000006  f7fffffe          BL       SD_SendSDStatus
00000a  0001              MOVS     r1,r0
;;;1023   
;;;1024     if (errorstatus  != SD_OK)
00000c  d135              BNE      |L15.122|
;;;1025     {
;;;1026       return(errorstatus);
;;;1027     }
;;;1028   
;;;1029     /*!< Byte 0 */
;;;1030     tmp = (uint8_t)((SDSTATUS_Tab[0] & 0xC0) >> 6);
00000e  481b              LDR      r0,|L15.124|
000010  7802              LDRB     r2,[r0,#0]  ; SDSTATUS_Tab
000012  0992              LSRS     r2,r2,#6
;;;1031     cardstatus->DAT_BUS_WIDTH = tmp;
000014  7022              STRB     r2,[r4,#0]
;;;1032   
;;;1033     /*!< Byte 0 */
;;;1034     tmp = (uint8_t)((SDSTATUS_Tab[0] & 0x20) >> 5);
000016  7802              LDRB     r2,[r0,#0]  ; SDSTATUS_Tab
000018  f3c21240          UBFX     r2,r2,#5,#1
;;;1035     cardstatus->SECURED_MODE = tmp;
00001c  7062              STRB     r2,[r4,#1]
;;;1036   
;;;1037     /*!< Byte 2 */
;;;1038     tmp = (uint8_t)((SDSTATUS_Tab[2] & 0xFF));
00001e  7882              LDRB     r2,[r0,#2]  ; SDSTATUS_Tab
;;;1039     cardstatus->SD_CARD_TYPE = tmp << 8;
000020  0212              LSLS     r2,r2,#8
000022  8062              STRH     r2,[r4,#2]
;;;1040   
;;;1041     /*!< Byte 3 */
;;;1042     tmp = (uint8_t)((SDSTATUS_Tab[3] & 0xFF));
000024  78c2              LDRB     r2,[r0,#3]  ; SDSTATUS_Tab
;;;1043     cardstatus->SD_CARD_TYPE |= tmp;
000026  8863              LDRH     r3,[r4,#2]
000028  4313              ORRS     r3,r3,r2
00002a  8063              STRH     r3,[r4,#2]
;;;1044   
;;;1045     /*!< Byte 4 */
;;;1046     tmp = (uint8_t)(SDSTATUS_Tab[4] & 0xFF);
00002c  7902              LDRB     r2,[r0,#4]  ; SDSTATUS_Tab
;;;1047     cardstatus->SIZE_OF_PROTECTED_AREA = tmp << 24;
00002e  0612              LSLS     r2,r2,#24
000030  6062              STR      r2,[r4,#4]
;;;1048   
;;;1049     /*!< Byte 5 */
;;;1050     tmp = (uint8_t)(SDSTATUS_Tab[5] & 0xFF);
000032  7942              LDRB     r2,[r0,#5]  ; SDSTATUS_Tab
;;;1051     cardstatus->SIZE_OF_PROTECTED_AREA |= tmp << 16;
000034  6863              LDR      r3,[r4,#4]
000036  ea434202          ORR      r2,r3,r2,LSL #16
00003a  6062              STR      r2,[r4,#4]
;;;1052   
;;;1053     /*!< Byte 6 */
;;;1054     tmp = (uint8_t)(SDSTATUS_Tab[6] & 0xFF);
00003c  7982              LDRB     r2,[r0,#6]  ; SDSTATUS_Tab
;;;1055     cardstatus->SIZE_OF_PROTECTED_AREA |= tmp << 8;
00003e  6863              LDR      r3,[r4,#4]
000040  ea432202          ORR      r2,r3,r2,LSL #8
000044  6062              STR      r2,[r4,#4]
;;;1056   
;;;1057     /*!< Byte 7 */
;;;1058     tmp = (uint8_t)(SDSTATUS_Tab[7] & 0xFF);
000046  79c2              LDRB     r2,[r0,#7]  ; SDSTATUS_Tab
;;;1059     cardstatus->SIZE_OF_PROTECTED_AREA |= tmp;
000048  6863              LDR      r3,[r4,#4]
00004a  4313              ORRS     r3,r3,r2
00004c  6063              STR      r3,[r4,#4]
;;;1060   
;;;1061     /*!< Byte 8 */
;;;1062     tmp = (uint8_t)((SDSTATUS_Tab[8] & 0xFF));
00004e  7a02              LDRB     r2,[r0,#8]  ; SDSTATUS_Tab
;;;1063     cardstatus->SPEED_CLASS = tmp;
000050  7222              STRB     r2,[r4,#8]
;;;1064   
;;;1065     /*!< Byte 9 */
;;;1066     tmp = (uint8_t)((SDSTATUS_Tab[9] & 0xFF));
000052  7a42              LDRB     r2,[r0,#9]  ; SDSTATUS_Tab
;;;1067     cardstatus->PERFORMANCE_MOVE = tmp;
000054  7262              STRB     r2,[r4,#9]
;;;1068   
;;;1069     /*!< Byte 10 */
;;;1070     tmp = (uint8_t)((SDSTATUS_Tab[10] & 0xF0) >> 4);
000056  7a82              LDRB     r2,[r0,#0xa]  ; SDSTATUS_Tab
000058  0912              LSRS     r2,r2,#4
;;;1071     cardstatus->AU_SIZE = tmp;
00005a  72a2              STRB     r2,[r4,#0xa]
;;;1072   
;;;1073     /*!< Byte 11 */
;;;1074     tmp = (uint8_t)(SDSTATUS_Tab[11] & 0xFF);
00005c  7ac2              LDRB     r2,[r0,#0xb]  ; SDSTATUS_Tab
;;;1075     cardstatus->ERASE_SIZE = tmp << 8;
00005e  0212              LSLS     r2,r2,#8
000060  81a2              STRH     r2,[r4,#0xc]
;;;1076   
;;;1077     /*!< Byte 12 */
;;;1078     tmp = (uint8_t)(SDSTATUS_Tab[12] & 0xFF);
000062  7b02              LDRB     r2,[r0,#0xc]  ; SDSTATUS_Tab
;;;1079     cardstatus->ERASE_SIZE |= tmp;
000064  89a3              LDRH     r3,[r4,#0xc]
000066  4313              ORRS     r3,r3,r2
000068  81a3              STRH     r3,[r4,#0xc]
;;;1080   
;;;1081     /*!< Byte 13 */
;;;1082     tmp = (uint8_t)((SDSTATUS_Tab[13] & 0xFC) >> 2);
00006a  7b42              LDRB     r2,[r0,#0xd]  ; SDSTATUS_Tab
00006c  0892              LSRS     r2,r2,#2
;;;1083     cardstatus->ERASE_TIMEOUT = tmp;
00006e  73a2              STRB     r2,[r4,#0xe]
;;;1084   
;;;1085     /*!< Byte 13 */
;;;1086     tmp = (uint8_t)((SDSTATUS_Tab[13] & 0x3));
000070  7b40              LDRB     r0,[r0,#0xd]  ; SDSTATUS_Tab
000072  f0000003          AND      r0,r0,#3
;;;1087     cardstatus->ERASE_OFFSET = tmp;
000076  73e0              STRB     r0,[r4,#0xf]
;;;1088    
;;;1089     return(errorstatus);
000078  4608              MOV      r0,r1
                  |L15.122|
;;;1090   }
00007a  bd10              POP      {r4,pc}
;;;1091   
                          ENDP

                  |L15.124|
                          DCD      ||.bss||+0x20

                          AREA ||i.SD_GetState||, CODE, READONLY, ALIGN=1

                  SD_GetState PROC
;;;512      */
;;;513    SDCardState SD_GetState(void)
000000  b508              PUSH     {r3,lr}
;;;514    {
;;;515      uint32_t resp1 = 0;
000002  2000              MOVS     r0,#0
;;;516      
;;;517      if(SD_Detect()== SD_PRESENT)
000004  9000              STR      r0,[sp,#0]
000006  f7fffffe          BL       SD_Detect
00000a  2801              CMP      r0,#1
00000c  d103              BNE      |L16.22|
;;;518      {
;;;519        if (SD_SendStatus(&resp1) != SD_OK)
00000e  4668              MOV      r0,sp
000010  f7fffffe          BL       SD_SendStatus
000014  b108              CBZ      r0,|L16.26|
                  |L16.22|
;;;520        {
;;;521          return SD_CARD_ERROR;
;;;522        }
;;;523        else
;;;524        {
;;;525          return (SDCardState)((resp1 >> 9) & 0x0F);
;;;526        }
;;;527      }
;;;528      else
;;;529      {
;;;530        return SD_CARD_ERROR;
000016  20ff              MOVS     r0,#0xff
;;;531      }
;;;532    }
000018  bd08              POP      {r3,pc}
                  |L16.26|
00001a  9800              LDR      r0,[sp,#0]            ;525
00001c  f3c02043          UBFX     r0,r0,#9,#4           ;525
000020  bd08              POP      {r3,pc}
;;;533    
                          ENDP


                          AREA ||i.SD_GetStatus||, CODE, READONLY, ALIGN=1

                  SD_GetStatus PROC
;;;487      */
;;;488    SDTransferState SD_GetStatus(void)
000000  b510              PUSH     {r4,lr}
;;;489    {
;;;490      SDCardState cardstate =  SD_CARD_TRANSFER;
;;;491    
;;;492      cardstate = SD_GetState();
000002  f7fffffe          BL       SD_GetState
;;;493      
;;;494      if (cardstate == SD_CARD_TRANSFER)
000006  2804              CMP      r0,#4
000008  d003              BEQ      |L17.18|
;;;495      {
;;;496        return(SD_TRANSFER_OK);
;;;497      }
;;;498      else if(cardstate == SD_CARD_ERROR)
00000a  28ff              CMP      r0,#0xff
00000c  d003              BEQ      |L17.22|
;;;499      {
;;;500        return (SD_TRANSFER_ERROR);
;;;501      }
;;;502      else
;;;503      {
;;;504        return(SD_TRANSFER_BUSY);
00000e  2001              MOVS     r0,#1
;;;505      }
;;;506    }
000010  bd10              POP      {r4,pc}
                  |L17.18|
000012  2000              MOVS     r0,#0                 ;496
000014  bd10              POP      {r4,pc}
                  |L17.22|
000016  2002              MOVS     r0,#2                 ;500
000018  bd10              POP      {r4,pc}
;;;507    
                          ENDP


                          AREA ||i.SD_GetTransferState||, CODE, READONLY, ALIGN=2

                  SD_GetTransferState PROC
;;;1734     */
;;;1735   SDTransferState SD_GetTransferState(void)
000000  4803              LDR      r0,|L18.16|
;;;1736   {
;;;1737     if (SDIO->STA & (SDIO_FLAG_TXACT | SDIO_FLAG_RXACT))
000002  6b40              LDR      r0,[r0,#0x34]
000004  f4105040          ANDS     r0,r0,#0x3000
000008  d000              BEQ      |L18.12|
;;;1738     {
;;;1739       return(SD_TRANSFER_BUSY);
00000a  2001              MOVS     r0,#1
                  |L18.12|
;;;1740     }
;;;1741     else
;;;1742     {
;;;1743       return(SD_TRANSFER_OK);
;;;1744     }
;;;1745   }
00000c  4770              BX       lr
;;;1746   
                          ENDP

00000e  0000              DCW      0x0000
                  |L18.16|
                          DCD      0x40018000

                          AREA ||i.SD_Init||, CODE, READONLY, ALIGN=2

                  SD_Init PROC
;;;424      */
;;;425    SD_Error SD_Init(void)
000000  b57c              PUSH     {r2-r6,lr}
;;;426    {
;;;427      __IO SD_Error errorstatus = SD_OK;
000002  2400              MOVS     r4,#0
000004  f88d4000          STRB     r4,[sp,#0]
000008  2031              MOVS     r0,#0x31
00000a  f88d0004          STRB     r0,[sp,#4]
00000e  f88d4005          STRB     r4,[sp,#5]
000012  f88d4006          STRB     r4,[sp,#6]
000016  2501              MOVS     r5,#1
000018  f88d5007          STRB     r5,[sp,#7]
00001c  a801              ADD      r0,sp,#4
00001e  f7fffffe          BL       NVIC_Init
000022  203b              MOVS     r0,#0x3b
000024  f88d0004          STRB     r0,[sp,#4]
000028  f88d5005          STRB     r5,[sp,#5]
00002c  a801              ADD      r0,sp,#4
00002e  f7fffffe          BL       NVIC_Init
;;;428      
;;;429      /* ≈‰÷√NVIC */
;;;430      SDIO_Interrupts_Config();
;;;431    	
;;;432      /* SDIO Peripheral Low Level Init */
;;;433      SD_LowLevel_Init();
000032  f7fffffe          BL       SD_LowLevel_Init
;;;434    
;;;435      SDIO_DeInit();
000036  f7fffffe          BL       SDIO_DeInit
;;;436    
;;;437      errorstatus = SD_PowerON();
00003a  f7fffffe          BL       SD_PowerON
00003e  f88d0000          STRB     r0,[sp,#0]
;;;438    
;;;439      if (errorstatus != SD_OK)
000042  f89d0000          LDRB     r0,[sp,#0]
000046  bb50              CBNZ     r0,|L19.158|
;;;440      {
;;;441        /*!< CMD Response TimeOut (wait for CMDSENT flag) */
;;;442        return(errorstatus);
;;;443      }
;;;444    
;;;445      errorstatus = SD_InitializeCards();
000048  f7fffffe          BL       SD_InitializeCards
00004c  f88d0000          STRB     r0,[sp,#0]
;;;446    
;;;447      if (errorstatus != SD_OK)
000050  f89d0000          LDRB     r0,[sp,#0]
000054  bb18              CBNZ     r0,|L19.158|
;;;448      {
;;;449        /*!< CMD Response TimeOut (wait for CMDSENT flag) */
;;;450        return(errorstatus);
;;;451      }
;;;452    
;;;453      /*!< Configure the SDIO peripheral */
;;;454      /*!< SDIO_CK = SDIOCLK / (SDIO_TRANSFER_CLK_DIV + 2) */
;;;455      SDIO_InitStructure.SDIO_ClockDiv = SDIO_TRANSFER_CLK_DIV;
000056  4813              LDR      r0,|L19.164|
000058  7505              STRB     r5,[r0,#0x14]
;;;456      SDIO_InitStructure.SDIO_ClockEdge = SDIO_ClockEdge_Rising;
;;;457      SDIO_InitStructure.SDIO_ClockBypass = SDIO_ClockBypass_Disable;
00005a  6004              STR      r4,[r0,#0]  ; SDIO_InitStructure
;;;458      SDIO_InitStructure.SDIO_ClockPowerSave = SDIO_ClockPowerSave_Disable;
00005c  6044              STR      r4,[r0,#4]  ; SDIO_InitStructure
;;;459      SDIO_InitStructure.SDIO_BusWide = SDIO_BusWide_1b;
00005e  6084              STR      r4,[r0,#8]  ; SDIO_InitStructure
;;;460      SDIO_InitStructure.SDIO_HardwareFlowControl = SDIO_HardwareFlowControl_Disable;
000060  60c4              STR      r4,[r0,#0xc]  ; SDIO_InitStructure
;;;461      SDIO_Init(&SDIO_InitStructure);
000062  6104              STR      r4,[r0,#0x10]  ; SDIO_InitStructure
000064  f7fffffe          BL       SDIO_Init
;;;462    
;;;463      /*----------------- Read CSD/CID MSD registers ------------------*/
;;;464      errorstatus = SD_GetCardInfo(&SDCardInfo);
000068  480e              LDR      r0,|L19.164|
00006a  3858              SUBS     r0,r0,#0x58
00006c  f7fffffe          BL       SD_GetCardInfo
000070  f88d0000          STRB     r0,[sp,#0]
;;;465    
;;;466      if (errorstatus == SD_OK)
000074  f89d0000          LDRB     r0,[sp,#0]
000078  b940              CBNZ     r0,|L19.140|
;;;467      {
;;;468        /*----------------- Select Card --------------------------------*/
;;;469        errorstatus = SD_SelectDeselect((uint32_t) (SDCardInfo.RCA << 16));
00007a  480a              LDR      r0,|L19.164|
00007c  3858              SUBS     r0,r0,#0x58
00007e  f8b00054          LDRH     r0,[r0,#0x54]  ; SDCardInfo
000082  0400              LSLS     r0,r0,#16
000084  f7fffffe          BL       SD_SelectDeselect
000088  f88d0000          STRB     r0,[sp,#0]
                  |L19.140|
;;;470      }
;;;471    
;;;472      if (errorstatus == SD_OK)
00008c  f89d0000          LDRB     r0,[sp,#0]
000090  b928              CBNZ     r0,|L19.158|
;;;473      {
;;;474        errorstatus = SD_EnableWideBusOperation(SDIO_BusWide_4b);
000092  f44f6000          MOV      r0,#0x800
000096  f7fffffe          BL       SD_EnableWideBusOperation
00009a  f88d0000          STRB     r0,[sp,#0]
                  |L19.158|
;;;475      }  
;;;476    
;;;477      return(errorstatus);
00009e  f89d0000          LDRB     r0,[sp,#0]
;;;478    }
0000a2  bd7c              POP      {r2-r6,pc}
;;;479    
                          ENDP

                  |L19.164|
                          DCD      ||.bss||+0x88

                          AREA ||i.SD_InitializeCards||, CODE, READONLY, ALIGN=2

                  SD_InitializeCards PROC
;;;715      */
;;;716    SD_Error SD_InitializeCards(void)
000000  e92d4ff8          PUSH     {r3-r11,lr}
;;;717    {
;;;718      SD_Error errorstatus = SD_OK;
;;;719      uint16_t rca = 0x01;
000004  2001              MOVS     r0,#1
000006  2500              MOVS     r5,#0                 ;718
000008  f8ad0000          STRH     r0,[sp,#0]
;;;720    
;;;721      if (SDIO_GetPowerState() == SDIO_PowerState_OFF)
00000c  f7fffffe          BL       SDIO_GetPowerState
000010  b3a8              CBZ      r0,|L20.126|
;;;722      {
;;;723        errorstatus = SD_REQUEST_NOT_APPLICABLE;
;;;724        return(errorstatus);
;;;725      }
;;;726    
;;;727      if (SDIO_SECURE_DIGITAL_IO_CARD != CardType)
000012  f8df90e0          LDR      r9,|L20.244|
000016  f8d90004          LDR      r0,[r9,#4]  ; CardType
00001a  2804              CMP      r0,#4
00001c  d068              BEQ      |L20.240|
;;;728      {
;;;729        /*!< Send CMD2 ALL_SEND_CID */
;;;730        SDIO_CmdInitStructure.SDIO_Argument = 0x0;
00001e  4c36              LDR      r4,|L20.248|
;;;731        SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_ALL_SEND_CID;
;;;732        SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Long;
000020  f04f0ac0          MOV      r10,#0xc0
000024  2600              MOVS     r6,#0                 ;730
000026  2002              MOVS     r0,#2                 ;731
000028  f8c4a008          STR      r10,[r4,#8]  ; SDIO_CmdInitStructure
00002c  e9c46000          STRD     r6,r0,[r4,#0]
;;;733        SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;734        SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
000030  f44f6880          MOV      r8,#0x400
;;;735        SDIO_SendCommand(&SDIO_CmdInitStructure);
000034  e9c46803          STRD     r6,r8,[r4,#0xc]
000038  4620              MOV      r0,r4
00003a  f7fffffe          BL       SDIO_SendCommand
;;;736    
;;;737        errorstatus = CmdResp2Error();
00003e  f7fffffe          BL       CmdResp2Error
000042  0005              MOVS     r5,r0
;;;738    
;;;739        if (SD_OK != errorstatus)
000044  d11d              BNE      |L20.130|
;;;740        {
;;;741          return(errorstatus);
;;;742        }
;;;743    
;;;744        CID_Tab[0] = SDIO_GetResponse(SDIO_RESP1);
000046  f7fffffe          BL       SDIO_GetResponse
00004a  f1a40790          SUB      r7,r4,#0x90
;;;745        CID_Tab[1] = SDIO_GetResponse(SDIO_RESP2);
00004e  6038              STR      r0,[r7,#0]  ; CID_Tab
000050  2004              MOVS     r0,#4
000052  f7fffffe          BL       SDIO_GetResponse
;;;746        CID_Tab[2] = SDIO_GetResponse(SDIO_RESP3);
000056  6078              STR      r0,[r7,#4]  ; CID_Tab
000058  2008              MOVS     r0,#8
00005a  f7fffffe          BL       SDIO_GetResponse
;;;747        CID_Tab[3] = SDIO_GetResponse(SDIO_RESP4);
00005e  60b8              STR      r0,[r7,#8]  ; CID_Tab
000060  200c              MOVS     r0,#0xc
000062  f7fffffe          BL       SDIO_GetResponse
;;;748      }
;;;749      if ((SDIO_STD_CAPACITY_SD_CARD_V1_1 == CardType) ||  (SDIO_STD_CAPACITY_SD_CARD_V2_0 == CardType) ||  (SDIO_SECURE_DIGITAL_IO_COMBO_CARD == CardType)
000066  60f8              STR      r0,[r7,#0xc]  ; CID_Tab
000068  f8d90004          LDR      r0,[r9,#4]            ;747  ; CardType
00006c  464f              MOV      r7,r9
00006e  b150              CBZ      r0,|L20.134|
000070  2801              CMP      r0,#1
000072  d008              BEQ      |L20.134|
000074  2806              CMP      r0,#6
000076  d006              BEQ      |L20.134|
;;;750          ||  (SDIO_HIGH_CAPACITY_SD_CARD == CardType))
000078  2802              CMP      r0,#2
00007a  d004              BEQ      |L20.134|
00007c  e013              B        |L20.166|
                  |L20.126|
00007e  e7ff              B        |L20.128|
                  |L20.128|
000080  2025              MOVS     r0,#0x25              ;723
                  |L20.130|
;;;751      {
;;;752        /*!< Send CMD3 SET_REL_ADDR with argument 0 */
;;;753        /*!< SD Card publishes its RCA. */
;;;754        SDIO_CmdInitStructure.SDIO_Argument = 0x00;
;;;755        SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_SET_REL_ADDR;
;;;756        SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
;;;757        SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;758        SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
;;;759        SDIO_SendCommand(&SDIO_CmdInitStructure);
;;;760    
;;;761        errorstatus = CmdResp6Error(SD_CMD_SET_REL_ADDR, &rca);
;;;762    
;;;763        if (SD_OK != errorstatus)
;;;764        {
;;;765          return(errorstatus);
;;;766        }
;;;767      }
;;;768    
;;;769      if (SDIO_SECURE_DIGITAL_IO_CARD != CardType)
;;;770      {
;;;771        RCA = rca;
;;;772    
;;;773        /*!< Send CMD9 SEND_CSD with argument as card's RCA */
;;;774        SDIO_CmdInitStructure.SDIO_Argument = (uint32_t)(rca << 16);
;;;775        SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_SEND_CSD;
;;;776        SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Long;
;;;777        SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;778        SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
;;;779        SDIO_SendCommand(&SDIO_CmdInitStructure);
;;;780    
;;;781        errorstatus = CmdResp2Error();
;;;782    
;;;783        if (SD_OK != errorstatus)
;;;784        {
;;;785          return(errorstatus);
;;;786        }
;;;787    
;;;788        CSD_Tab[0] = SDIO_GetResponse(SDIO_RESP1);
;;;789        CSD_Tab[1] = SDIO_GetResponse(SDIO_RESP2);
;;;790        CSD_Tab[2] = SDIO_GetResponse(SDIO_RESP3);
;;;791        CSD_Tab[3] = SDIO_GetResponse(SDIO_RESP4);
;;;792      }
;;;793    
;;;794      errorstatus = SD_OK; /*!< All cards get intialized */
;;;795    
;;;796      return(errorstatus);
;;;797    }
000082  e8bd8ff8          POP      {r3-r11,pc}
                  |L20.134|
000086  2003              MOVS     r0,#3                 ;755
000088  e8e46002          STRD     r6,r0,[r4],#8         ;755
00008c  2040              MOVS     r0,#0x40              ;756
00008e  e8840141          STM      r4,{r0,r6,r8}         ;756
000092  4819              LDR      r0,|L20.248|
000094  3c08              SUBS     r4,r4,#8              ;759
000096  f7fffffe          BL       SDIO_SendCommand
00009a  4669              MOV      r1,sp                 ;761
00009c  2003              MOVS     r0,#3                 ;761
00009e  f7fffffe          BL       CmdResp6Error
0000a2  0005              MOVS     r5,r0                 ;761
0000a4  d1ed              BNE      |L20.130|
                  |L20.166|
0000a6  6878              LDR      r0,[r7,#4]            ;769  ; CardType
0000a8  2804              CMP      r0,#4                 ;769
0000aa  d021              BEQ      |L20.240|
0000ac  f8bd0000          LDRH     r0,[sp,#0]            ;771
0000b0  60b8              STR      r0,[r7,#8]            ;774  ; RCA
0000b2  0400              LSLS     r0,r0,#16             ;774
0000b4  6020              STR      r0,[r4,#0]            ;775  ; SDIO_CmdInitStructure
0000b6  2009              MOVS     r0,#9                 ;775
0000b8  e9c40a01          STRD     r0,r10,[r4,#4]        ;775
0000bc  e9c46803          STRD     r6,r8,[r4,#0xc]       ;775
0000c0  480d              LDR      r0,|L20.248|
0000c2  f7fffffe          BL       SDIO_SendCommand
0000c6  f7fffffe          BL       CmdResp2Error
0000ca  0005              MOVS     r5,r0                 ;781
0000cc  d1d9              BNE      |L20.130|
0000ce  f7fffffe          BL       SDIO_GetResponse
0000d2  4c09              LDR      r4,|L20.248|
0000d4  3ca0              SUBS     r4,r4,#0xa0           ;788
0000d6  6020              STR      r0,[r4,#0]            ;789  ; CSD_Tab
0000d8  2004              MOVS     r0,#4                 ;789
0000da  f7fffffe          BL       SDIO_GetResponse
0000de  6060              STR      r0,[r4,#4]            ;790  ; CSD_Tab
0000e0  2008              MOVS     r0,#8                 ;790
0000e2  f7fffffe          BL       SDIO_GetResponse
0000e6  60a0              STR      r0,[r4,#8]            ;791  ; CSD_Tab
0000e8  200c              MOVS     r0,#0xc               ;791
0000ea  f7fffffe          BL       SDIO_GetResponse
0000ee  60e0              STR      r0,[r4,#0xc]          ;791  ; CSD_Tab
                  |L20.240|
0000f0  4628              MOV      r0,r5                 ;796
0000f2  e7c6              B        |L20.130|
;;;798    
                          ENDP

                  |L20.244|
                          DCD      ||.data||
                  |L20.248|
                          DCD      ||.bss||+0xa0

                          AREA ||i.SD_LowLevel_DMA_RxConfig||, CODE, READONLY, ALIGN=2

                  SD_LowLevel_DMA_RxConfig PROC
;;;2961     */
;;;2962   void SD_LowLevel_DMA_RxConfig(uint32_t *BufferDST, uint32_t BufferSize)
000000  b570              PUSH     {r4-r6,lr}
;;;2963   {
000002  4605              MOV      r5,r0
000004  b08c              SUB      sp,sp,#0x30
000006  460c              MOV      r4,r1
;;;2964   	DMA_InitTypeDef DMA_InitStructure;
;;;2965   	
;;;2966   	DMA_ClearFlag(SD_SDIO_DMA_FLAG_TC | SD_SDIO_DMA_FLAG_TE | SD_SDIO_DMA_FLAG_HT | SD_SDIO_DMA_FLAG_GL);
000008  4814              LDR      r0,|L21.92|
00000a  f7fffffe          BL       DMA_ClearFlag
;;;2967   	
;;;2968   	/*!< SDIO DMA CHANNEL disable */
;;;2969   	DMA_Cmd(SD_SDIO_DMA_CHANNEL, DISABLE);
00000e  4e14              LDR      r6,|L21.96|
000010  2100              MOVS     r1,#0
000012  4630              MOV      r0,r6
000014  f7fffffe          BL       DMA_Cmd
;;;2970   	
;;;2971   	/*!< SDIO DMA CHANNEL Config */
;;;2972   	DMA_InitStructure.DMA_PeripheralBaseAddr = (uint32_t)SDIO_FIFO_ADDRESS;
000018  4812              LDR      r0,|L21.100|
00001a  e9cd0500          STRD     r0,r5,[sp,#0]
;;;2973   	DMA_InitStructure.DMA_MemoryBaseAddr = (uint32_t)BufferDST;
;;;2974   	DMA_InitStructure.DMA_DIR = DMA_DIR_PeripheralSRC;
00001e  2000              MOVS     r0,#0
;;;2975   	DMA_InitStructure.DMA_BufferSize = BufferSize / 4;
000020  08a1              LSRS     r1,r4,#2
000022  e9cd0102          STRD     r0,r1,[sp,#8]
;;;2976   	DMA_InitStructure.DMA_PeripheralInc = DMA_PeripheralInc_Disable;
;;;2977   	DMA_InitStructure.DMA_MemoryInc = DMA_MemoryInc_Enable;
000026  2180              MOVS     r1,#0x80
000028  e9cd0104          STRD     r0,r1,[sp,#0x10]
;;;2978   	DMA_InitStructure.DMA_PeripheralDataSize = DMA_PeripheralDataSize_Word;
00002c  0089              LSLS     r1,r1,#2
;;;2979   	DMA_InitStructure.DMA_MemoryDataSize = DMA_MemoryDataSize_Word;
00002e  9106              STR      r1,[sp,#0x18]
000030  0089              LSLS     r1,r1,#2
000032  e9cd1007          STRD     r1,r0,[sp,#0x1c]
;;;2980   	DMA_InitStructure.DMA_Mode = DMA_Mode_Normal;
;;;2981   	DMA_InitStructure.DMA_Priority = DMA_Priority_High;
000036  0089              LSLS     r1,r1,#2
000038  e9cd1009          STRD     r1,r0,[sp,#0x24]
;;;2982   	DMA_InitStructure.DMA_M2M = DMA_M2M_Disable;
;;;2983   	DMA_Init(SD_SDIO_DMA_CHANNEL, &DMA_InitStructure);
00003c  4669              MOV      r1,sp
00003e  4630              MOV      r0,r6
000040  f7fffffe          BL       DMA_Init
;;;2984   	
;;;2985   	DMA_ITConfig(SD_SDIO_DMA_CHANNEL, DMA_IT_TC, ENABLE);
000044  2201              MOVS     r2,#1
000046  2102              MOVS     r1,#2
000048  4630              MOV      r0,r6
00004a  f7fffffe          BL       DMA_ITConfig
;;;2986   	
;;;2987   	/*!< SDIO DMA CHANNEL enable */
;;;2988   	DMA_Cmd(SD_SDIO_DMA_CHANNEL, ENABLE);  
00004e  2101              MOVS     r1,#1
000050  4630              MOV      r0,r6
000052  f7fffffe          BL       DMA_Cmd
;;;2989   }
000056  b00c              ADD      sp,sp,#0x30
000058  bd70              POP      {r4-r6,pc}
;;;2990   
                          ENDP

00005a  0000              DCW      0x0000
                  |L21.92|
                          DCD      0x1000f000
                  |L21.96|
                          DCD      0x40020444
                  |L21.100|
                          DCD      0x40018080

                          AREA ||i.SD_LowLevel_DMA_TxConfig||, CODE, READONLY, ALIGN=2

                  SD_LowLevel_DMA_TxConfig PROC
;;;2926     */
;;;2927   void SD_LowLevel_DMA_TxConfig(uint32_t *BufferSRC, uint32_t BufferSize)
000000  b570              PUSH     {r4-r6,lr}
;;;2928   {
000002  4605              MOV      r5,r0
000004  b08c              SUB      sp,sp,#0x30
000006  460c              MOV      r4,r1
;;;2929   	DMA_InitTypeDef DMA_InitStructure;
;;;2930   	
;;;2931   	DMA_ClearFlag(SD_SDIO_DMA_FLAG_TC | SD_SDIO_DMA_FLAG_TE | SD_SDIO_DMA_FLAG_HT | SD_SDIO_DMA_FLAG_GL);
000008  4814              LDR      r0,|L22.92|
00000a  f7fffffe          BL       DMA_ClearFlag
;;;2932   	
;;;2933   	/*!< DMA2 Channel4 disable */
;;;2934   	DMA_Cmd(SD_SDIO_DMA_CHANNEL, DISABLE);
00000e  4e14              LDR      r6,|L22.96|
000010  2100              MOVS     r1,#0
000012  4630              MOV      r0,r6
000014  f7fffffe          BL       DMA_Cmd
;;;2935   	
;;;2936   	/*!< SDIO DMA CHANNEL Config */
;;;2937   	DMA_InitStructure.DMA_PeripheralBaseAddr = (uint32_t)SDIO_FIFO_ADDRESS;
000018  4812              LDR      r0,|L22.100|
00001a  e9cd0500          STRD     r0,r5,[sp,#0]
;;;2938   	DMA_InitStructure.DMA_MemoryBaseAddr = (uint32_t)BufferSRC;
;;;2939   	DMA_InitStructure.DMA_DIR = DMA_DIR_PeripheralDST;
00001e  2010              MOVS     r0,#0x10
;;;2940   	DMA_InitStructure.DMA_BufferSize = BufferSize / 4;
000020  9002              STR      r0,[sp,#8]
000022  08a0              LSRS     r0,r4,#2
;;;2941   	DMA_InitStructure.DMA_PeripheralInc = DMA_PeripheralInc_Disable;
000024  9003              STR      r0,[sp,#0xc]
000026  2000              MOVS     r0,#0
;;;2942   	DMA_InitStructure.DMA_MemoryInc = DMA_MemoryInc_Enable;
000028  2180              MOVS     r1,#0x80
00002a  e9cd0104          STRD     r0,r1,[sp,#0x10]
;;;2943   	DMA_InitStructure.DMA_PeripheralDataSize = DMA_PeripheralDataSize_Word;
00002e  0089              LSLS     r1,r1,#2
;;;2944   	DMA_InitStructure.DMA_MemoryDataSize = DMA_MemoryDataSize_Word;
000030  9106              STR      r1,[sp,#0x18]
000032  0089              LSLS     r1,r1,#2
000034  e9cd1007          STRD     r1,r0,[sp,#0x1c]
;;;2945   	DMA_InitStructure.DMA_Mode = DMA_Mode_Normal;
;;;2946   	DMA_InitStructure.DMA_Priority = DMA_Priority_High;
000038  0089              LSLS     r1,r1,#2
00003a  e9cd1009          STRD     r1,r0,[sp,#0x24]
;;;2947   	DMA_InitStructure.DMA_M2M = DMA_M2M_Disable;
;;;2948   	DMA_Init(SD_SDIO_DMA_CHANNEL, &DMA_InitStructure);
00003e  4669              MOV      r1,sp
000040  4630              MOV      r0,r6
000042  f7fffffe          BL       DMA_Init
;;;2949   	
;;;2950   	DMA_ITConfig(SD_SDIO_DMA_CHANNEL, DMA_IT_TC, ENABLE);
000046  2201              MOVS     r2,#1
000048  2102              MOVS     r1,#2
00004a  4630              MOV      r0,r6
00004c  f7fffffe          BL       DMA_ITConfig
;;;2951   	
;;;2952   	/*!< SDIO DMA CHANNEL enable */
;;;2953   	DMA_Cmd(SD_SDIO_DMA_CHANNEL, ENABLE);  
000050  2101              MOVS     r1,#1
000052  4630              MOV      r0,r6
000054  f7fffffe          BL       DMA_Cmd
;;;2954   }
000058  b00c              ADD      sp,sp,#0x30
00005a  bd70              POP      {r4-r6,pc}
;;;2955   
                          ENDP

                  |L22.92|
                          DCD      0x1000f000
                  |L22.96|
                          DCD      0x40020444
                  |L22.100|
                          DCD      0x40018080

                          AREA ||i.SD_LowLevel_DeInit||, CODE, READONLY, ALIGN=2

                  SD_LowLevel_DeInit PROC
;;;2859     */
;;;2860   void SD_LowLevel_DeInit(void)
000000  b538              PUSH     {r3-r5,lr}
;;;2861   {
;;;2862   	GPIO_InitTypeDef  GPIO_InitStructure;
;;;2863   	
;;;2864   	/*!< Disable SDIO Clock */
;;;2865   	SDIO_ClockCmd(DISABLE);
000002  2000              MOVS     r0,#0
000004  f7fffffe          BL       SDIO_ClockCmd
;;;2866   	
;;;2867   	/*!< Set Power State to OFF */
;;;2868   	SDIO_SetPowerState(SDIO_PowerState_OFF);
000008  2000              MOVS     r0,#0
00000a  f7fffffe          BL       SDIO_SetPowerState
;;;2869   	
;;;2870   	/*!< DeInitializes the SDIO peripheral */
;;;2871   	SDIO_DeInit();
00000e  f7fffffe          BL       SDIO_DeInit
;;;2872   	
;;;2873   	/*!< Disable the SDIO AHB Clock */
;;;2874   	RCC_AHBPeriphClockCmd(RCC_AHBPeriph_SDIO, DISABLE);
000012  2100              MOVS     r1,#0
000014  f44f6080          MOV      r0,#0x400
000018  f7fffffe          BL       RCC_AHBPeriphClockCmd
;;;2875   	
;;;2876   	/*!< Configure PC.08, PC.09, PC.10, PC.11, PC.12 pin: D0, D1, D2, D3, CLK pin */
;;;2877   	GPIO_InitStructure.GPIO_Pin = GPIO_Pin_8 | GPIO_Pin_9 | GPIO_Pin_10 | GPIO_Pin_11 | GPIO_Pin_12;
00001c  f44f50f8          MOV      r0,#0x1f00
000020  f8ad0000          STRH     r0,[sp,#0]
;;;2878   	GPIO_InitStructure.GPIO_Mode = GPIO_Mode_IN_FLOATING;
000024  2404              MOVS     r4,#4
000026  f88d4003          STRB     r4,[sp,#3]
;;;2879   	GPIO_Init(GPIOC, &GPIO_InitStructure);
00002a  4669              MOV      r1,sp
00002c  4804              LDR      r0,|L23.64|
00002e  f7fffffe          BL       GPIO_Init
;;;2880   	
;;;2881   	/*!< Configure PD.02 CMD line */
;;;2882   	GPIO_InitStructure.GPIO_Pin = GPIO_Pin_2;
000032  f8ad4000          STRH     r4,[sp,#0]
;;;2883   	GPIO_Init(GPIOD, &GPIO_InitStructure);
000036  4669              MOV      r1,sp
000038  4802              LDR      r0,|L23.68|
00003a  f7fffffe          BL       GPIO_Init
;;;2884   }
00003e  bd38              POP      {r3-r5,pc}
;;;2885   
                          ENDP

                  |L23.64|
                          DCD      0x40011000
                  |L23.68|
                          DCD      0x40011400

                          AREA ||i.SD_LowLevel_Init||, CODE, READONLY, ALIGN=2

                  SD_LowLevel_Init PROC
;;;2891     */
;;;2892   void SD_LowLevel_Init(void)
000000  b538              PUSH     {r3-r5,lr}
;;;2893   {
;;;2894   	GPIO_InitTypeDef  GPIO_InitStructure;
;;;2895   	
;;;2896   	/*!< GPIOC and GPIOD Periph clock enable */
;;;2897   	RCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOC | RCC_APB2Periph_GPIOD | SD_DETECT_GPIO_CLK, ENABLE);
000002  2101              MOVS     r1,#1
000004  2030              MOVS     r0,#0x30
000006  f7fffffe          BL       RCC_APB2PeriphClockCmd
;;;2898   	
;;;2899   	/*!< Configure PC.08, PC.09, PC.10, PC.11, PC.12 pin: D0, D1, D2, D3, CLK pin */
;;;2900   	GPIO_InitStructure.GPIO_Pin = GPIO_Pin_8 | GPIO_Pin_9 | GPIO_Pin_10 | GPIO_Pin_11 | GPIO_Pin_12;
00000a  f44f50f8          MOV      r0,#0x1f00
00000e  f8ad0000          STRH     r0,[sp,#0]
;;;2901   	GPIO_InitStructure.GPIO_Speed = GPIO_Speed_50MHz;
000012  2003              MOVS     r0,#3
000014  f88d0002          STRB     r0,[sp,#2]
;;;2902   	GPIO_InitStructure.GPIO_Mode = GPIO_Mode_AF_PP;
000018  2018              MOVS     r0,#0x18
;;;2903   	GPIO_Init(GPIOC, &GPIO_InitStructure);
00001a  4c10              LDR      r4,|L24.92|
00001c  f88d0003          STRB     r0,[sp,#3]            ;2902
000020  4669              MOV      r1,sp
000022  4620              MOV      r0,r4
000024  f7fffffe          BL       GPIO_Init
;;;2904   	
;;;2905   	/*!< Configure PD.02 CMD line */
;;;2906   	GPIO_InitStructure.GPIO_Pin = GPIO_Pin_2;
000028  2004              MOVS     r0,#4
00002a  f8ad0000          STRH     r0,[sp,#0]
;;;2907   	GPIO_Init(GPIOD, &GPIO_InitStructure);
00002e  4669              MOV      r1,sp
000030  480b              LDR      r0,|L24.96|
000032  f7fffffe          BL       GPIO_Init
;;;2908   	
;;;2909   	/*!< Configure SD_SPI_DETECT_PIN pin: SD Card detect pin */
;;;2910   	GPIO_InitStructure.GPIO_Pin = SD_DETECT_PIN;
000036  2080              MOVS     r0,#0x80
000038  f8ad0000          STRH     r0,[sp,#0]
;;;2911   	GPIO_InitStructure.GPIO_Mode = GPIO_Mode_IPU;
00003c  2048              MOVS     r0,#0x48
00003e  f88d0003          STRB     r0,[sp,#3]
;;;2912   	GPIO_Init(SD_DETECT_GPIO_PORT, &GPIO_InitStructure);
000042  4669              MOV      r1,sp
000044  4620              MOV      r0,r4
000046  f7fffffe          BL       GPIO_Init
;;;2913   	
;;;2914   	/*!< Enable the SDIO AHB Clock */
;;;2915   	RCC_AHBPeriphClockCmd(RCC_AHBPeriph_SDIO, ENABLE);
00004a  2101              MOVS     r1,#1
00004c  0288              LSLS     r0,r1,#10
00004e  f7fffffe          BL       RCC_AHBPeriphClockCmd
;;;2916   	
;;;2917   	/*!< Enable the DMA2 Clock */
;;;2918   	RCC_AHBPeriphClockCmd(SD_SDIO_DMA_CLK, ENABLE);
000052  2101              MOVS     r1,#1
000054  2002              MOVS     r0,#2
000056  f7fffffe          BL       RCC_AHBPeriphClockCmd
;;;2919   }
00005a  bd38              POP      {r3-r5,pc}
;;;2920   
                          ENDP

                  |L24.92|
                          DCD      0x40011000
                  |L24.96|
                          DCD      0x40011400

                          AREA ||i.SD_PowerOFF||, CODE, READONLY, ALIGN=1

                  SD_PowerOFF PROC
;;;699      */
;;;700    SD_Error SD_PowerOFF(void)
000000  b510              PUSH     {r4,lr}
;;;701    {
;;;702      SD_Error errorstatus = SD_OK;
000002  2400              MOVS     r4,#0
;;;703    
;;;704      /*!< Set Power State to OFF */
;;;705      SDIO_SetPowerState(SDIO_PowerState_OFF);
000004  4620              MOV      r0,r4
000006  f7fffffe          BL       SDIO_SetPowerState
;;;706    
;;;707      return(errorstatus);
00000a  4620              MOV      r0,r4
;;;708    }
00000c  bd10              POP      {r4,pc}
;;;709    
                          ENDP


                          AREA ||i.SD_PowerON||, CODE, READONLY, ALIGN=2

                  SD_PowerON PROC
;;;556      */
;;;557    SD_Error SD_PowerON(void)
000000  e92d5ffc          PUSH     {r2-r12,lr}
;;;558    {
;;;559      __IO SD_Error errorstatus = SD_OK;
000004  2500              MOVS     r5,#0
000006  f88d5000          STRB     r5,[sp,#0]
;;;560      uint32_t response = 0, count = 0, validvoltage = 0;
;;;561      uint32_t SDType = SD_STD_CAPACITY;
;;;562    
;;;563      /*!< Power ON Sequence -----------------------------------------------------*/
;;;564      /*!< Configure the SDIO peripheral */
;;;565      /*!< SDIO_CK = SDIOCLK / (SDIO_INIT_CLK_DIV + 2) */
;;;566      /*!< SDIO_CK for initialization should not exceed 400 KHz */  
;;;567      SDIO_InitStructure.SDIO_ClockDiv = SDIO_INIT_CLK_DIV;
00000a  4872              LDR      r0,|L26.468|
00000c  21b2              MOVS     r1,#0xb2
00000e  46a9              MOV      r9,r5                 ;560
000010  7501              STRB     r1,[r0,#0x14]
;;;568      SDIO_InitStructure.SDIO_ClockEdge = SDIO_ClockEdge_Rising;
;;;569      SDIO_InitStructure.SDIO_ClockBypass = SDIO_ClockBypass_Disable;
000012  6005              STR      r5,[r0,#0]  ; SDIO_InitStructure
;;;570      SDIO_InitStructure.SDIO_ClockPowerSave = SDIO_ClockPowerSave_Disable;
000014  6045              STR      r5,[r0,#4]  ; SDIO_InitStructure
;;;571      SDIO_InitStructure.SDIO_BusWide = SDIO_BusWide_1b;
000016  6085              STR      r5,[r0,#8]  ; SDIO_InitStructure
;;;572      SDIO_InitStructure.SDIO_HardwareFlowControl = SDIO_HardwareFlowControl_Disable;
000018  60c5              STR      r5,[r0,#0xc]  ; SDIO_InitStructure
00001a  46a8              MOV      r8,r5                 ;561
;;;573      SDIO_Init(&SDIO_InitStructure);
00001c  6105              STR      r5,[r0,#0x10]  ; SDIO_InitStructure
00001e  f7fffffe          BL       SDIO_Init
;;;574    
;;;575      /*!< Set Power State to ON */
;;;576      SDIO_SetPowerState(SDIO_PowerState_ON);
000022  2003              MOVS     r0,#3
000024  f7fffffe          BL       SDIO_SetPowerState
;;;577    
;;;578      /*!< Enable SDIO Clock */
;;;579      SDIO_ClockCmd(ENABLE);
000028  2001              MOVS     r0,#1
00002a  f7fffffe          BL       SDIO_ClockCmd
;;;580    
;;;581      /*!< CMD0: GO_IDLE_STATE ---------------------------------------------------*/
;;;582      /*!< No CMD response required */
;;;583      SDIO_CmdInitStructure.SDIO_Argument = 0x0;
00002e  4c69              LDR      r4,|L26.468|
;;;584      SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_GO_IDLE_STATE;
;;;585      SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_No;
;;;586      SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;587      SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
000030  f44f6b80          MOV      r11,#0x400
000034  3418              ADDS     r4,r4,#0x18           ;583
;;;588      SDIO_SendCommand(&SDIO_CmdInitStructure);
000036  4620              MOV      r0,r4
000038  6025              STR      r5,[r4,#0]            ;584  ; SDIO_CmdInitStructure
00003a  6065              STR      r5,[r4,#4]            ;585  ; SDIO_CmdInitStructure
00003c  60a5              STR      r5,[r4,#8]  ; SDIO_CmdInitStructure
00003e  e9c45b03          STRD     r5,r11,[r4,#0xc]
000042  f7fffffe          BL       SDIO_SendCommand
000046  f44f3a80          MOV      r10,#0x10000
00004a  2700              MOVS     r7,#0
00004c  4656              MOV      r6,r10
;;;589    
;;;590      errorstatus = CmdError();
00004e  e001              B        |L26.84|
                  |L26.80|
000050  1e76              SUBS     r6,r6,#1
000052  d010              BEQ      |L26.118|
                  |L26.84|
000054  2080              MOVS     r0,#0x80
000056  f7fffffe          BL       SDIO_GetFlagStatus
00005a  2800              CMP      r0,#0
00005c  d0f8              BEQ      |L26.80|
00005e  b156              CBZ      r6,|L26.118|
000060  f24050ff          MOV      r0,#0x5ff
000064  f7fffffe          BL       SDIO_ClearFlag
                  |L26.104|
000068  f88d7000          STRB     r7,[sp,#0]
;;;591    
;;;592      if (errorstatus != SD_OK)
00006c  f89d0000          LDRB     r0,[sp,#0]
000070  2800              CMP      r0,#0
000072  d154              BNE      |L26.286|
000074  e001              B        |L26.122|
                  |L26.118|
000076  2703              MOVS     r7,#3
000078  e7f6              B        |L26.104|
                  |L26.122|
;;;593      {
;;;594        /*!< CMD Response TimeOut (wait for CMDSENT flag) */
;;;595        return(errorstatus);
;;;596      }
;;;597    
;;;598      /*!< CMD8: SEND_IF_COND ----------------------------------------------------*/
;;;599      /*!< Send CMD8 to verify SD card interface operating condition */
;;;600      /*!< Argument: - [31:12]: Reserved (shall be set to '0')
;;;601                   - [11:8]: Supply Voltage (VHS) 0x1 (Range: 2.7-3.6 V)
;;;602                   - [7:0]: Check Pattern (recommended 0xAA) */
;;;603      /*!< CMD Response: R7 */
;;;604      SDIO_CmdInitStructure.SDIO_Argument = SD_CHECK_PATTERN;
00007a  f44f70d5          MOV      r0,#0x1aa
;;;605      SDIO_CmdInitStructure.SDIO_CmdIndex = SDIO_SEND_IF_COND;
00007e  6020              STR      r0,[r4,#0]  ; SDIO_CmdInitStructure
000080  2008              MOVS     r0,#8
;;;606      SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
000082  2740              MOVS     r7,#0x40
;;;607      SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;608      SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
000084  e9c40701          STRD     r0,r7,[r4,#4]
;;;609      SDIO_SendCommand(&SDIO_CmdInitStructure);
000088  4852              LDR      r0,|L26.468|
00008a  e9c45b03          STRD     r5,r11,[r4,#0xc]
00008e  465e              MOV      r6,r11                ;608
000090  3018              ADDS     r0,r0,#0x18
000092  f7fffffe          BL       SDIO_SendCommand
000096  4b50              LDR      r3,|L26.472|
000098  2000              MOVS     r0,#0
00009a  4651              MOV      r1,r10
00009c  6b5a              LDR      r2,[r3,#0x34]
;;;610    
;;;611      errorstatus = CmdResp7Error();
;;;612    
;;;613      if (errorstatus == SD_OK)
;;;614      {
;;;615        CardType = SDIO_STD_CAPACITY_SD_CARD_V2_0; /*!< SD Card 2.0 */
;;;616        SDType = SD_HIGH_CAPACITY;
;;;617      }
;;;618      else
;;;619      {
;;;620        /*!< CMD55 */
;;;621        SDIO_CmdInitStructure.SDIO_Argument = 0x00;
;;;622        SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_APP_CMD;
00009e  f04f0b37          MOV      r11,#0x37
0000a2  e002              B        |L26.170|
                  |L26.164|
0000a4  4a4c              LDR      r2,|L26.472|
0000a6  6b52              LDR      r2,[r2,#0x34]         ;611
0000a8  1e49              SUBS     r1,r1,#1              ;611
                  |L26.170|
0000aa  f0120f45          TST      r2,#0x45              ;611
0000ae  d006              BEQ      |L26.190|
0000b0  b109              CBZ      r1,|L26.182|
0000b2  0751              LSLS     r1,r2,#29             ;611
0000b4  d506              BPL      |L26.196|
                  |L26.182|
0000b6  f04f0a03          MOV      r10,#3                ;611
0000ba  2004              MOVS     r0,#4                 ;611
0000bc  e007              B        |L26.206|
                  |L26.190|
0000be  2900              CMP      r1,#0                 ;611
0000c0  d1f0              BNE      |L26.164|
0000c2  e7f8              B        |L26.182|
                  |L26.196|
0000c4  0651              LSLS     r1,r2,#25             ;611
0000c6  d505              BPL      |L26.212|
0000c8  f04f0a00          MOV      r10,#0                ;611
0000cc  2040              MOVS     r0,#0x40              ;611
                  |L26.206|
0000ce  f7fffffe          BL       SDIO_ClearFlag
0000d2  4650              MOV      r0,r10                ;611
                  |L26.212|
0000d4  f88d0000          STRB     r0,[sp,#0]            ;611
0000d8  f89d0000          LDRB     r0,[sp,#0]            ;613
0000dc  b300              CBZ      r0,|L26.288|
;;;623        SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
0000de  60a7              STR      r7,[r4,#8]  ; SDIO_CmdInitStructure
0000e0  e9c45b00          STRD     r5,r11,[r4,#0]
;;;624        SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;625        SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
;;;626        SDIO_SendCommand(&SDIO_CmdInitStructure);
0000e4  483b              LDR      r0,|L26.468|
0000e6  e9c45603          STRD     r5,r6,[r4,#0xc]
0000ea  3018              ADDS     r0,r0,#0x18
0000ec  f7fffffe          BL       SDIO_SendCommand
;;;627        errorstatus = CmdResp1Error(SD_CMD_APP_CMD);
0000f0  2037              MOVS     r0,#0x37
0000f2  f7fffffe          BL       CmdResp1Error
0000f6  f88d0000          STRB     r0,[sp,#0]
                  |L26.250|
;;;628      }
;;;629      /*!< CMD55 */
;;;630      SDIO_CmdInitStructure.SDIO_Argument = 0x00;
;;;631      SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_APP_CMD;
;;;632      SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
0000fa  60a7              STR      r7,[r4,#8]  ; SDIO_CmdInitStructure
0000fc  e9c45b00          STRD     r5,r11,[r4,#0]
;;;633      SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;634      SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
;;;635      SDIO_SendCommand(&SDIO_CmdInitStructure);
000100  4834              LDR      r0,|L26.468|
000102  e9c45603          STRD     r5,r6,[r4,#0xc]
000106  46da              MOV      r10,r11               ;631
000108  3018              ADDS     r0,r0,#0x18
00010a  f7fffffe          BL       SDIO_SendCommand
;;;636      errorstatus = CmdResp1Error(SD_CMD_APP_CMD);
00010e  2037              MOVS     r0,#0x37
000110  f7fffffe          BL       CmdResp1Error
000114  f88d0000          STRB     r0,[sp,#0]
;;;637    
;;;638      /*!< If errorstatus is Command TimeOut, it is a MMC card */
;;;639      /*!< If errorstatus is SD_OK it is a SD card: SD card 2.0 (voltage range mismatch)
;;;640         or SD card 1.x */
;;;641      if (errorstatus == SD_OK)
000118  f89d0000          LDRB     r0,[sp,#0]
00011c  b388              CBZ      r0,|L26.386|
                  |L26.286|
00011e  e055              B        |L26.460|
                  |L26.288|
000120  482e              LDR      r0,|L26.476|
000122  2101              MOVS     r1,#1                 ;615
000124  f04f4880          MOV      r8,#0x40000000        ;616
000128  6041              STR      r1,[r0,#4]            ;616  ; CardType
00012a  e7e6              B        |L26.250|
                  |L26.300|
;;;642      {
;;;643        /*!< SD CARD */
;;;644        /*!< Send ACMD41 SD_APP_OP_COND with Argument 0x80100000 */
;;;645        while ((!validvoltage) && (count < SD_MAX_VOLT_TRIAL))
;;;646        {
;;;647    
;;;648          /*!< SEND CMD55 APP_CMD with RCA as 0 */
;;;649          SDIO_CmdInitStructure.SDIO_Argument = 0x00;
;;;650          SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_APP_CMD;
;;;651          SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
00012c  60a7              STR      r7,[r4,#8]  ; SDIO_CmdInitStructure
00012e  e9c45a00          STRD     r5,r10,[r4,#0]
;;;652          SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;653          SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
;;;654          SDIO_SendCommand(&SDIO_CmdInitStructure);
000132  4828              LDR      r0,|L26.468|
000134  e9c45603          STRD     r5,r6,[r4,#0xc]
000138  3018              ADDS     r0,r0,#0x18
00013a  f7fffffe          BL       SDIO_SendCommand
;;;655    
;;;656          errorstatus = CmdResp1Error(SD_CMD_APP_CMD);
00013e  2037              MOVS     r0,#0x37
000140  f7fffffe          BL       CmdResp1Error
000144  f88d0000          STRB     r0,[sp,#0]
;;;657    
;;;658          if (errorstatus != SD_OK)
000148  f89d0000          LDRB     r0,[sp,#0]
00014c  bb78              CBNZ     r0,|L26.430|
;;;659          {
;;;660            return(errorstatus);
;;;661          }
;;;662          SDIO_CmdInitStructure.SDIO_Argument = SD_VOLTAGE_WINDOW_SD | SDType;
00014e  4924              LDR      r1,|L26.480|
000150  ea480001          ORR      r0,r8,r1
;;;663          SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_SD_APP_OP_COND;
000154  6020              STR      r0,[r4,#0]  ; SDIO_CmdInitStructure
000156  2029              MOVS     r0,#0x29
000158  e9c40701          STRD     r0,r7,[r4,#4]
;;;664          SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
;;;665          SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;666          SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
;;;667          SDIO_SendCommand(&SDIO_CmdInitStructure);
00015c  481d              LDR      r0,|L26.468|
00015e  e9c45603          STRD     r5,r6,[r4,#0xc]
000162  3018              ADDS     r0,r0,#0x18
000164  f7fffffe          BL       SDIO_SendCommand
000168  2000              MOVS     r0,#0
00016a  491b              LDR      r1,|L26.472|
00016c  9001              STR      r0,[sp,#4]
                  |L26.366|
00016e  6b48              LDR      r0,[r1,#0x34]
000170  f0100f45          TST      r0,#0x45
000174  d0fb              BEQ      |L26.366|
000176  0740              LSLS     r0,r0,#29
000178  d504              BPL      |L26.388|
00017a  2003              MOVS     r0,#3
00017c  9001              STR      r0,[sp,#4]
00017e  2004              MOVS     r0,#4
000180  e002              B        |L26.392|
                  |L26.386|
000182  e011              B        |L26.424|
                  |L26.388|
000184  f24050ff          MOV      r0,#0x5ff
                  |L26.392|
000188  f7fffffe          BL       SDIO_ClearFlag
;;;668    
;;;669          errorstatus = CmdResp3Error();
00018c  9801              LDR      r0,[sp,#4]
00018e  f88d0000          STRB     r0,[sp,#0]
;;;670          if (errorstatus != SD_OK)
000192  f89d0000          LDRB     r0,[sp,#0]
000196  b950              CBNZ     r0,|L26.430|
;;;671          {
;;;672            return(errorstatus);
;;;673          }
;;;674    
;;;675          response = SDIO_GetResponse(SDIO_RESP1);
000198  2000              MOVS     r0,#0
00019a  f7fffffe          BL       SDIO_GetResponse
;;;676          validvoltage = (((response >> 31) == 1) ? 1 : 0);
00019e  0fc1              LSRS     r1,r0,#31
;;;677          count++;
0001a0  f1090901          ADD      r9,r9,#1
0001a4  d004              BEQ      |L26.432|
0001a6  e005              B        |L26.436|
                  |L26.424|
0001a8  f64f7bff          MOV      r11,#0xffff           ;645
0001ac  e7be              B        |L26.300|
                  |L26.430|
0001ae  e00d              B        |L26.460|
                  |L26.432|
0001b0  45d9              CMP      r9,r11                ;645
0001b2  d3bb              BCC      |L26.300|
                  |L26.436|
;;;678        }
;;;679        if (count >= SD_MAX_VOLT_TRIAL)
0001b4  45d9              CMP      r9,r11
0001b6  d303              BCC      |L26.448|
;;;680        {
;;;681          errorstatus = SD_INVALID_VOLTRANGE;
0001b8  201b              MOVS     r0,#0x1b
0001ba  f88d0000          STRB     r0,[sp,#0]
;;;682          return(errorstatus);
0001be  e005              B        |L26.460|
                  |L26.448|
;;;683        }
;;;684    
;;;685        if (response &= SD_HIGH_CAPACITY)
0001c0  f0104f80          TST      r0,#0x40000000
0001c4  d002              BEQ      |L26.460|
;;;686        {
;;;687          CardType = SDIO_HIGH_CAPACITY_SD_CARD;
0001c6  4805              LDR      r0,|L26.476|
0001c8  2102              MOVS     r1,#2
0001ca  6041              STR      r1,[r0,#4]  ; CardType
                  |L26.460|
;;;688        }
;;;689    
;;;690      }/*!< else MMC Card */
;;;691    
;;;692      return(errorstatus);
0001cc  f89d0000          LDRB     r0,[sp,#0]
;;;693    }
0001d0  e8bd9ffc          POP      {r2-r12,pc}
;;;694    
                          ENDP

                  |L26.468|
                          DCD      ||.bss||+0x88
                  |L26.472|
                          DCD      0x40018000
                  |L26.476|
                          DCD      ||.data||
                  |L26.480|
                          DCD      0x80100000

                          AREA ||i.SD_ProcessDMAIRQ||, CODE, READONLY, ALIGN=2

                  SD_ProcessDMAIRQ PROC
;;;2067     */
;;;2068   void SD_ProcessDMAIRQ(void)
000000  4805              LDR      r0,|L27.24|
;;;2069   {
;;;2070     if(DMA2->ISR & DMA2_FLAG_TC4)
000002  6800              LDR      r0,[r0,#0]
000004  4905              LDR      r1,|L27.28|
000006  4208              TST      r0,r1
000008  d005              BEQ      |L27.22|
;;;2071     {
;;;2072       DMAEndOfTransfer = 0x01;
00000a  4905              LDR      r1,|L27.32|
00000c  2001              MOVS     r0,#1
00000e  6148              STR      r0,[r1,#0x14]  ; DMAEndOfTransfer
;;;2073       DMA_ClearFlag(DMA2_FLAG_TC4 | DMA2_FLAG_TE4 | DMA2_FLAG_HT4 | DMA2_FLAG_GL4);
000010  4804              LDR      r0,|L27.36|
000012  f7ffbffe          B.W      DMA_ClearFlag
                  |L27.22|
;;;2074     }
;;;2075   }
000016  4770              BX       lr
;;;2076   
                          ENDP

                  |L27.24|
                          DCD      0x40020400
                  |L27.28|
                          DCD      0x10002000
                  |L27.32|
                          DCD      ||.data||
                  |L27.36|
                          DCD      0x1000f000

                          AREA ||i.SD_ProcessIRQSrc||, CODE, READONLY, ALIGN=2

                  SD_ProcessIRQSrc PROC
;;;2022     */
;;;2023   SD_Error SD_ProcessIRQSrc(void)
000000  b570              PUSH     {r4-r6,lr}
;;;2024   { 
;;;2025     if (SDIO_GetITStatus(SDIO_IT_DATAEND) != RESET)
000002  f44f7580          MOV      r5,#0x100
000006  4628              MOV      r0,r5
000008  f7fffffe          BL       SDIO_GetITStatus
;;;2026     {
;;;2027       TransferError = SD_OK;
00000c  4c1f              LDR      r4,|L28.140|
00000e  b138              CBZ      r0,|L28.32|
000010  2000              MOVS     r0,#0
000012  7020              STRB     r0,[r4,#0]
;;;2028       SDIO_ClearITPendingBit(SDIO_IT_DATAEND);
000014  4628              MOV      r0,r5
000016  f7fffffe          BL       SDIO_ClearITPendingBit
;;;2029       TransferEnd = 1;
00001a  2001              MOVS     r0,#1
00001c  6120              STR      r0,[r4,#0x10]  ; TransferEnd
00001e  e02e              B        |L28.126|
                  |L28.32|
;;;2030     }  
;;;2031     else if (SDIO_GetITStatus(SDIO_IT_DCRCFAIL) != RESET)
000020  2002              MOVS     r0,#2
000022  f7fffffe          BL       SDIO_GetITStatus
000026  b120              CBZ      r0,|L28.50|
;;;2032     {
;;;2033       SDIO_ClearITPendingBit(SDIO_IT_DCRCFAIL);
000028  2002              MOVS     r0,#2
00002a  f7fffffe          BL       SDIO_ClearITPendingBit
;;;2034       TransferError = SD_DATA_CRC_FAIL;
00002e  2002              MOVS     r0,#2
000030  e024              B        |L28.124|
                  |L28.50|
;;;2035     }
;;;2036     else if (SDIO_GetITStatus(SDIO_IT_DTIMEOUT) != RESET)
000032  2008              MOVS     r0,#8
000034  f7fffffe          BL       SDIO_GetITStatus
000038  b120              CBZ      r0,|L28.68|
;;;2037     {
;;;2038       SDIO_ClearITPendingBit(SDIO_IT_DTIMEOUT);
00003a  2008              MOVS     r0,#8
00003c  f7fffffe          BL       SDIO_ClearITPendingBit
;;;2039       TransferError = SD_DATA_TIMEOUT;
000040  2004              MOVS     r0,#4
000042  e01b              B        |L28.124|
                  |L28.68|
;;;2040     }
;;;2041     else if (SDIO_GetITStatus(SDIO_IT_RXOVERR) != RESET)
000044  2020              MOVS     r0,#0x20
000046  f7fffffe          BL       SDIO_GetITStatus
00004a  b120              CBZ      r0,|L28.86|
;;;2042     {
;;;2043       SDIO_ClearITPendingBit(SDIO_IT_RXOVERR);
00004c  2020              MOVS     r0,#0x20
00004e  f7fffffe          BL       SDIO_ClearITPendingBit
;;;2044       TransferError = SD_RX_OVERRUN;
000052  2006              MOVS     r0,#6
000054  e012              B        |L28.124|
                  |L28.86|
;;;2045     }
;;;2046     else if (SDIO_GetITStatus(SDIO_IT_TXUNDERR) != RESET)
000056  2010              MOVS     r0,#0x10
000058  f7fffffe          BL       SDIO_GetITStatus
00005c  b120              CBZ      r0,|L28.104|
;;;2047     {
;;;2048       SDIO_ClearITPendingBit(SDIO_IT_TXUNDERR);
00005e  2010              MOVS     r0,#0x10
000060  f7fffffe          BL       SDIO_ClearITPendingBit
;;;2049       TransferError = SD_TX_UNDERRUN;
000064  2005              MOVS     r0,#5
000066  e009              B        |L28.124|
                  |L28.104|
;;;2050     }
;;;2051     else if (SDIO_GetITStatus(SDIO_IT_STBITERR) != RESET)
000068  f44f7500          MOV      r5,#0x200
00006c  4628              MOV      r0,r5
00006e  f7fffffe          BL       SDIO_GetITStatus
000072  b120              CBZ      r0,|L28.126|
;;;2052     {
;;;2053       SDIO_ClearITPendingBit(SDIO_IT_STBITERR);
000074  4628              MOV      r0,r5
000076  f7fffffe          BL       SDIO_ClearITPendingBit
;;;2054       TransferError = SD_START_BIT_ERR;
00007a  2007              MOVS     r0,#7
                  |L28.124|
00007c  7020              STRB     r0,[r4,#0]
                  |L28.126|
;;;2055     }
;;;2056   
;;;2057     SDIO_ITConfig(SDIO_IT_DCRCFAIL | SDIO_IT_DTIMEOUT | SDIO_IT_DATAEND |
00007e  2100              MOVS     r1,#0
000080  f24c303a          MOV      r0,#0xc33a
000084  f7fffffe          BL       SDIO_ITConfig
;;;2058                   SDIO_IT_TXFIFOHE | SDIO_IT_RXFIFOHF | SDIO_IT_TXUNDERR |
;;;2059                   SDIO_IT_RXOVERR | SDIO_IT_STBITERR, DISABLE);
;;;2060     return(TransferError);
000088  7820              LDRB     r0,[r4,#0]  ; TransferError
;;;2061   }
00008a  bd70              POP      {r4-r6,pc}
;;;2062   
                          ENDP

                  |L28.140|
                          DCD      ||.data||

                          AREA ||i.SD_ReadBlock||, CODE, READONLY, ALIGN=2

                  SD_ReadBlock PROC
;;;1191     */
;;;1192   SD_Error SD_ReadBlock(uint8_t *readbuff, uint64_t ReadAddr, uint16_t BlockSize)
000000  e92d47f0          PUSH     {r4-r10,lr}
;;;1193   {
000004  4682              MOV      r10,r0
;;;1194     SD_Error errorstatus = SD_OK;
;;;1195   #if defined (SD_POLLING_MODE) 
;;;1196     uint32_t count = 0, *tempbuff = (uint32_t *)readbuff;
;;;1197   #endif
;;;1198   
;;;1199     TransferError = SD_OK;
000006  4828              LDR      r0,|L29.168|
000008  2500              MOVS     r5,#0
00000a  9f08              LDR      r7,[sp,#0x20]
00000c  4616              MOV      r6,r2                 ;1193
00000e  7005              STRB     r5,[r0,#0]
;;;1200     TransferEnd = 0;
000010  6105              STR      r5,[r0,#0x10]  ; TransferEnd
;;;1201     StopCondition = 0;
000012  60c5              STR      r5,[r0,#0xc]  ; StopCondition
;;;1202     
;;;1203     SDIO->DCTRL = 0x0;
000014  4925              LDR      r1,|L29.172|
000016  62cd              STR      r5,[r1,#0x2c]
;;;1204   
;;;1205     
;;;1206     if (CardType == SDIO_HIGH_CAPACITY_SD_CARD)
000018  6840              LDR      r0,[r0,#4]  ; CardType
00001a  2802              CMP      r0,#2
00001c  d103              BNE      |L29.38|
;;;1207     {
;;;1208       BlockSize = 512;
00001e  0207              LSLS     r7,r0,#8
;;;1209       ReadAddr /= 512;
000020  0a56              LSRS     r6,r2,#9
000022  ea4656c3          ORR      r6,r6,r3,LSL #23
                  |L29.38|
;;;1210     }
;;;1211   
;;;1212     /* Set Block Size for Card */ 
;;;1213     SDIO_CmdInitStructure.SDIO_Argument = (uint32_t) BlockSize;
000026  4c22              LDR      r4,|L29.176|
;;;1214     SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_SET_BLOCKLEN;
;;;1215     SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
000028  f04f0940          MOV      r9,#0x40
00002c  2010              MOVS     r0,#0x10              ;1214
;;;1216     SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;1217     SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
00002e  f8c49008          STR      r9,[r4,#8]  ; SDIO_CmdInitStructure
000032  e9c47000          STRD     r7,r0,[r4,#0]
000036  f44f6880          MOV      r8,#0x400
;;;1218     SDIO_SendCommand(&SDIO_CmdInitStructure);
00003a  e9c45803          STRD     r5,r8,[r4,#0xc]
00003e  4620              MOV      r0,r4
000040  f7fffffe          BL       SDIO_SendCommand
;;;1219   
;;;1220     errorstatus = CmdResp1Error(SD_CMD_SET_BLOCKLEN);
000044  2010              MOVS     r0,#0x10
000046  f7fffffe          BL       CmdResp1Error
;;;1221   
;;;1222     if (SD_OK != errorstatus)
00004a  2800              CMP      r0,#0
00004c  d129              BNE      |L29.162|
;;;1223     {
;;;1224       return(errorstatus);
;;;1225     }
;;;1226     
;;;1227     SDIO_DataInitStructure.SDIO_DataTimeOut = SD_DATATIMEOUT;
00004e  f1040014          ADD      r0,r4,#0x14
000052  4918              LDR      r1,|L29.180|
000054  e9c01700          STRD     r1,r7,[r0,#0]
;;;1228     SDIO_DataInitStructure.SDIO_DataLength = BlockSize;
;;;1229     SDIO_DataInitStructure.SDIO_DataBlockSize = (uint32_t) 9 << 4;
000058  2190              MOVS     r1,#0x90
;;;1230     SDIO_DataInitStructure.SDIO_TransferDir = SDIO_TransferDir_ToSDIO;
00005a  6081              STR      r1,[r0,#8]  ; SDIO_DataInitStructure
00005c  2102              MOVS     r1,#2
00005e  e9c01503          STRD     r1,r5,[r0,#0xc]
;;;1231     SDIO_DataInitStructure.SDIO_TransferMode = SDIO_TransferMode_Block;
;;;1232     SDIO_DataInitStructure.SDIO_DPSM = SDIO_DPSM_Enable;
000062  2101              MOVS     r1,#1
;;;1233     SDIO_DataConfig(&SDIO_DataInitStructure);
000064  6141              STR      r1,[r0,#0x14]  ; SDIO_DataInitStructure
000066  f7fffffe          BL       SDIO_DataConfig
;;;1234   
;;;1235     /*!< Send CMD17 READ_SINGLE_BLOCK */
;;;1236     SDIO_CmdInitStructure.SDIO_Argument = (uint32_t)ReadAddr;
;;;1237     SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_READ_SINGLE_BLOCK;
00006a  2011              MOVS     r0,#0x11
;;;1238     SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
00006c  f8c49008          STR      r9,[r4,#8]  ; SDIO_CmdInitStructure
000070  e9c46000          STRD     r6,r0,[r4,#0]
000074  e9c45803          STRD     r5,r8,[r4,#0xc]
;;;1239     SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;1240     SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
;;;1241     SDIO_SendCommand(&SDIO_CmdInitStructure);
000078  4620              MOV      r0,r4
00007a  f7fffffe          BL       SDIO_SendCommand
;;;1242   
;;;1243     errorstatus = CmdResp1Error(SD_CMD_READ_SINGLE_BLOCK);
00007e  2011              MOVS     r0,#0x11
000080  f7fffffe          BL       CmdResp1Error
000084  0004              MOVS     r4,r0
;;;1244   
;;;1245     if (errorstatus != SD_OK)
000086  d10c              BNE      |L29.162|
;;;1246     {
;;;1247       return(errorstatus);
;;;1248     }
;;;1249   
;;;1250   #if defined (SD_POLLING_MODE)  
;;;1251     /*!< In case of single block transfer, no need of stop transfer at all.*/
;;;1252     /*!< Polling mode */
;;;1253     while (!(SDIO->STA &(SDIO_FLAG_RXOVERR | SDIO_FLAG_DCRCFAIL | SDIO_FLAG_DTIMEOUT | SDIO_FLAG_DBCKEND | SDIO_FLAG_STBITERR)))
;;;1254     {
;;;1255       if (SDIO_GetFlagStatus(SDIO_FLAG_RXFIFOHF) != RESET)
;;;1256       {
;;;1257         for (count = 0; count < 8; count++)
;;;1258         {
;;;1259           *(tempbuff + count) = SDIO_ReadData();
;;;1260         }
;;;1261         tempbuff += 8;
;;;1262       }
;;;1263     }
;;;1264   
;;;1265     if (SDIO_GetFlagStatus(SDIO_FLAG_DTIMEOUT) != RESET)
;;;1266     {
;;;1267       SDIO_ClearFlag(SDIO_FLAG_DTIMEOUT);
;;;1268       errorstatus = SD_DATA_TIMEOUT;
;;;1269       return(errorstatus);
;;;1270     }
;;;1271     else if (SDIO_GetFlagStatus(SDIO_FLAG_DCRCFAIL) != RESET)
;;;1272     {
;;;1273       SDIO_ClearFlag(SDIO_FLAG_DCRCFAIL);
;;;1274       errorstatus = SD_DATA_CRC_FAIL;
;;;1275       return(errorstatus);
;;;1276     }
;;;1277     else if (SDIO_GetFlagStatus(SDIO_FLAG_RXOVERR) != RESET)
;;;1278     {
;;;1279       SDIO_ClearFlag(SDIO_FLAG_RXOVERR);
;;;1280       errorstatus = SD_RX_OVERRUN;
;;;1281       return(errorstatus);
;;;1282     }
;;;1283     else if (SDIO_GetFlagStatus(SDIO_FLAG_STBITERR) != RESET)
;;;1284     {
;;;1285       SDIO_ClearFlag(SDIO_FLAG_STBITERR);
;;;1286       errorstatus = SD_START_BIT_ERR;
;;;1287       return(errorstatus);
;;;1288     }
;;;1289     count = SD_DATATIMEOUT;
;;;1290     while ((SDIO_GetFlagStatus(SDIO_FLAG_RXDAVL) != RESET) && (count > 0))
;;;1291     {
;;;1292       *tempbuff = SDIO_ReadData();
;;;1293       tempbuff++;
;;;1294       count--;
;;;1295     }
;;;1296     
;;;1297     /*!< Clear all the static flags */
;;;1298     SDIO_ClearFlag(SDIO_STATIC_FLAGS);
;;;1299   
;;;1300   #elif defined (SD_DMA_MODE)
;;;1301       SDIO_ITConfig(SDIO_IT_DCRCFAIL | SDIO_IT_DTIMEOUT | SDIO_IT_DATAEND | SDIO_IT_RXOVERR | SDIO_IT_STBITERR, ENABLE);
000088  2101              MOVS     r1,#1
00008a  f240302a          MOV      r0,#0x32a
00008e  f7fffffe          BL       SDIO_ITConfig
;;;1302       SDIO_DMACmd(ENABLE);
000092  2001              MOVS     r0,#1
000094  f7fffffe          BL       SDIO_DMACmd
;;;1303       SD_LowLevel_DMA_RxConfig((uint32_t *)readbuff, BlockSize);
000098  4639              MOV      r1,r7
00009a  4650              MOV      r0,r10
00009c  f7fffffe          BL       SD_LowLevel_DMA_RxConfig
;;;1304   #endif
;;;1305   
;;;1306     return(errorstatus);
0000a0  4620              MOV      r0,r4
                  |L29.162|
;;;1307   }
0000a2  e8bd87f0          POP      {r4-r10,pc}
;;;1308   
                          ENDP

0000a6  0000              DCW      0x0000
                  |L29.168|
                          DCD      ||.data||
                  |L29.172|
                          DCD      0x40018000
                  |L29.176|
                          DCD      ||.bss||+0xa0
                  |L29.180|
                          DCD      0x000fffff

                          AREA ||i.SD_ReadMultiBlocks||, CODE, READONLY, ALIGN=2

                  SD_ReadMultiBlocks PROC
;;;1323     */
;;;1324   SD_Error SD_ReadMultiBlocks(uint8_t *readbuff, uint64_t ReadAddr, uint16_t BlockSize, uint32_t NumberOfBlocks)
000000  e92d5fff          PUSH     {r0-r12,lr}
;;;1325   {
;;;1326     SD_Error errorstatus = SD_OK;
;;;1327     TransferError = SD_OK;
000004  482b              LDR      r0,|L30.180|
000006  e9dd870e          LDRD     r8,r7,[sp,#0x38]      ;1325
00000a  2500              MOVS     r5,#0
00000c  4616              MOV      r6,r2                 ;1325
00000e  7005              STRB     r5,[r0,#0]
;;;1328     TransferEnd = 0;
000010  6105              STR      r5,[r0,#0x10]  ; TransferEnd
;;;1329     StopCondition = 1;
000012  f04f0a01          MOV      r10,#1
000016  f8c0a00c          STR      r10,[r0,#0xc]  ; StopCondition
;;;1330   	
;;;1331     SDIO->DCTRL = 0x0;
00001a  4927              LDR      r1,|L30.184|
00001c  62cd              STR      r5,[r1,#0x2c]
;;;1332   
;;;1333     if (CardType == SDIO_HIGH_CAPACITY_SD_CARD)
00001e  6840              LDR      r0,[r0,#4]  ; CardType
000020  2802              CMP      r0,#2
000022  d104              BNE      |L30.46|
;;;1334     {
;;;1335       BlockSize = 512;
;;;1336       ReadAddr /= 512;
000024  0a56              LSRS     r6,r2,#9
000026  f44f7800          MOV      r8,#0x200             ;1335
00002a  ea4656c3          ORR      r6,r6,r3,LSL #23
                  |L30.46|
;;;1337     }
;;;1338   
;;;1339     /*!< Set Block Size for Card */
;;;1340     SDIO_CmdInitStructure.SDIO_Argument = (uint32_t) BlockSize;
00002e  4c23              LDR      r4,|L30.188|
;;;1341     SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_SET_BLOCKLEN;
;;;1342     SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
;;;1343     SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;1344     SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
000030  f44f6b80          MOV      r11,#0x400
000034  2010              MOVS     r0,#0x10              ;1341
000036  f8c4b010          STR      r11,[r4,#0x10]  ; SDIO_CmdInitStructure
00003a  e9c48000          STRD     r8,r0,[r4,#0]
00003e  f04f0940          MOV      r9,#0x40              ;1342
;;;1345     SDIO_SendCommand(&SDIO_CmdInitStructure);
000042  e9c49502          STRD     r9,r5,[r4,#8]
000046  4620              MOV      r0,r4
000048  f7fffffe          BL       SDIO_SendCommand
;;;1346   
;;;1347     errorstatus = CmdResp1Error(SD_CMD_SET_BLOCKLEN);
00004c  2010              MOVS     r0,#0x10
00004e  f7fffffe          BL       CmdResp1Error
;;;1348   
;;;1349     if (SD_OK != errorstatus)
000052  2800              CMP      r0,#0
000054  d12b              BNE      |L30.174|
;;;1350     {
;;;1351       return(errorstatus);
;;;1352     }
;;;1353       
;;;1354     SDIO_DataInitStructure.SDIO_DataTimeOut = SD_DATATIMEOUT;
000056  f1040014          ADD      r0,r4,#0x14
00005a  4919              LDR      r1,|L30.192|
;;;1355     SDIO_DataInitStructure.SDIO_DataLength = NumberOfBlocks * BlockSize;
00005c  fb07f708          MUL      r7,r7,r8
000060  e8e01702          STRD     r1,r7,[r0],#8
;;;1356     SDIO_DataInitStructure.SDIO_DataBlockSize = (uint32_t) 9 << 4;
000064  2190              MOVS     r1,#0x90
000066  c002              STM      r0!,{r1}  ; SDIO_DataInitStructure
;;;1357     SDIO_DataInitStructure.SDIO_TransferDir = SDIO_TransferDir_ToSDIO;
000068  2102              MOVS     r1,#2
00006a  e8800422          STM      r0,{r1,r5,r10}
;;;1358     SDIO_DataInitStructure.SDIO_TransferMode = SDIO_TransferMode_Block;
;;;1359     SDIO_DataInitStructure.SDIO_DPSM = SDIO_DPSM_Enable;
;;;1360     SDIO_DataConfig(&SDIO_DataInitStructure);
00006e  f1040014          ADD      r0,r4,#0x14
000072  f7fffffe          BL       SDIO_DataConfig
;;;1361   
;;;1362     /*!< Send CMD18 READ_MULT_BLOCK with argument data address */
;;;1363     SDIO_CmdInitStructure.SDIO_Argument = (uint32_t)ReadAddr;
;;;1364     SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_READ_MULT_BLOCK;
000076  2012              MOVS     r0,#0x12
;;;1365     SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
;;;1366     SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;1367     SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
000078  f8c4b010          STR      r11,[r4,#0x10]  ; SDIO_CmdInitStructure
00007c  e9c46000          STRD     r6,r0,[r4,#0]
000080  e9c49502          STRD     r9,r5,[r4,#8]
;;;1368     SDIO_SendCommand(&SDIO_CmdInitStructure);
000084  4620              MOV      r0,r4
000086  f7fffffe          BL       SDIO_SendCommand
;;;1369   
;;;1370     errorstatus = CmdResp1Error(SD_CMD_READ_MULT_BLOCK);
00008a  2012              MOVS     r0,#0x12
00008c  f7fffffe          BL       CmdResp1Error
000090  0004              MOVS     r4,r0
;;;1371   
;;;1372     if (errorstatus != SD_OK)
000092  d10c              BNE      |L30.174|
;;;1373     {
;;;1374       return(errorstatus);
;;;1375     }
;;;1376   
;;;1377     SDIO_ITConfig(SDIO_IT_DCRCFAIL | SDIO_IT_DTIMEOUT | SDIO_IT_DATAEND | SDIO_IT_RXOVERR | SDIO_IT_STBITERR, ENABLE);
000094  2101              MOVS     r1,#1
000096  f240302a          MOV      r0,#0x32a
00009a  f7fffffe          BL       SDIO_ITConfig
;;;1378     SDIO_DMACmd(ENABLE);
00009e  2001              MOVS     r0,#1
0000a0  f7fffffe          BL       SDIO_DMACmd
0000a4  4639              MOV      r1,r7
;;;1379     SD_LowLevel_DMA_RxConfig((uint32_t *)readbuff, (NumberOfBlocks * BlockSize));
0000a6  9800              LDR      r0,[sp,#0]
0000a8  f7fffffe          BL       SD_LowLevel_DMA_RxConfig
;;;1380   
;;;1381     return(errorstatus);
0000ac  4620              MOV      r0,r4
                  |L30.174|
;;;1382   }
0000ae  b004              ADD      sp,sp,#0x10
0000b0  e8bd9ff0          POP      {r4-r12,pc}
;;;1383   
                          ENDP

                  |L30.180|
                          DCD      ||.data||
                  |L30.184|
                          DCD      0x40018000
                  |L30.188|
                          DCD      ||.bss||+0xa0
                  |L30.192|
                          DCD      0x000fffff

                          AREA ||i.SD_SelectDeselect||, CODE, READONLY, ALIGN=2

                  SD_SelectDeselect PROC
;;;1160     */
;;;1161   SD_Error SD_SelectDeselect(uint32_t addr)
000000  4909              LDR      r1,|L31.40|
;;;1162   {
000002  b510              PUSH     {r4,lr}
;;;1163     SD_Error errorstatus = SD_OK;
;;;1164   
;;;1165     /*!< Send CMD7 SDIO_SEL_DESEL_CARD */
;;;1166     SDIO_CmdInitStructure.SDIO_Argument =  addr;
;;;1167     SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_SEL_DESEL_CARD;
000004  6008              STR      r0,[r1,#0]  ; SDIO_CmdInitStructure
000006  2007              MOVS     r0,#7
;;;1168     SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
000008  6048              STR      r0,[r1,#4]  ; SDIO_CmdInitStructure
00000a  2040              MOVS     r0,#0x40
;;;1169     SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
00000c  6088              STR      r0,[r1,#8]  ; SDIO_CmdInitStructure
00000e  2000              MOVS     r0,#0
;;;1170     SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
000010  60c8              STR      r0,[r1,#0xc]  ; SDIO_CmdInitStructure
000012  f44f6080          MOV      r0,#0x400
;;;1171     SDIO_SendCommand(&SDIO_CmdInitStructure);
000016  6108              STR      r0,[r1,#0x10]  ; SDIO_CmdInitStructure
000018  4608              MOV      r0,r1
00001a  f7fffffe          BL       SDIO_SendCommand
;;;1172   
;;;1173     errorstatus = CmdResp1Error(SD_CMD_SEL_DESEL_CARD);
00001e  e8bd4010          POP      {r4,lr}
000022  2007              MOVS     r0,#7
000024  f7ffbffe          B.W      CmdResp1Error
;;;1174   
;;;1175     return(errorstatus);
;;;1176   }
;;;1177   
                          ENDP

                  |L31.40|
                          DCD      ||.bss||+0xa0

                          AREA ||i.SD_SendSDStatus||, CODE, READONLY, ALIGN=2

                  SD_SendSDStatus PROC
;;;1905     */
;;;1906   SD_Error SD_SendSDStatus(uint32_t *psdstatus)
000000  e92d47f0          PUSH     {r4-r10,lr}
;;;1907   {
000004  4605              MOV      r5,r0
;;;1908     SD_Error errorstatus = SD_OK;
;;;1909     uint32_t count = 0;
;;;1910   
;;;1911     if (SDIO_GetResponse(SDIO_RESP1) & SD_CARD_LOCKED)
000006  2000              MOVS     r0,#0
000008  f7fffffe          BL       SDIO_GetResponse
00000c  0180              LSLS     r0,r0,#6
00000e  d502              BPL      |L32.22|
;;;1912     {
;;;1913       errorstatus = SD_LOCK_UNLOCK_FAILED;
000010  200e              MOVS     r0,#0xe
                  |L32.18|
;;;1914       return(errorstatus);
;;;1915     }
;;;1916   
;;;1917     /*!< Set block size for card if it is not equal to current block size for card. */
;;;1918     SDIO_CmdInitStructure.SDIO_Argument = 64;
;;;1919     SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_SET_BLOCKLEN;
;;;1920     SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
;;;1921     SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;1922     SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
;;;1923     SDIO_SendCommand(&SDIO_CmdInitStructure);
;;;1924   
;;;1925     errorstatus = CmdResp1Error(SD_CMD_SET_BLOCKLEN);
;;;1926   
;;;1927     if (errorstatus != SD_OK)
;;;1928     {
;;;1929       return(errorstatus);
;;;1930     }
;;;1931   
;;;1932     /*!< CMD55 */
;;;1933     SDIO_CmdInitStructure.SDIO_Argument = (uint32_t) RCA << 16;
;;;1934     SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_APP_CMD;
;;;1935     SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
;;;1936     SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;1937     SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
;;;1938     SDIO_SendCommand(&SDIO_CmdInitStructure);
;;;1939     errorstatus = CmdResp1Error(SD_CMD_APP_CMD);
;;;1940   
;;;1941     if (errorstatus != SD_OK)
;;;1942     {
;;;1943       return(errorstatus);
;;;1944     }
;;;1945   
;;;1946     SDIO_DataInitStructure.SDIO_DataTimeOut = SD_DATATIMEOUT;
;;;1947     SDIO_DataInitStructure.SDIO_DataLength = 64;
;;;1948     SDIO_DataInitStructure.SDIO_DataBlockSize = SDIO_DataBlockSize_64b;
;;;1949     SDIO_DataInitStructure.SDIO_TransferDir = SDIO_TransferDir_ToSDIO;
;;;1950     SDIO_DataInitStructure.SDIO_TransferMode = SDIO_TransferMode_Block;
;;;1951     SDIO_DataInitStructure.SDIO_DPSM = SDIO_DPSM_Enable;
;;;1952     SDIO_DataConfig(&SDIO_DataInitStructure);
;;;1953   
;;;1954     /*!< Send ACMD13 SD_APP_STAUS  with argument as card's RCA.*/
;;;1955     SDIO_CmdInitStructure.SDIO_Argument = 0;
;;;1956     SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_SD_APP_STAUS;
;;;1957     SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
;;;1958     SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;1959     SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
;;;1960     SDIO_SendCommand(&SDIO_CmdInitStructure);
;;;1961     errorstatus = CmdResp1Error(SD_CMD_SD_APP_STAUS);
;;;1962   
;;;1963     if (errorstatus != SD_OK)
;;;1964     {
;;;1965       return(errorstatus);
;;;1966     }
;;;1967   
;;;1968     while (!(SDIO->STA &(SDIO_FLAG_RXOVERR | SDIO_FLAG_DCRCFAIL | SDIO_FLAG_DTIMEOUT | SDIO_FLAG_DBCKEND | SDIO_FLAG_STBITERR)))
;;;1969     {
;;;1970       if (SDIO_GetFlagStatus(SDIO_FLAG_RXFIFOHF) != RESET)
;;;1971       {
;;;1972         for (count = 0; count < 8; count++)
;;;1973         {
;;;1974           *(psdstatus + count) = SDIO_ReadData();
;;;1975         }
;;;1976         psdstatus += 8;
;;;1977       }
;;;1978     }
;;;1979   
;;;1980     if (SDIO_GetFlagStatus(SDIO_FLAG_DTIMEOUT) != RESET)
;;;1981     {
;;;1982       SDIO_ClearFlag(SDIO_FLAG_DTIMEOUT);
;;;1983       errorstatus = SD_DATA_TIMEOUT;
;;;1984       return(errorstatus);
;;;1985     }
;;;1986     else if (SDIO_GetFlagStatus(SDIO_FLAG_DCRCFAIL) != RESET)
;;;1987     {
;;;1988       SDIO_ClearFlag(SDIO_FLAG_DCRCFAIL);
;;;1989       errorstatus = SD_DATA_CRC_FAIL;
;;;1990       return(errorstatus);
;;;1991     }
;;;1992     else if (SDIO_GetFlagStatus(SDIO_FLAG_RXOVERR) != RESET)
;;;1993     {
;;;1994       SDIO_ClearFlag(SDIO_FLAG_RXOVERR);
;;;1995       errorstatus = SD_RX_OVERRUN;
;;;1996       return(errorstatus);
;;;1997     }
;;;1998     else if (SDIO_GetFlagStatus(SDIO_FLAG_STBITERR) != RESET)
;;;1999     {
;;;2000       SDIO_ClearFlag(SDIO_FLAG_STBITERR);
;;;2001       errorstatus = SD_START_BIT_ERR;
;;;2002       return(errorstatus);
;;;2003     }
;;;2004   
;;;2005     count = SD_DATATIMEOUT;
;;;2006     while ((SDIO_GetFlagStatus(SDIO_FLAG_RXDAVL) != RESET) && (count > 0))
;;;2007     {
;;;2008       *psdstatus = SDIO_ReadData();
;;;2009       psdstatus++;
;;;2010       count--;
;;;2011     }
;;;2012     /*!< Clear all the static status flags*/
;;;2013     SDIO_ClearFlag(SDIO_STATIC_FLAGS);
;;;2014   
;;;2015     return(errorstatus);
;;;2016   }
000012  e8bd87f0          POP      {r4-r10,pc}
                  |L32.22|
000016  4c4c              LDR      r4,|L32.328|
000018  2640              MOVS     r6,#0x40              ;1918
00001a  2010              MOVS     r0,#0x10              ;1919
00001c  e8e46002          STRD     r6,r0,[r4],#8         ;1919
000020  2700              MOVS     r7,#0                 ;1921
000022  f44f6880          MOV      r8,#0x400             ;1922
000026  e88401c0          STM      r4,{r6-r8}            ;1923
00002a  4847              LDR      r0,|L32.328|
00002c  3c08              SUBS     r4,r4,#8              ;1923
00002e  f7fffffe          BL       SDIO_SendCommand
000032  2010              MOVS     r0,#0x10              ;1925
000034  f7fffffe          BL       CmdResp1Error
000038  2800              CMP      r0,#0                 ;1927
00003a  d1ea              BNE      |L32.18|
00003c  4843              LDR      r0,|L32.332|
00003e  1d21              ADDS     r1,r4,#4              ;1937
000040  46b9              MOV      r9,r7                 ;1936
000042  8900              LDRH     r0,[r0,#8]            ;1933  ; RCA
000044  0400              LSLS     r0,r0,#16             ;1933
000046  6020              STR      r0,[r4,#0]            ;1934  ; SDIO_CmdInitStructure
000048  2037              MOVS     r0,#0x37              ;1934
00004a  f8c48010          STR      r8,[r4,#0x10]         ;1937  ; SDIO_CmdInitStructure
00004e  e8810241          STM      r1,{r0,r6,r9}         ;1937
000052  483d              LDR      r0,|L32.328|
000054  f7fffffe          BL       SDIO_SendCommand
000058  2037              MOVS     r0,#0x37              ;1939
00005a  f7fffffe          BL       CmdResp1Error
00005e  2800              CMP      r0,#0                 ;1941
000060  d1d7              BNE      |L32.18|
000062  4839              LDR      r0,|L32.328|
000064  4f3a              LDR      r7,|L32.336|
000066  3014              ADDS     r0,r0,#0x14           ;1946
000068  2160              MOVS     r1,#0x60              ;1948
00006a  6007              STR      r7,[r0,#0]            ;1948  ; SDIO_DataInitStructure
00006c  e9c06101          STRD     r6,r1,[r0,#4]         ;1948
000070  2102              MOVS     r1,#2                 ;1949
000072  e9c01903          STRD     r1,r9,[r0,#0xc]       ;1950
000076  46b2              MOV      r10,r6                ;1947
000078  2101              MOVS     r1,#1                 ;1951
00007a  464e              MOV      r6,r9                 ;1950
00007c  6141              STR      r1,[r0,#0x14]         ;1952  ; SDIO_DataInitStructure
00007e  f7fffffe          BL       SDIO_DataConfig
000082  200d              MOVS     r0,#0xd               ;1956
000084  f8c4a008          STR      r10,[r4,#8]           ;1957  ; SDIO_CmdInitStructure
000088  e9c46000          STRD     r6,r0,[r4,#0]         ;1957
00008c  e9c46803          STRD     r6,r8,[r4,#0xc]       ;1957
000090  482d              LDR      r0,|L32.328|
000092  f7fffffe          BL       SDIO_SendCommand
000096  200d              MOVS     r0,#0xd               ;1961
000098  f7fffffe          BL       CmdResp1Error
00009c  0006              MOVS     r6,r0                 ;1961
00009e  d1b8              BNE      |L32.18|
0000a0  f8df80b0          LDR      r8,|L32.340|
0000a4  f44f4a00          MOV      r10,#0x8000           ;1970
0000a8  f240692a          MOV      r9,#0x62a             ;1968
                  |L32.172|
0000ac  f8d80034          LDR      r0,[r8,#0x34]         ;1968
0000b0  ea100f09          TST      r0,r9                 ;1968
0000b4  d10f              BNE      |L32.214|
0000b6  4650              MOV      r0,r10                ;1970
0000b8  f7fffffe          BL       SDIO_GetFlagStatus
0000bc  2800              CMP      r0,#0                 ;1970
0000be  d0f5              BEQ      |L32.172|
0000c0  f05f0400          MOVS.W   r4,#0                 ;1972
                  |L32.196|
0000c4  f7fffffe          BL       SDIO_ReadData
0000c8  f8450024          STR      r0,[r5,r4,LSL #2]     ;1974
0000cc  1c64              ADDS     r4,r4,#1              ;1974
0000ce  2c08              CMP      r4,#8                 ;1972
0000d0  d3f8              BCC      |L32.196|
0000d2  3520              ADDS     r5,r5,#0x20           ;1972
0000d4  e7ea              B        |L32.172|
                  |L32.214|
0000d6  2008              MOVS     r0,#8                 ;1980
0000d8  f7fffffe          BL       SDIO_GetFlagStatus
0000dc  b120              CBZ      r0,|L32.232|
0000de  2008              MOVS     r0,#8                 ;1982
0000e0  f7fffffe          BL       SDIO_ClearFlag
0000e4  2004              MOVS     r0,#4                 ;1983
0000e6  e794              B        |L32.18|
                  |L32.232|
0000e8  2002              MOVS     r0,#2                 ;1986
0000ea  f7fffffe          BL       SDIO_GetFlagStatus
0000ee  b120              CBZ      r0,|L32.250|
0000f0  2002              MOVS     r0,#2                 ;1988
0000f2  f7fffffe          BL       SDIO_ClearFlag
0000f6  2002              MOVS     r0,#2                 ;1989
0000f8  e78b              B        |L32.18|
                  |L32.250|
0000fa  2020              MOVS     r0,#0x20              ;1992
0000fc  f7fffffe          BL       SDIO_GetFlagStatus
000100  b120              CBZ      r0,|L32.268|
000102  2020              MOVS     r0,#0x20              ;1994
000104  f7fffffe          BL       SDIO_ClearFlag
000108  2006              MOVS     r0,#6                 ;1995
00010a  e782              B        |L32.18|
                  |L32.268|
00010c  f44f7400          MOV      r4,#0x200             ;1998
000110  4620              MOV      r0,r4                 ;1998
000112  f7fffffe          BL       SDIO_GetFlagStatus
000116  b120              CBZ      r0,|L32.290|
000118  4620              MOV      r0,r4                 ;2000
00011a  f7fffffe          BL       SDIO_ClearFlag
00011e  2007              MOVS     r0,#7                 ;2001
000120  e777              B        |L32.18|
                  |L32.290|
000122  f44f1400          MOV      r4,#0x200000          ;2006
000126  e003              B        |L32.304|
                  |L32.296|
000128  f7fffffe          BL       SDIO_ReadData
00012c  c501              STM      r5!,{r0}              ;2008
00012e  1e7f              SUBS     r7,r7,#1              ;2008
                  |L32.304|
000130  4620              MOV      r0,r4                 ;2006
000132  f7fffffe          BL       SDIO_GetFlagStatus
000136  b108              CBZ      r0,|L32.316|
000138  2f00              CMP      r7,#0                 ;2006
00013a  d1f5              BNE      |L32.296|
                  |L32.316|
00013c  f24050ff          MOV      r0,#0x5ff             ;2013
000140  f7fffffe          BL       SDIO_ClearFlag
000144  4630              MOV      r0,r6                 ;2015
000146  e764              B        |L32.18|
;;;2017   
                          ENDP

                  |L32.328|
                          DCD      ||.bss||+0xa0
                  |L32.332|
                          DCD      ||.data||
                  |L32.336|
                          DCD      0x000fffff
                  |L32.340|
                          DCD      0x40018000

                          AREA ||i.SD_SendStatus||, CODE, READONLY, ALIGN=2

                  SD_SendStatus PROC
;;;1870     */
;;;1871   SD_Error SD_SendStatus(uint32_t *pcardstatus)
000000  b570              PUSH     {r4-r6,lr}
;;;1872   {
000002  0004              MOVS     r4,r0
000004  d01a              BEQ      |L33.60|
;;;1873     SD_Error errorstatus = SD_OK;
;;;1874   
;;;1875     if (pcardstatus == NULL)
;;;1876     {
;;;1877       errorstatus = SD_INVALID_PARAMETER;
;;;1878       return(errorstatus);
;;;1879     }
;;;1880   
;;;1881     SDIO_CmdInitStructure.SDIO_Argument = (uint32_t) RCA << 16;
000006  480e              LDR      r0,|L33.64|
000008  490e              LDR      r1,|L33.68|
00000a  8900              LDRH     r0,[r0,#8]  ; RCA
00000c  0400              LSLS     r0,r0,#16
;;;1882     SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_SEND_STATUS;
00000e  6008              STR      r0,[r1,#0]  ; SDIO_CmdInitStructure
000010  200d              MOVS     r0,#0xd
;;;1883     SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
000012  6048              STR      r0,[r1,#4]  ; SDIO_CmdInitStructure
000014  2040              MOVS     r0,#0x40
;;;1884     SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
000016  6088              STR      r0,[r1,#8]  ; SDIO_CmdInitStructure
000018  2000              MOVS     r0,#0
;;;1885     SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
00001a  60c8              STR      r0,[r1,#0xc]  ; SDIO_CmdInitStructure
00001c  f44f6080          MOV      r0,#0x400
;;;1886     SDIO_SendCommand(&SDIO_CmdInitStructure);
000020  6108              STR      r0,[r1,#0x10]  ; SDIO_CmdInitStructure
000022  4608              MOV      r0,r1
000024  f7fffffe          BL       SDIO_SendCommand
;;;1887   
;;;1888     errorstatus = CmdResp1Error(SD_CMD_SEND_STATUS);
000028  200d              MOVS     r0,#0xd
00002a  f7fffffe          BL       CmdResp1Error
00002e  0005              MOVS     r5,r0
;;;1889   
;;;1890     if (errorstatus != SD_OK)
000030  d103              BNE      |L33.58|
;;;1891     {
;;;1892       return(errorstatus);
;;;1893     }
;;;1894   
;;;1895     *pcardstatus = SDIO_GetResponse(SDIO_RESP1);
000032  f7fffffe          BL       SDIO_GetResponse
;;;1896   
;;;1897     return(errorstatus);
000036  6020              STR      r0,[r4,#0]
000038  4628              MOV      r0,r5
                  |L33.58|
;;;1898   }
00003a  bd70              POP      {r4-r6,pc}
                  |L33.60|
00003c  2026              MOVS     r0,#0x26              ;1877
00003e  bd70              POP      {r4-r6,pc}
;;;1899   
                          ENDP

                  |L33.64|
                          DCD      ||.data||
                  |L33.68|
                          DCD      ||.bss||+0xa0

                          AREA ||i.SD_StopTransfer||, CODE, READONLY, ALIGN=2

                  SD_StopTransfer PROC
;;;1751     */
;;;1752   SD_Error SD_StopTransfer(void)
000000  4808              LDR      r0,|L34.36|
;;;1753   {
000002  b510              PUSH     {r4,lr}
;;;1754     SD_Error errorstatus = SD_OK;
;;;1755   
;;;1756     /*!< Send CMD12 STOP_TRANSMISSION  */
;;;1757     SDIO_CmdInitStructure.SDIO_Argument = 0x0;
000004  2100              MOVS     r1,#0
;;;1758     SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_STOP_TRANSMISSION;
000006  220c              MOVS     r2,#0xc
000008  e9c01200          STRD     r1,r2,[r0,#0]
;;;1759     SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
00000c  2240              MOVS     r2,#0x40
00000e  e9c02102          STRD     r2,r1,[r0,#8]
;;;1760     SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;1761     SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
000012  0111              LSLS     r1,r2,#4
;;;1762     SDIO_SendCommand(&SDIO_CmdInitStructure);
000014  6101              STR      r1,[r0,#0x10]  ; SDIO_CmdInitStructure
000016  f7fffffe          BL       SDIO_SendCommand
;;;1763   
;;;1764     errorstatus = CmdResp1Error(SD_CMD_STOP_TRANSMISSION);
00001a  e8bd4010          POP      {r4,lr}
00001e  200c              MOVS     r0,#0xc
000020  f7ffbffe          B.W      CmdResp1Error
;;;1765   
;;;1766     return(errorstatus);
;;;1767   }
;;;1768   
                          ENDP

                  |L34.36|
                          DCD      ||.bss||+0xa0

                          AREA ||i.SD_WaitReadOperation||, CODE, READONLY, ALIGN=2

                  SD_WaitReadOperation PROC
;;;1391     */
;;;1392   SD_Error SD_WaitReadOperation(void)
000000  b570              PUSH     {r4-r6,lr}
;;;1393   {
;;;1394     SD_Error errorstatus = SD_OK;
;;;1395     uint32_t timeout;
;;;1396   
;;;1397     timeout = SD_DATATIMEOUT;
000002  4c15              LDR      r4,|L35.88|
000004  2600              MOVS     r6,#0                 ;1394
000006  4620              MOV      r0,r4
;;;1398     
;;;1399     while ((DMAEndOfTransfer == 0x00) && (TransferEnd == 0) && (TransferError == SD_OK) && (timeout > 0))
000008  4d14              LDR      r5,|L35.92|
00000a  e000              B        |L35.14|
                  |L35.12|
00000c  1e40              SUBS     r0,r0,#1              ;1393
                  |L35.14|
00000e  6969              LDR      r1,[r5,#0x14]  ; DMAEndOfTransfer
000010  b929              CBNZ     r1,|L35.30|
000012  6929              LDR      r1,[r5,#0x10]  ; TransferEnd
000014  b919              CBNZ     r1,|L35.30|
000016  7829              LDRB     r1,[r5,#0]  ; TransferError
000018  b909              CBNZ     r1,|L35.30|
00001a  2800              CMP      r0,#0
00001c  d1f6              BNE      |L35.12|
                  |L35.30|
;;;1400     {
;;;1401       timeout--;
;;;1402     }
;;;1403     
;;;1404     DMAEndOfTransfer = 0x00;
00001e  2000              MOVS     r0,#0
000020  6168              STR      r0,[r5,#0x14]  ; DMAEndOfTransfer
;;;1405   
;;;1406     timeout = SD_DATATIMEOUT;
;;;1407     
;;;1408     while(((SDIO->STA & SDIO_FLAG_RXACT)) && (timeout > 0))
000022  480f              LDR      r0,|L35.96|
000024  e000              B        |L35.40|
                  |L35.38|
000026  1e64              SUBS     r4,r4,#1
                  |L35.40|
000028  6b41              LDR      r1,[r0,#0x34]
00002a  0489              LSLS     r1,r1,#18
00002c  d501              BPL      |L35.50|
00002e  2c00              CMP      r4,#0
000030  d1f9              BNE      |L35.38|
                  |L35.50|
;;;1409     {
;;;1410       timeout--;  
;;;1411     }
;;;1412   
;;;1413     if (StopCondition == 1)
000032  68e8              LDR      r0,[r5,#0xc]  ; StopCondition
000034  2801              CMP      r0,#1
000036  d102              BNE      |L35.62|
;;;1414     {
;;;1415       errorstatus = SD_StopTransfer();
000038  f7fffffe          BL       SD_StopTransfer
00003c  4606              MOV      r6,r0
                  |L35.62|
;;;1416     }
;;;1417     
;;;1418     if ((timeout == 0) && (errorstatus == SD_OK))
00003e  4334              ORRS     r4,r4,r6
000040  d100              BNE      |L35.68|
;;;1419     {
;;;1420       errorstatus = SD_DATA_TIMEOUT;
000042  2604              MOVS     r6,#4
                  |L35.68|
;;;1421     }
;;;1422     
;;;1423     /*!< Clear all the static flags */
;;;1424     SDIO_ClearFlag(SDIO_STATIC_FLAGS);
000044  f24050ff          MOV      r0,#0x5ff
000048  f7fffffe          BL       SDIO_ClearFlag
;;;1425   
;;;1426     if (TransferError != SD_OK)
00004c  7828              LDRB     r0,[r5,#0]  ; TransferError
00004e  b108              CBZ      r0,|L35.84|
;;;1427     {
;;;1428       return(TransferError);
000050  7828              LDRB     r0,[r5,#0]  ; TransferError
;;;1429     }
;;;1430     else
;;;1431     {
;;;1432       return(errorstatus);  
;;;1433     }
;;;1434   }
000052  bd70              POP      {r4-r6,pc}
                  |L35.84|
000054  4630              MOV      r0,r6                 ;1432
000056  bd70              POP      {r4-r6,pc}
;;;1435   
                          ENDP

                  |L35.88|
                          DCD      0x000fffff
                  |L35.92|
                          DCD      ||.data||
                  |L35.96|
                          DCD      0x40018000

                          AREA ||i.SD_WaitWriteOperation||, CODE, READONLY, ALIGN=2

                  SD_WaitWriteOperation PROC
;;;1682     */
;;;1683   SD_Error SD_WaitWriteOperation(void)
000000  b570              PUSH     {r4-r6,lr}
;;;1684   {
;;;1685     SD_Error errorstatus = SD_OK;
;;;1686     uint32_t timeout;
;;;1687   
;;;1688     timeout = SD_DATATIMEOUT;
000002  4c15              LDR      r4,|L36.88|
000004  2600              MOVS     r6,#0                 ;1685
000006  4620              MOV      r0,r4
;;;1689     
;;;1690     while ((DMAEndOfTransfer == 0x00) && (TransferEnd == 0) && (TransferError == SD_OK) && (timeout > 0))
000008  4d14              LDR      r5,|L36.92|
00000a  e000              B        |L36.14|
                  |L36.12|
00000c  1e40              SUBS     r0,r0,#1              ;1684
                  |L36.14|
00000e  6969              LDR      r1,[r5,#0x14]  ; DMAEndOfTransfer
000010  b929              CBNZ     r1,|L36.30|
000012  6929              LDR      r1,[r5,#0x10]  ; TransferEnd
000014  b919              CBNZ     r1,|L36.30|
000016  7829              LDRB     r1,[r5,#0]  ; TransferError
000018  b909              CBNZ     r1,|L36.30|
00001a  2800              CMP      r0,#0
00001c  d1f6              BNE      |L36.12|
                  |L36.30|
;;;1691     {
;;;1692       timeout--;
;;;1693     }
;;;1694     
;;;1695     DMAEndOfTransfer = 0x00;
00001e  2000              MOVS     r0,#0
000020  6168              STR      r0,[r5,#0x14]  ; DMAEndOfTransfer
;;;1696   
;;;1697     timeout = SD_DATATIMEOUT;
;;;1698     
;;;1699     while(((SDIO->STA & SDIO_FLAG_TXACT)) && (timeout > 0))
000022  480f              LDR      r0,|L36.96|
000024  e000              B        |L36.40|
                  |L36.38|
000026  1e64              SUBS     r4,r4,#1
                  |L36.40|
000028  6b41              LDR      r1,[r0,#0x34]
00002a  04c9              LSLS     r1,r1,#19
00002c  d501              BPL      |L36.50|
00002e  2c00              CMP      r4,#0
000030  d1f9              BNE      |L36.38|
                  |L36.50|
;;;1700     {
;;;1701       timeout--;  
;;;1702     }
;;;1703   
;;;1704     if (StopCondition == 1)
000032  68e8              LDR      r0,[r5,#0xc]  ; StopCondition
000034  2801              CMP      r0,#1
000036  d102              BNE      |L36.62|
;;;1705     {
;;;1706       errorstatus = SD_StopTransfer();
000038  f7fffffe          BL       SD_StopTransfer
00003c  4606              MOV      r6,r0
                  |L36.62|
;;;1707     }
;;;1708     
;;;1709     if ((timeout == 0) && (errorstatus == SD_OK))
00003e  4334              ORRS     r4,r4,r6
000040  d100              BNE      |L36.68|
;;;1710     {
;;;1711       errorstatus = SD_DATA_TIMEOUT;
000042  2604              MOVS     r6,#4
                  |L36.68|
;;;1712     }
;;;1713     
;;;1714     /*!< Clear all the static flags */
;;;1715     SDIO_ClearFlag(SDIO_STATIC_FLAGS);
000044  f24050ff          MOV      r0,#0x5ff
000048  f7fffffe          BL       SDIO_ClearFlag
;;;1716     
;;;1717     if (TransferError != SD_OK)
00004c  7828              LDRB     r0,[r5,#0]  ; TransferError
00004e  b108              CBZ      r0,|L36.84|
;;;1718     {
;;;1719       return(TransferError);
000050  7828              LDRB     r0,[r5,#0]  ; TransferError
;;;1720     }
;;;1721     else
;;;1722     {
;;;1723       return(errorstatus);
;;;1724     }
;;;1725   }
000052  bd70              POP      {r4-r6,pc}
                  |L36.84|
000054  4630              MOV      r0,r6                 ;1723
000056  bd70              POP      {r4-r6,pc}
;;;1726   
                          ENDP

                  |L36.88|
                          DCD      0x000fffff
                  |L36.92|
                          DCD      ||.data||
                  |L36.96|
                          DCD      0x40018000

                          AREA ||i.SD_WriteBlock||, CODE, READONLY, ALIGN=2

                  SD_WriteBlock PROC
;;;1449     */
;;;1450   SD_Error SD_WriteBlock(uint8_t *writebuff, uint64_t WriteAddr, uint16_t BlockSize)
000000  e92d47f0          PUSH     {r4-r10,lr}
;;;1451   {
000004  4682              MOV      r10,r0
;;;1452     SD_Error errorstatus = SD_OK;
;;;1453   
;;;1454   #if defined (SD_POLLING_MODE)
;;;1455     uint32_t bytestransferred = 0, count = 0, restwords = 0;
;;;1456     uint32_t *tempbuff = (uint32_t *)writebuff;
;;;1457   #endif
;;;1458   
;;;1459     TransferError = SD_OK;
000006  4827              LDR      r0,|L37.164|
000008  2400              MOVS     r4,#0
00000a  9f08              LDR      r7,[sp,#0x20]
00000c  4616              MOV      r6,r2                 ;1451
00000e  7004              STRB     r4,[r0,#0]
;;;1460     TransferEnd = 0;
000010  6104              STR      r4,[r0,#0x10]  ; TransferEnd
;;;1461     StopCondition = 0;
000012  60c4              STR      r4,[r0,#0xc]  ; StopCondition
;;;1462     
;;;1463     SDIO->DCTRL = 0x0;
000014  4924              LDR      r1,|L37.168|
000016  62cc              STR      r4,[r1,#0x2c]
;;;1464   
;;;1465   
;;;1466     if (CardType == SDIO_HIGH_CAPACITY_SD_CARD)
000018  6840              LDR      r0,[r0,#4]  ; CardType
00001a  2802              CMP      r0,#2
00001c  d103              BNE      |L37.38|
;;;1467     {
;;;1468       BlockSize = 512;
00001e  0207              LSLS     r7,r0,#8
;;;1469       WriteAddr /= 512;
000020  0a56              LSRS     r6,r2,#9
000022  ea4656c3          ORR      r6,r6,r3,LSL #23
                  |L37.38|
;;;1470     }
;;;1471   
;;;1472     /* Set Block Size for Card */ 
;;;1473     SDIO_CmdInitStructure.SDIO_Argument = (uint32_t) BlockSize;
000026  4d21              LDR      r5,|L37.172|
;;;1474     SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_SET_BLOCKLEN;
;;;1475     SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
;;;1476     SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;1477     SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
000028  f44f6980          MOV      r9,#0x400
00002c  2010              MOVS     r0,#0x10              ;1474
00002e  f8c59010          STR      r9,[r5,#0x10]  ; SDIO_CmdInitStructure
000032  e9c57000          STRD     r7,r0,[r5,#0]
000036  f04f0840          MOV      r8,#0x40              ;1475
;;;1478     SDIO_SendCommand(&SDIO_CmdInitStructure);
00003a  e9c58402          STRD     r8,r4,[r5,#8]
00003e  4628              MOV      r0,r5
000040  f7fffffe          BL       SDIO_SendCommand
;;;1479   
;;;1480     errorstatus = CmdResp1Error(SD_CMD_SET_BLOCKLEN);
000044  2010              MOVS     r0,#0x10
000046  f7fffffe          BL       CmdResp1Error
;;;1481   
;;;1482     if (SD_OK != errorstatus)
00004a  2800              CMP      r0,#0
00004c  d128              BNE      |L37.160|
;;;1483     {
;;;1484       return(errorstatus);
;;;1485     }
;;;1486       
;;;1487     /*!< Send CMD24 WRITE_SINGLE_BLOCK */
;;;1488     SDIO_CmdInitStructure.SDIO_Argument = WriteAddr;
;;;1489     SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_WRITE_SINGLE_BLOCK;
00004e  2018              MOVS     r0,#0x18
;;;1490     SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
;;;1491     SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;1492     SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
000050  f8c59010          STR      r9,[r5,#0x10]  ; SDIO_CmdInitStructure
000054  e9c56000          STRD     r6,r0,[r5,#0]
000058  e9c58402          STRD     r8,r4,[r5,#8]
;;;1493     SDIO_SendCommand(&SDIO_CmdInitStructure);
00005c  4628              MOV      r0,r5
00005e  f7fffffe          BL       SDIO_SendCommand
;;;1494   
;;;1495     errorstatus = CmdResp1Error(SD_CMD_WRITE_SINGLE_BLOCK);
000062  2018              MOVS     r0,#0x18
000064  f7fffffe          BL       CmdResp1Error
;;;1496   
;;;1497     if (errorstatus != SD_OK)
000068  2800              CMP      r0,#0
00006a  d119              BNE      |L37.160|
;;;1498     {
;;;1499       return(errorstatus);
;;;1500     }
;;;1501   
;;;1502     SDIO_DataInitStructure.SDIO_DataTimeOut = SD_DATATIMEOUT;
00006c  f1050014          ADD      r0,r5,#0x14
000070  490f              LDR      r1,|L37.176|
000072  e9c01700          STRD     r1,r7,[r0,#0]
;;;1503     SDIO_DataInitStructure.SDIO_DataLength = BlockSize;
;;;1504     SDIO_DataInitStructure.SDIO_DataBlockSize = (uint32_t) 9 << 4;
000076  2190              MOVS     r1,#0x90
000078  e9c01402          STRD     r1,r4,[r0,#8]
;;;1505     SDIO_DataInitStructure.SDIO_TransferDir = SDIO_TransferDir_ToCard;
;;;1506     SDIO_DataInitStructure.SDIO_TransferMode = SDIO_TransferMode_Block;
;;;1507     SDIO_DataInitStructure.SDIO_DPSM = SDIO_DPSM_Enable;
00007c  2101              MOVS     r1,#1
00007e  e9c04104          STRD     r4,r1,[r0,#0x10]
;;;1508     SDIO_DataConfig(&SDIO_DataInitStructure);
000082  f7fffffe          BL       SDIO_DataConfig
;;;1509   
;;;1510     /*!< In case of single data block transfer no need of stop command at all */
;;;1511   #if defined (SD_POLLING_MODE) 
;;;1512     while (!(SDIO->STA & (SDIO_FLAG_DBCKEND | SDIO_FLAG_TXUNDERR | SDIO_FLAG_DCRCFAIL | SDIO_FLAG_DTIMEOUT | SDIO_FLAG_STBITERR)))
;;;1513     {
;;;1514       if (SDIO_GetFlagStatus(SDIO_FLAG_TXFIFOHE) != RESET)
;;;1515       {
;;;1516         if ((512 - bytestransferred) < 32)
;;;1517         {
;;;1518           restwords = ((512 - bytestransferred) % 4 == 0) ? ((512 - bytestransferred) / 4) : (( 512 -  bytestransferred) / 4 + 1);
;;;1519           for (count = 0; count < restwords; count++, tempbuff++, bytestransferred += 4)
;;;1520           {
;;;1521             SDIO_WriteData(*tempbuff);
;;;1522           }
;;;1523         }
;;;1524         else
;;;1525         {
;;;1526           for (count = 0; count < 8; count++)
;;;1527           {
;;;1528             SDIO_WriteData(*(tempbuff + count));
;;;1529           }
;;;1530           tempbuff += 8;
;;;1531           bytestransferred += 32;
;;;1532         }
;;;1533       }
;;;1534     }
;;;1535     if (SDIO_GetFlagStatus(SDIO_FLAG_DTIMEOUT) != RESET)
;;;1536     {
;;;1537       SDIO_ClearFlag(SDIO_FLAG_DTIMEOUT);
;;;1538       errorstatus = SD_DATA_TIMEOUT;
;;;1539       return(errorstatus);
;;;1540     }
;;;1541     else if (SDIO_GetFlagStatus(SDIO_FLAG_DCRCFAIL) != RESET)
;;;1542     {
;;;1543       SDIO_ClearFlag(SDIO_FLAG_DCRCFAIL);
;;;1544       errorstatus = SD_DATA_CRC_FAIL;
;;;1545       return(errorstatus);
;;;1546     }
;;;1547     else if (SDIO_GetFlagStatus(SDIO_FLAG_TXUNDERR) != RESET)
;;;1548     {
;;;1549       SDIO_ClearFlag(SDIO_FLAG_TXUNDERR);
;;;1550       errorstatus = SD_TX_UNDERRUN;
;;;1551       return(errorstatus);
;;;1552     }
;;;1553     else if (SDIO_GetFlagStatus(SDIO_FLAG_STBITERR) != RESET)
;;;1554     {
;;;1555       SDIO_ClearFlag(SDIO_FLAG_STBITERR);
;;;1556       errorstatus = SD_START_BIT_ERR;
;;;1557       return(errorstatus);
;;;1558     }
;;;1559   #elif defined (SD_DMA_MODE)
;;;1560     SDIO_ITConfig(SDIO_IT_DCRCFAIL | SDIO_IT_DTIMEOUT | SDIO_IT_DATAEND | SDIO_IT_RXOVERR | SDIO_IT_STBITERR, ENABLE);
000086  2101              MOVS     r1,#1
000088  f240302a          MOV      r0,#0x32a
00008c  f7fffffe          BL       SDIO_ITConfig
;;;1561     SD_LowLevel_DMA_TxConfig((uint32_t *)writebuff, BlockSize);
000090  4639              MOV      r1,r7
000092  4650              MOV      r0,r10
000094  f7fffffe          BL       SD_LowLevel_DMA_TxConfig
;;;1562     SDIO_DMACmd(ENABLE);
000098  2001              MOVS     r0,#1
00009a  f7fffffe          BL       SDIO_DMACmd
;;;1563   #endif
;;;1564   
;;;1565     return(errorstatus);
00009e  4620              MOV      r0,r4
                  |L37.160|
;;;1566   }
0000a0  e8bd87f0          POP      {r4-r10,pc}
;;;1567   
                          ENDP

                  |L37.164|
                          DCD      ||.data||
                  |L37.168|
                          DCD      0x40018000
                  |L37.172|
                          DCD      ||.bss||+0xa0
                  |L37.176|
                          DCD      0x000fffff

                          AREA ||i.SD_WriteMultiBlocks||, CODE, READONLY, ALIGN=2

                  SD_WriteMultiBlocks PROC
;;;1582     */
;;;1583   SD_Error SD_WriteMultiBlocks(uint8_t *writebuff, uint64_t WriteAddr, uint16_t BlockSize, uint32_t NumberOfBlocks)
000000  e92d5fff          PUSH     {r0-r12,lr}
;;;1584   {
;;;1585     SD_Error errorstatus = SD_OK;
;;;1586   
;;;1587     TransferError = SD_OK;
000004  f8dfb0f4          LDR      r11,|L38.252|
000008  e9dd760e          LDRD     r7,r6,[sp,#0x38]      ;1584
00000c  2000              MOVS     r0,#0
00000e  4615              MOV      r5,r2                 ;1584
000010  f88b0000          STRB     r0,[r11,#0]
;;;1588     TransferEnd = 0;
000014  f8cb0010          STR      r0,[r11,#0x10]  ; TransferEnd
;;;1589     StopCondition = 1;
000018  2201              MOVS     r2,#1
00001a  f8cb200c          STR      r2,[r11,#0xc]  ; StopCondition
;;;1590     
;;;1591     SDIO->DCTRL = 0x0;
00001e  4a38              LDR      r2,|L38.256|
000020  62d0              STR      r0,[r2,#0x2c]
;;;1592   
;;;1593     if (CardType == SDIO_HIGH_CAPACITY_SD_CARD)
000022  f8db1004          LDR      r1,[r11,#4]  ; CardType
000026  2902              CMP      r1,#2
000028  d103              BNE      |L38.50|
;;;1594     {
;;;1595       BlockSize = 512;
00002a  020f              LSLS     r7,r1,#8
;;;1596       WriteAddr /= 512;
00002c  0a6d              LSRS     r5,r5,#9
00002e  ea4555c3          ORR      r5,r5,r3,LSL #23
                  |L38.50|
;;;1597     }
;;;1598   
;;;1599     /* Set Block Size for Card */ 
;;;1600     SDIO_CmdInitStructure.SDIO_Argument = (uint32_t) BlockSize;
000032  4c34              LDR      r4,|L38.260|
;;;1601     SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_SET_BLOCKLEN;
;;;1602     SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
;;;1603     SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;1604     SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
000034  f44f6a80          MOV      r10,#0x400
000038  2110              MOVS     r1,#0x10              ;1601
;;;1605     SDIO_SendCommand(&SDIO_CmdInitStructure);
00003a  f8c4a010          STR      r10,[r4,#0x10]  ; SDIO_CmdInitStructure
00003e  e9c47100          STRD     r7,r1,[r4,#0]
000042  4680              MOV      r8,r0                 ;1603
000044  f04f0940          MOV      r9,#0x40              ;1602
000048  e9c49802          STRD     r9,r8,[r4,#8]
00004c  4620              MOV      r0,r4
00004e  f7fffffe          BL       SDIO_SendCommand
;;;1606   
;;;1607     errorstatus = CmdResp1Error(SD_CMD_SET_BLOCKLEN);
000052  2010              MOVS     r0,#0x10
000054  f7fffffe          BL       CmdResp1Error
;;;1608   
;;;1609     if (SD_OK != errorstatus)
000058  2800              CMP      r0,#0
00005a  d14b              BNE      |L38.244|
;;;1610     {
;;;1611       return(errorstatus);
;;;1612     }
;;;1613     
;;;1614     /*!< To improve performance */
;;;1615     SDIO_CmdInitStructure.SDIO_Argument = (uint32_t) (RCA << 16);
00005c  f8bb0008          LDRH     r0,[r11,#8]  ; RCA
000060  0400              LSLS     r0,r0,#16
;;;1616     SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_APP_CMD;
000062  6020              STR      r0,[r4,#0]  ; SDIO_CmdInitStructure
000064  2037              MOVS     r0,#0x37
000066  e9c40901          STRD     r0,r9,[r4,#4]
;;;1617     SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
;;;1618     SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;1619     SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
;;;1620     SDIO_SendCommand(&SDIO_CmdInitStructure);
00006a  e9c48a03          STRD     r8,r10,[r4,#0xc]
00006e  4620              MOV      r0,r4
000070  f7fffffe          BL       SDIO_SendCommand
;;;1621   
;;;1622   
;;;1623     errorstatus = CmdResp1Error(SD_CMD_APP_CMD);
000074  2037              MOVS     r0,#0x37
000076  f7fffffe          BL       CmdResp1Error
;;;1624   
;;;1625     if (errorstatus != SD_OK)
00007a  2800              CMP      r0,#0
00007c  d13a              BNE      |L38.244|
;;;1626     {
;;;1627       return(errorstatus);
;;;1628     }
;;;1629     /*!< To improve performance */
;;;1630     SDIO_CmdInitStructure.SDIO_Argument = (uint32_t)NumberOfBlocks;
;;;1631     SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_SET_BLOCK_COUNT;
00007e  2017              MOVS     r0,#0x17
;;;1632     SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
;;;1633     SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;1634     SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
000080  f8c4a010          STR      r10,[r4,#0x10]  ; SDIO_CmdInitStructure
000084  e9c46000          STRD     r6,r0,[r4,#0]
;;;1635     SDIO_SendCommand(&SDIO_CmdInitStructure);
000088  e9c49802          STRD     r9,r8,[r4,#8]
00008c  4620              MOV      r0,r4
00008e  f7fffffe          BL       SDIO_SendCommand
;;;1636   
;;;1637     errorstatus = CmdResp1Error(SD_CMD_SET_BLOCK_COUNT);
000092  2017              MOVS     r0,#0x17
000094  f7fffffe          BL       CmdResp1Error
;;;1638   
;;;1639     if (errorstatus != SD_OK)
000098  2800              CMP      r0,#0
00009a  d12b              BNE      |L38.244|
;;;1640     {
;;;1641       return(errorstatus);
;;;1642     }
;;;1643   
;;;1644   
;;;1645     /*!< Send CMD25 WRITE_MULT_BLOCK with argument data address */
;;;1646     SDIO_CmdInitStructure.SDIO_Argument = (uint32_t)WriteAddr;
;;;1647     SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_WRITE_MULT_BLOCK;
00009c  2019              MOVS     r0,#0x19
00009e  e9c45000          STRD     r5,r0,[r4,#0]
;;;1648     SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
;;;1649     SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;1650     SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
0000a2  f8c4a010          STR      r10,[r4,#0x10]  ; SDIO_CmdInitStructure
0000a6  e9c49802          STRD     r9,r8,[r4,#8]
0000aa  4645              MOV      r5,r8                 ;1649
;;;1651     SDIO_SendCommand(&SDIO_CmdInitStructure);
0000ac  4620              MOV      r0,r4
0000ae  f7fffffe          BL       SDIO_SendCommand
;;;1652   
;;;1653     errorstatus = CmdResp1Error(SD_CMD_WRITE_MULT_BLOCK);
0000b2  2019              MOVS     r0,#0x19
0000b4  f7fffffe          BL       CmdResp1Error
;;;1654   
;;;1655     if (SD_OK != errorstatus)
0000b8  2800              CMP      r0,#0
0000ba  d11b              BNE      |L38.244|
;;;1656     {
;;;1657       return(errorstatus);
;;;1658     }
;;;1659   
;;;1660     SDIO_DataInitStructure.SDIO_DataTimeOut = SD_DATATIMEOUT;
0000bc  f1040114          ADD      r1,r4,#0x14
0000c0  4811              LDR      r0,|L38.264|
;;;1661     SDIO_DataInitStructure.SDIO_DataLength = NumberOfBlocks * BlockSize;
0000c2  437e              MULS     r6,r7,r6
0000c4  e9c10600          STRD     r0,r6,[r1,#0]
;;;1662     SDIO_DataInitStructure.SDIO_DataBlockSize = (uint32_t) 9 << 4;
0000c8  2090              MOVS     r0,#0x90
0000ca  e9c10502          STRD     r0,r5,[r1,#8]
;;;1663     SDIO_DataInitStructure.SDIO_TransferDir = SDIO_TransferDir_ToCard;
;;;1664     SDIO_DataInitStructure.SDIO_TransferMode = SDIO_TransferMode_Block;
;;;1665     SDIO_DataInitStructure.SDIO_DPSM = SDIO_DPSM_Enable;
0000ce  2001              MOVS     r0,#1
0000d0  e9c15004          STRD     r5,r0,[r1,#0x10]
;;;1666     SDIO_DataConfig(&SDIO_DataInitStructure);
0000d4  4608              MOV      r0,r1
0000d6  f7fffffe          BL       SDIO_DataConfig
;;;1667   
;;;1668     SDIO_ITConfig(SDIO_IT_DCRCFAIL | SDIO_IT_DTIMEOUT | SDIO_IT_DATAEND | SDIO_IT_RXOVERR | SDIO_IT_STBITERR, ENABLE);
0000da  2101              MOVS     r1,#1
0000dc  f240302a          MOV      r0,#0x32a
0000e0  f7fffffe          BL       SDIO_ITConfig
;;;1669     SDIO_DMACmd(ENABLE);
0000e4  2001              MOVS     r0,#1
0000e6  f7fffffe          BL       SDIO_DMACmd
;;;1670     SD_LowLevel_DMA_TxConfig((uint32_t *)writebuff, (NumberOfBlocks * BlockSize));
0000ea  4631              MOV      r1,r6
0000ec  9800              LDR      r0,[sp,#0]
0000ee  f7fffffe          BL       SD_LowLevel_DMA_TxConfig
;;;1671   
;;;1672     return(errorstatus);
0000f2  4628              MOV      r0,r5
                  |L38.244|
;;;1673   }
0000f4  b004              ADD      sp,sp,#0x10
0000f6  e8bd9ff0          POP      {r4-r12,pc}
;;;1674   
                          ENDP

0000fa  0000              DCW      0x0000
                  |L38.252|
                          DCD      ||.data||
                  |L38.256|
                          DCD      0x40018000
                  |L38.260|
                          DCD      ||.bss||+0xa0
                  |L38.264|
                          DCD      0x000fffff

                          AREA ||i.convert_from_bytes_to_power_of_two||, CODE, READONLY, ALIGN=1

                  convert_from_bytes_to_power_of_two PROC
;;;2810     */
;;;2811   uint8_t convert_from_bytes_to_power_of_two(uint16_t NumberOfBytes)
000000  2100              MOVS     r1,#0
;;;2812   {
000002  e002              B        |L39.10|
                  |L39.4|
;;;2813     uint8_t count = 0;
;;;2814   
;;;2815     while (NumberOfBytes != 1)
;;;2816     {
;;;2817       NumberOfBytes >>= 1;
000004  0840              LSRS     r0,r0,#1
000006  1c49              ADDS     r1,r1,#1
;;;2818       count++;
000008  b2c9              UXTB     r1,r1
                  |L39.10|
00000a  2801              CMP      r0,#1                 ;2815
00000c  d1fa              BNE      |L39.4|
;;;2819     }
;;;2820     return(count);
00000e  4608              MOV      r0,r1
;;;2821   }
000010  4770              BX       lr
;;;2822   
                          ENDP


                          AREA ||.bss||, DATA, NOINIT, ALIGN=3

                  CSD_Tab
                          %        16
                  CID_Tab
                          %        16
                  SDSTATUS_Tab
                          %        16
                  SDCardInfo
                          %        88
                  SDIO_InitStructure
                          %        24
                  SDIO_CmdInitStructure
                          %        20
                  SDIO_DataInitStructure
                          %        24

                          AREA ||.data||, DATA, ALIGN=2

                  TransferError
000000  00000000          DCB      0x00,0x00,0x00,0x00
                  CardType
                          DCD      0x00000000
                  ||RCA||
                          DCD      0x00000000
                  StopCondition
                          DCD      0x00000000
                  TransferEnd
                          DCD      0x00000000
                  DMAEndOfTransfer
                          DCD      0x00000000

;*** Start embedded assembler ***

#line 1 "..\\..\\User\\bsp\\src\\bsp_sdio_sd.c"
	AREA ||.rev16_text||, CODE
	THUMB
	EXPORT |__asm___13_bsp_sdio_sd_c_70335e9e____REV16|
#line 114 "..\\..\\Libraries\\CMSIS\\Include\\core_cmInstr.h"
|__asm___13_bsp_sdio_sd_c_70335e9e____REV16| PROC
#line 115

 rev16 r0, r0
 bx lr
	ENDP
	AREA ||.revsh_text||, CODE
	THUMB
	EXPORT |__asm___13_bsp_sdio_sd_c_70335e9e____REVSH|
#line 128
|__asm___13_bsp_sdio_sd_c_70335e9e____REVSH| PROC
#line 129

 revsh r0, r0
 bx lr
	ENDP

;*** End   embedded assembler ***
